import{b as W,j as s}from"./query-vendor-KlcNboas.js";import{V as $,W as P,j as Q,C as v,g as K,c as O,h as S,i as B}from"./index-DxH3n9CQ.js";import{a as k,e as J}from"./react-vendor-vqeg7uDR.js";import{c as T,d as L,a as y,F as U}from"./form-vendor--t6BffNT.js";import{S as G,c as H}from"./ui-vendor-D4DdIvF_.js";import{T as z}from"./TextEditor-C5AexkSJ.js";const N=[{value:"saturday",label:"شنبه"},{value:"sunday",label:"یکشنبه"},{value:"monday",label:"دوشنبه"},{value:"tuesday",label:"سه‌شنبه"},{value:"wednesday",label:"چهارشنبه"},{value:"thursday",label:"پنج‌شنبه"},{value:"friday",label:"جمعه"}],X=i=>{const d=O.c(3);let f;d[0]===Symbol.for("react.memo_cache_sentinel")?(f=s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),d[0]=f):f=d[0];let u;return d[1]!==i?(u=s.jsx(H.DropdownIndicator,{...i,children:f}),d[1]=i,d[2]=u):u=d[2],u};function ae({doctor:i}){const d=k.useRef(null),f=J(),u=W(),{mutateAsync:M}=$(),{mutateAsync:q}=P(),{data:E}=Q(1,100),[I,w]=k.useState(!1),j=!!i?.id,F=k.useMemo(()=>E?.data?.clinics?.map(e=>({value:e.id,label:e.name}))||[],[E?.data?.clinics]),A=k.useMemo(()=>T({firstName:y().required("نام الزامی است"),lastName:y().required("نام خانوادگی الزامی است"),university:y().required("دانشگاه الزامی است"),medicalLicenseNo:y().required("شماره نظام پزشکی الزامی است"),biography:y(),skills:L().of(y()),clinicIds:L().of(y()).min(1,"انتخاب حداقل یک کلینیک الزامی است").required("انتخاب کلینیک الزامی است"),workingDays:T()}),[]),V=async(e,h)=>{try{const a=new FormData;if(a.append("firstName",e.firstName),a.append("lastName",e.lastName),a.append("university",e.university),a.append("medicalLicenseNo",e.medicalLicenseNo),e.biography&&a.append("biography",e.biography),e.skills&&e.skills.length>0&&a.append("skills",JSON.stringify(e.skills)),e.clinicIds&&e.clinicIds.length>0&&a.append("clinicIds",JSON.stringify(e.clinicIds)),e.workingDays&&e.clinicIds.length>0){const n={};e.clinicIds.forEach(t=>{const l=e.workingDays[t]||{},o={};N.forEach(r=>{const c=l[r.value]||[];if(c.length>0){const x=c.filter(p=>p.start&&p.end).map(p=>`${p.start}-${p.end}`);o[r.value]=x.length>0?x.join(" & "):null}else o[r.value]=null}),n[t]=o}),a.append("workingDays",JSON.stringify(n))}if(e.profileImage&&a.append("profileImage",e.profileImage),I&&j&&a.append("removeProfileImage","true"),a.append("isAppointmentEnabled",e.isAppointmentEnabled?"true":"false"),j&&i?.id){const n=await q({id:i.id,data:a});S("پزشک با موفقیت ویرایش شد"),w(!1),n?.data?.doctor&&u.setQueryData(["doctor",i.id],n),u.invalidateQueries({queryKey:["doctors"]}),u.invalidateQueries({queryKey:["doctor",i.id]}),f("/admin/doctors-management")}else{await M(a),S("پزشک با موفقیت ایجاد شد"),h(),u.invalidateQueries({queryKey:["doctors"]}),u.invalidateQueries({queryKey:["doctor"]});const n=document.querySelector(".overflow-auto");n?n.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{d.current&&(d.current.value="")},0)}catch(a){const n=a?.response?.data?.message||(j?"خطایی در ویرایش پزشک رخ داد":"خطایی در ایجاد پزشک رخ داد");B(n)}};return s.jsx(U,{initialValues:{firstName:i?.firstName||"",lastName:i?.lastName||"",university:i?.university||"",biography:i?.biography||"",skills:i?.skills||[],medicalLicenseNo:i?.medicalLicenseNo||"",clinicIds:i?.clinics?.map(e=>e.clinic.id)||[],isAppointmentEnabled:i?.isAppointmentEnabled??!1,workingDays:(()=>{const e=i?.workingDays,h=i?.clinics?.map(a=>a.clinic.id)||[];if(e&&h.length>0){const a={};return h.forEach(n=>{const t=e[n];if(!t||typeof t!="object"){a[n]={},N.forEach(l=>{a[n][l.value]=[]});return}a[n]={},N.forEach(l=>{const o=t[l.value];if(o==null)a[n][l.value]=[];else if(typeof o=="string"&&o.trim())if(o.includes(" & ")){const r=o.split(" & ").map(c=>{const[x,p]=c.trim().split("-");return{start:x||"",end:p||""}});a[n][l.value]=r.filter(c=>c.start&&c.end)}else{const[r,c]=o.split("-");a[n][l.value]=r&&c?[{start:r.trim(),end:c.trim()}]:[]}else Array.isArray(o)?a[n][l.value]=o.map(r=>{if(typeof r=="string"){const[c,x]=r.split("-");return{start:c||"",end:x||""}}return r}):a[n][l.value]=[]})}),a}return{}})(),profileImage:null,skillInput:""},validationSchema:A,onSubmit:async(e,{resetForm:h})=>{await V({firstName:e.firstName,lastName:e.lastName,university:e.university,biography:e.biography,skills:e.skills,medicalLicenseNo:e.medicalLicenseNo,clinicIds:e.clinicIds,workingDays:e.workingDays,profileImage:e.profileImage,isAppointmentEnabled:e.isAppointmentEnabled},h)},children:e=>{const h=i?.profileImage&&!e.values.profileImage&&!I,a=()=>{if(e.values.skillInput.trim()){const t=[...e.values.skills,e.values.skillInput.trim()];e.setFieldValue("skills",t),e.setFieldValue("skillInput","")}},n=t=>{const l=e.values.skills.filter((o,r)=>r!==t);e.setFieldValue("skills",l)};return s.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:[s.jsx(v,{labelText:"نام",placeholder:"نام را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("firstName"),errorMessage:e.touched.firstName&&e.errors.firstName?e.errors.firstName:null}),s.jsx(v,{labelText:"نام خانوادگی",placeholder:"نام خانوادگی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("lastName"),errorMessage:e.touched.lastName&&e.errors.lastName?e.errors.lastName:null}),s.jsx(v,{labelText:"دانشگاه تحصیلی",placeholder:"دانشگاه را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("university"),errorMessage:e.touched.university&&e.errors.university?e.errors.university:null}),s.jsx(v,{labelText:"شماره نظام پزشکی",placeholder:"شماره نظام پزشکی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("medicalLicenseNo"),errorMessage:e.touched.medicalLicenseNo&&e.errors.medicalLicenseNo?e.errors.medicalLicenseNo:null})]}),s.jsx(z,{labelText:"بیوگرافی",placeholder:"بیوگرافی پزشک را وارد کنید",optional:!0,value:e.values.biography,onChange:t=>{e.setFieldValue("biography",t),e.setFieldTouched("biography",!0)},errorMessage:e.touched.biography&&e.errors.biography?e.errors.biography:null}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تخصص‌ ها"}),s.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[s.jsx(v,{className:"flex-1 bg-white",labelText:"",placeholder:"تخصص را وارد کنید و Enter بزنید",...e.getFieldProps("skillInput"),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),a())}}),s.jsx("button",{type:"button",onClick:a,className:"purple-btn",children:"افزودن"})]}),e.values.skills.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mr-4 mb-2",children:e.values.skills.map((t,l)=>s.jsxs("span",{className:"px-4 py-2 bg-primary/10 text-primary rounded-full flex items-center gap-2",children:[t,s.jsx("button",{type:"button",onClick:()=>n(l),className:"text-red-500 hover:text-red-700",children:"×"})]},l))})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:["کلینیک‌ ها",s.jsx("span",{className:"text-red-500 mr-1",children:"*"})]}),s.jsxs("div",{className:"",children:[s.jsx(G,{isMulti:!0,options:F,value:F.filter(t=>e.values.clinicIds.includes(t.value)),onChange:t=>{const l=t?t.map(o=>o.value):[];e.setFieldValue("clinicIds",l)},onBlur:()=>e.setFieldTouched("clinicIds",!0),placeholder:"کلینیک‌ها را انتخاب کنید",components:{DropdownIndicator:X},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:t,isSelected:l})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${l?"!bg-primary text-white !cursor-pointer":t?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}}),s.jsx("div",{className:"text-red-500 text-[10px] mr-4 mt-1 min-h-[20px]",children:(e.touched.clinicIds||e.submitCount>0)&&e.errors.clinicIds&&s.jsx("span",{children:e.errors.clinicIds})})]})]}),s.jsxs("div",{className:"flex items-center gap-3 mr-4",children:[s.jsx("input",{type:"checkbox",id:"isAppointmentEnabled",checked:e.values.isAppointmentEnabled,onChange:t=>{e.setFieldValue("isAppointmentEnabled",t.target.checked)},className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary cursor-pointer"}),s.jsx("label",{htmlFor:"isAppointmentEnabled",className:"text-dark font-estedad-lightbold cursor-pointer",children:"فعال بودن امکان نوبت‌گیری برای این پزشک"})]}),e.values.clinicIds.length>0&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-4 mr-4",children:"ساعت‌های کاری (به تفکیک کلینیک)"}),s.jsx("div",{className:"space-y-6",children:e.values.clinicIds.map(t=>{const l=F.find(r=>r.value===t),o=e.values.workingDays[t]||{};if(!e.values.workingDays[t]){const r={...e.values.workingDays};r[t]={},N.forEach(c=>{r[t][c.value]=[]}),e.setFieldValue("workingDays",r)}return s.jsxs("div",{className:"border-2 border-primary/20 rounded-xl p-6 bg-gradient-to-br from-primary/5 to-purple-50",children:[s.jsxs("h6",{className:"text-lg font-estedad-semibold text-dark mb-4 flex items-center gap-2",children:[s.jsx("i",{className:"fas fa-hospital text-primary"}),l?.label||"کلینیک"]}),s.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-4",children:N.map(r=>{const c=o[r.value]||[],x=()=>{const m=[...c,{start:"08:00",end:"12:00"}],g={...e.values.workingDays,[t]:{...o,[r.value]:m}};e.setFieldValue("workingDays",g)},p=(m,g,b)=>{const D=[...c];D[m]={...D[m],[g]:b};const C={...e.values.workingDays,[t]:{...o,[r.value]:D}};e.setFieldValue("workingDays",C)},R=m=>{const g=c.filter((D,C)=>C!==m),b={...e.values.workingDays,[t]:{...o,[r.value]:g}};e.setFieldValue("workingDays",b)};return s.jsxs("div",{className:"space-y-3 p-4 border-2 border-main-border-color rounded-lg bg-white",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("label",{className:"block text-sm font-medium text-dark",children:r.label}),s.jsxs("button",{type:"button",onClick:x,className:"text-primary hover:text-primary/80 text-xs font-estedad-lightbold flex items-center gap-1",children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M8 3V13M3 8H13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"افزودن بازه"]})]}),c.length===0?s.jsx("div",{className:"text-center py-4 text-paragray text-sm",children:"بازه زمانی انتخاب نشده است"}):s.jsx("div",{className:"space-y-3",children:c.map((m,g)=>s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border border-main-border-color",children:[s.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-xs text-paragray mb-1",children:"از"}),s.jsx("input",{type:"time",value:m.start,onChange:b=>p(g,"start",b.target.value),className:"w-full px-3 py-2 border-2 border-main-border-color rounded-lg text-dark focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-xs text-paragray mb-1",children:"تا"}),s.jsx("input",{type:"time",value:m.end,onChange:b=>p(g,"end",b.target.value),min:m.start,className:"w-full px-3 py-2 border-2 border-main-border-color rounded-lg text-dark focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),s.jsx("button",{type:"button",onClick:()=>R(g),className:"text-red-500 hover:text-red-700 p-2 transition-colors",title:"حذف",children:s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M5 5L15 15M15 5L5 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]},g))})]},r.value)})})]},t)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر پروفایل"}),s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[s.jsx("input",{ref:d,type:"file",accept:"image/*",className:"hidden ",onChange:t=>{const l=t.target.files?.[0]||null;e.setFieldValue("profileImage",l),w(!1)}}),s.jsx("button",{type:"button",onClick:()=>{d.current?.click(),w(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.profileImage instanceof File&&s.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.profileImage.name}),h&&s.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[s.jsx("img",{src:K(i.profileImage),alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}),s.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),s.jsx("button",{type:"button",onClick:()=>{w(!0),e.setFieldValue("profileImage",null),d.current&&(d.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),I&&s.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[j?"ویرایش پزشک":"ایجاد پزشک",e.isSubmitting&&s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{ae as D};
