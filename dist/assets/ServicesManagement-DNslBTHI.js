import{j as e,c as I}from"./query-vendor-DvaUDqTV.js";import{u as R,a as l}from"./react-vendor-dTsWsAAn.js";import{c as E,C as A,s as F,b as L}from"./index-Cr8hLwb7.js";import{u as P}from"./useAdminDashboardHeader-CFWWO3br.js";import{b as $,u as H}from"./useServices-DtdwGjtZ.js";import{A as O}from"./AdminPagination-Tws6WsYb.js";import{T as _}from"./TableContainer-BNW3tjli.js";import{T as q,D as B}from"./DeleteModal-ZkzQdZ_j.js";import{s as Q,f as G}from"./helpers-DOyc9qlM.js";import{a as J}from"./index.module-BblzqiS0.js";import{S as K}from"./ServiceManagementForm-CdwprT7C.js";import{S as z}from"./SectionContainer-BAFuz5jC.js";import"./redux-vendor-5gwm_VuO.js";import"./ui-vendor-B68-Q-v-.js";import"./form-vendor--jwUxY8R.js";import"./motion-vendor-CQyDv_CV.js";import"./TextEditor-DiNjRXlH.js";import"./editor-vendor-B7Ps43eN.js";import"./useCategories-Ddz5bqnW.js";function U(c){const t=E.c(15),{services:d,isLoadingServices:a,page:j,onDeleteClick:m,onRefetch:p,isRefetching:f}=c,g=f===void 0?!1:f,h=R();let r;t[0]!==g||t[1]!==p?(r=p&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:p,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=g,t[1]=p,t[2]=r):r=t[2];let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"خدمت"}),e.jsx("th",{children:"توضیحات"}),e.jsx("th",{children:"دسته‌بندی‌ها"}),e.jsx("th",{children:"قیمت"}),e.jsx("th",{children:"مدت زمان"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=o):o=t[3];let i;t[4]!==a||t[5]!==h||t[6]!==m||t[7]!==j||t[8]!==d?(i=a?e.jsx(q,{rows:5,columns:8}):d.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"خدمتی یافت نشد"})}):d.map((s,b)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(j-1)*5+b+1}),e.jsx("td",{className:"min-w-[200px] pr-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.coverImage?e.jsx("img",{src:`http://localhost:4000${s.coverImage}`,alt:s.title,className:"w-12 h-12 rounded-lg object-cover shrink-0"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-200 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-file-alt text-gray-400"})}),e.jsx("div",{children:e.jsx("p",{className:"font-estedad-light line-clamp-2",children:s.title})})]})}),e.jsx("td",{className:"text-dark font-estedad-light min-w-[250px] pr-6",children:s.description?e.jsx("span",{className:"line-clamp-2",children:Q(s.description)}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.categories&&s.categories.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1 ",children:[s.categories.slice(0,2).map(V),s.categories.length>2&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600",children:["+",s.categories.length-2]})]}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.price?e.jsxs("span",{children:[new Intl.NumberFormat("fa-IR").format(s.price)," ","تومان"]}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.durationMinutes?e.jsxs("span",{children:[s.durationMinutes," دقیقه"]}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:G(new Date(s.createdAt||new Date))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{h(`/admin/services-management/edit/${s.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>m(s.id,s.title),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},s.id)),t[4]=a,t[5]=h,t[6]=m,t[7]=j,t[8]=d,t[9]=i):i=t[9];let n;t[10]!==i?(n=e.jsx(_,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[o,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:i})]})}),t[10]=i,t[11]=n):n=t[11];let u;return t[12]!==r||t[13]!==n?(u=e.jsxs(e.Fragment,{children:[r,n]}),t[12]=r,t[13]=n,t[14]=u):u=t[14],u}function V(c){return e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary text-center text-nowrap  ",children:c.name},c.id)}function fe(){const{setHeaderConfig:c}=P(),[t,d]=l.useState(1),[a,j]=l.useState(""),[m]=J(a,500),[p,f]=l.useState(!1),[g,h]=l.useState(!1),[r,o]=l.useState(null),[i,n]=l.useState(!1),u=I(),{mutateAsync:s}=$(),{data:b,isLoading:N,isPending:v,refetch:S,isFetching:w}=H(t,5,m);l.useEffect(()=>(c({title:"مدیریت خدمات"}),()=>{c({title:void 0,backButton:!1})}),[c]),l.useEffect(()=>{a.trim()?f(!0):f(!1)},[a]),l.useEffect(()=>{N||m===a&&f(!1)},[N,m,a]);const C=(x,y)=>{o({id:x,title:y}),h(!0)},D=async()=>{if(r){n(!0);try{await s(r.id),F("خدمت با موفقیت حذف شد"),u.invalidateQueries({queryKey:["services"]}),h(!1),o(null)}catch(x){const y=x?.response?.data?.message||"خطایی در حذف خدمت رخ داد";L(y)}finally{n(!1)}}},k=()=>{i||(h(!1),o(null))},T=b?.data?.services||[],M=b?.meta;return e.jsxs("main",{children:[e.jsxs(z,{children:[e.jsx("h5",{className:"main-header ",children:"لیست خدمات"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(A,{labelText:"جستجو",placeholder:"جستجو بر اساس عنوان، توضیحات یا نکات...",className:"bg-white pr-12",value:a,onChange:x=>{j(x.target.value),d(1)}}),p&&a&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]})}),e.jsx(U,{services:T,isLoadingServices:N||v,page:t,onDeleteClick:C,onRefetch:S,isRefetching:w}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(O,{meta:M,onPageChange:x=>d(x)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(K,{})]}),e.jsx(B,{isOpen:g,onClose:k,onConfirm:D,title:"حذف خدمت",message:`آیا از حذف خدمت "${r?.title}" اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:i})]})}export{fe as default};
