import{r as p,j as t}from"./react-core-DkX7OQ4Q.js";import{c as y,e as S,b as T,a as d,F as N}from"./forms-CxDKTD82.js";import{ax as w,ay as f,C as c,e as I,i as u,s as h}from"./index-DUiqV2No.js";import{b as F}from"./query-x6gLKhnn.js";import{T as L}from"./TextEditor-CLQQFrLC.js";import{a as C}from"./react-router-CdfMEooj.js";function K({banner:s}){const n=p.useRef(null),m=C(),a=F(),{mutateAsync:x}=w(),{mutateAsync:g}=f(),o=!!s?.id,b=p.useMemo(()=>y({title:d().max(200,"عنوان نباید بیشتر از 200 کاراکتر باشد"),description:d(),buttonText:d().max(100,"متن دکمه نباید بیشتر از 100 کاراکتر باشد"),buttonLink:d().url("لینک معتبر نیست"),order:T().integer("ترتیب باید عدد صحیح باشد").min(0,"ترتیب باید عدد مثبت باشد"),published:S()}),[]),j=async(e,l)=>{try{if(!o&&!e.heroSliderImage){u("لطفاً یک تصویر انتخاب کنید");return}if(o&&!e.heroSliderImage&&!s?.image){u("لطفاً یک تصویر انتخاب کنید");return}const r=new FormData;if(e.title&&r.append("title",e.title),e.description&&r.append("description",e.description),e.buttonText&&r.append("buttonText",e.buttonText),e.buttonLink&&r.append("buttonLink",e.buttonLink),r.append("order",e.order.toString()),r.append("published",e.published?"true":"false"),e.heroSliderImage&&r.append("heroSliderImage",e.heroSliderImage),o&&s?.id){const i=await g({id:s.id,data:r});h("بنر با موفقیت ویرایش شد"),i?.data?.slider&&a.setQueryData(["heroSlider",s.id],i),a.invalidateQueries({queryKey:["heroSliders"]}),a.invalidateQueries({queryKey:["heroSlider",s.id]}),m("/admin/banner-management")}else{await x(r),h("بنر با موفقیت ایجاد شد"),l(),a.invalidateQueries({queryKey:["heroSliders"]}),a.invalidateQueries({queryKey:["heroSlider"]});const i=document.querySelector(".overflow-auto");i?i.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{n.current&&(n.current.value="")},0)}catch(r){const i=r?.response?.data?.message||(o?"خطایی در ویرایش بنر رخ داد":"خطایی در ایجاد بنر رخ داد");u(i)}};return t.jsx(N,{initialValues:{title:s?.title||"",description:s?.description||"",buttonText:s?.buttonText||"",buttonLink:s?.buttonLink||"",order:s?.order??0,published:s?.published??!0,heroSliderImage:null},validationSchema:b,onSubmit:async(e,{resetForm:l})=>{await j({title:e.title,description:e.description,buttonText:e.buttonText,buttonLink:e.buttonLink,order:e.order,published:e.published,heroSliderImage:e.heroSliderImage},l)},children:e=>{const l=s?.image&&!e.values.heroSliderImage;return t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(c,{labelText:"عنوان",placeholder:"عنوان بنر را وارد کنید (اختیاری)",className:"bg-white",...e.getFieldProps("title"),errorMessage:e.touched.title&&e.errors.title?e.errors.title:null}),t.jsx(c,{labelText:"متن دکمه",placeholder:"متن دکمه را وارد کنید (اختیاری)",className:"bg-white",...e.getFieldProps("buttonText"),errorMessage:e.touched.buttonText&&e.errors.buttonText?e.errors.buttonText:null}),t.jsx(c,{labelText:"لینک دکمه",placeholder:"لینک دکمه را وارد کنید (اختیاری)",className:"bg-white",...e.getFieldProps("buttonLink"),errorMessage:e.touched.buttonLink&&e.errors.buttonLink?e.errors.buttonLink:null}),t.jsx(c,{labelText:"ترتیب نمایش",placeholder:"ترتیب نمایش را وارد کنید",type:"number",className:"bg-white",...e.getFieldProps("order"),errorMessage:e.touched.order&&e.errors.order?e.errors.order:null})]}),t.jsx(L,{labelText:"توضیحات",placeholder:"توضیحات بنر را وارد کنید (اختیاری)",optional:!0,value:e.values.description,onChange:r=>{e.setFieldValue("description",r),e.setFieldTouched("description",!0)},errorMessage:e.touched.description&&e.errors.description?e.errors.description:null}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"وضعیت انتشار"}),t.jsx("div",{className:"flex items-center gap-4 mr-4",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.values.published,onChange:r=>e.setFieldValue("published",r.target.checked),className:"w-5 h-5 rounded border-2 border-main-border-color text-primary focus:ring-2 focus:ring-primary"}),t.jsx("span",{className:"text-dark font-estedad-light",children:"منتشر شده"})]})})]}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:["تصویر بنر",t.jsx("span",{className:"text-red-500 mr-1",children:"*"})]}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden",onChange:r=>{const i=r.target.files?.[0]||null;e.setFieldValue("heroSliderImage",i)}}),t.jsx("button",{type:"button",onClick:()=>{n.current?.click()},className:"px-8 py-3 rounded-lg font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60 transition-colors",children:"انتخاب فایل"}),e.values.heroSliderImage instanceof File&&t.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.heroSliderImage.name}),l&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[t.jsx("img",{src:I(s.image),alt:"Banner",className:"w-32 h-20 rounded-lg object-cover"}),t.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"})]})]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[o?"ویرایش بنر":"ایجاد بنر",e.isSubmitting&&t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{K as B};
