import{j as e,b as W}from"./query-vendor-KlcNboas.js";import{a as f}from"./react-vendor-vqeg7uDR.js";import{c as $,N as X,l as I,T as Y,m as A,a2 as E,A as Z,G as ee,O as te,a1 as se,S as ae,C as le,Q as re,R as ie,h as M,i as T}from"./index-D-ec5iYs.js";import{a as ne,b as oe,c as de,d as ce,e as xe}from"./useDoctorApplications-CwxrXZHN.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function me(s){const t=$.c(17),{applications:i,isLoadingApplications:a,page:l,onDeleteClick:m,onMarkAsRead:j,onMarkAsUnread:u,onApplicationClick:b,onRefetch:p,isRefetching:g}=s,d=g===void 0?!1:g;let c;t[0]!==d||t[1]!==p?(c=p&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:p,disabled:d,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[d?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=d,t[1]=p,t[2]=c):c=t[2];let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"نام و نام خانوادگی"}),e.jsx("th",{children:"نوع درخواست"}),e.jsx("th",{children:"ایمیل"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"اطلاعات متقاضی"}),e.jsx("th",{children:"کلینیک"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=o):o=t[3];let h;t[4]!==i||t[5]!==a||t[6]!==b||t[7]!==m||t[8]!==j||t[9]!==u||t[10]!==l?(h=a?e.jsx(X,{rows:5,columns:10}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center p-8 font-estedad-light",children:"درخواستی یافت نشد"})}):i.map((r,w)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${r.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(l-1)*5+w+1}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-user text-primary"})}),e.jsx("div",{children:e.jsxs("p",{className:"font-estedad-light line-clamp-2 max-w-[300px] min-w-[220px]",children:[r.firstName," ",r.lastName]})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:r.applicationType==="DENTIST"?e.jsxs("span",{className:"px-3 py-1.5 text-xs rounded-lg bg-blue-100 text-blue-700 font-estedad-semibold flex items-center gap-1.5 w-fit",children:[e.jsx("i",{className:"fas fa-user-md"}),"دندانپزشک"]}):e.jsxs("span",{className:"px-3 py-1.5 text-xs rounded-lg bg-purple-100 text-purple-700 font-estedad-semibold flex items-center gap-1.5 w-fit",children:[e.jsx("i",{className:"fas fa-user-nurse"}),"نرس"]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:r.email||e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:r.phoneNumber}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("button",{onClick:()=>b(r),className:"line-clamp-2 max-w-[260px] min-w-[200px] text-right hover:text-primary transition-colors cursor-pointer",title:"کلیک برای مشاهده کامل اطلاعات",children:r.doctorInfo})}),e.jsx("td",{className:"text-dark font-estedad-light",children:r.clinic?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary text-nowrap",children:r.clinic.name}):e.jsx("span",{className:"text-paragray ",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:r.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap",children:"خوانده نشده"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:I(new Date(r.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[r.read?e.jsx("button",{onClick:()=>u(r.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده نشده",children:e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>j(r.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده شده",children:e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>m(r.id,`${r.firstName} ${r.lastName}`),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},r.id)),t[4]=i,t[5]=a,t[6]=b,t[7]=m,t[8]=j,t[9]=u,t[10]=l,t[11]=h):h=t[11];let n;t[12]!==h?(n=e.jsx(Y,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[o,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:h})]})}),t[12]=h,t[13]=n):n=t[13];let y;return t[14]!==c||t[15]!==n?(y=e.jsxs(e.Fragment,{children:[c,n]}),t[14]=c,t[15]=n,t[16]=y):y=t[16],y}function pe(){const s=$.c(3),{data:t,isLoading:i}=ne();let a;if(s[0]!==i||s[1]!==t?.data){const l=t?.data||{total:0,read:0,unread:0},m=[{title:"کل درخواست‌ها",value:l.total,icon:"far fa-envelope",bgColor:"bg-blue-100",iconColor:"text-primary",isLoading:i},{title:"خوانده شده",value:l.read,icon:"far fa-envelope-open",bgColor:"bg-green-100",iconColor:"text-green-500",isLoading:i},{title:"خوانده نشده",value:l.unread,icon:"far fa-envelope",bgColor:"bg-orange-100",iconColor:"text-orange-500",isLoading:i}];a=e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:m.map(he)}),s[0]=i,s[1]=t?.data,s[2]=a}else a=s[2];return a}function he(s,t){return e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:s.title}),s.isLoading?e.jsx("div",{className:"mt-2 h-8 w-20 bg-gray-200 rounded animate-pulse"}):e.jsx("h3",{className:"text-2xl font-estedad-semibold mt-2",children:s.value.toLocaleString("fa-IR")})]}),e.jsx("div",{className:`w-12 h-12 shrink-0 ${s.bgColor} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${s.icon} ${s.iconColor} text-xl`})})]})},t)}function fe(s){const t=$.c(19),{isOpen:i,onClose:a,application:l}=s;let m,j;t[0]!==i||t[1]!==a?(m=()=>{const o=h=>{h.key==="Escape"&&i&&a()};return i&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow="unset"}},j=[i,a],t[0]=i,t[1]=a,t[2]=m,t[3]=j):(m=t[2],j=t[3]),f.useEffect(m,j);let u;t[4]!==a?(u=o=>{o.target===o.currentTarget&&a()},t[4]=a,t[5]=u):u=t[5];const b=u;let p,g,d;if(t[6]!==l||t[7]!==b||t[8]!==i||t[9]!==a){let o=[];if(l?.documents)try{let n;t[13]!==l?(n=JSON.parse(l.documents),t[13]=l,t[14]=n):n=t[14],o=n}catch(n){console.error("Error parsing documents:",n)}const h=ue;p=Z,g="wait",d=i&&l&&e.jsxs(A.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:b,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(A.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(A.div,{className:"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30,duration:.3},children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:"far fa-user-md text-white text-xl"})}),e.jsx("h3",{className:"text-xl font-estedad-semibold text-white",children:"مشاهده درخواست همکاری"})]}),e.jsx(A.button,{onClick:a,className:"w-9 h-9 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 hover:bg-white/30 hover:border-white/40 flex items-center justify-center transition-all duration-200 group","aria-label":"بستن",children:e.jsx("i",{className:"fa fa-times text-sm text-white/90 group-hover:text-white transition-colors"})})]})}),e.jsx("div",{className:"px-6 py-6 overflow-y-auto flex-1 admin-modal-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"نام و نام خانوادگی"}),e.jsxs("p",{className:"text-dark font-estedad-light text-base",children:[l.firstName," ",l.lastName]})]}),l.email&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"ایمیل"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:l.email})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"شماره تماس"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:l.phoneNumber})]}),l.clinic&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"کلینیک"}),e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary inline-block",children:l.clinic.name})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"اطلاعات متقاضی"}),e.jsx("p",{className:"text-dark font-estedad-light text-base leading-7 whitespace-pre-wrap",children:l.doctorInfo})]}),o.length>0&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-2",children:"مدارک ارسال شده"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((n,y)=>{const r=h(n),w=n.split("/").pop()||`مدرک ${y+1}`,k=/\.(jpg|jpeg|png|gif)$/i.test(n),v=/\.pdf$/i.test(n);return e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:[k?e.jsx("i",{className:"far fa-image"}):v?e.jsx("i",{className:"far fa-file-pdf"}):e.jsx("i",{className:"far fa-file"}),e.jsx("span",{className:"text-sm",children:w}),e.jsx("i",{className:"far fa-external-link-alt text-xs"})]},y)})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ ارسال"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:I(new Date(l.createdAt))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"وضعیت"}),l.read?e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-green-100 text-green-700 inline-block",children:"خوانده شده"}):e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-700 inline-block",children:"خوانده نشده"})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:a,className:"px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors",children:"بستن"})})})]})]}),t[6]=l,t[7]=b,t[8]=i,t[9]=a,t[10]=p,t[11]=g,t[12]=d}else p=t[10],g=t[11],d=t[12];let c;return t[15]!==p||t[16]!==g||t[17]!==d?(c=e.jsx(p,{mode:g,children:d}),t[15]=p,t[16]=g,t[17]=d,t[18]=c):c=t[18],c}function ue(s){if(!s)return"";if(/^https?:\/\//i.test(s))return s;if(E){const t=s.startsWith("/")?s:`/${s}`;return`${E}${t}`}return s}function Ae(){const{setHeaderConfig:s}=ee(),[t,i]=f.useState(1),[a,l]=f.useState(""),[m]=te(a,500),[j,u]=f.useState(!1),[b,p]=f.useState(void 0),[g,d]=f.useState(!1),[c,o]=f.useState(null),[h,n]=f.useState(!1),[y,r]=f.useState(!1),[w,k]=f.useState(null),v=W(),{mutateAsync:L}=oe(),{mutateAsync:O}=de(),{mutateAsync:Q}=ce(),{refetch:C}=se(),{data:R,isLoading:S,isPending:U,refetch:_,isFetching:q}=xe(t,5,m,b);f.useEffect(()=>(s({title:"مدیریت درخواست‌های همکاری پزشکان"}),()=>{s({title:void 0,backButton:!1})}),[s]),f.useEffect(()=>{a.trim()?u(!0):u(!1)},[a]),f.useEffect(()=>{S||m===a&&u(!1)},[S,m,a]);const K=(x,N)=>{o({id:x,name:N}),d(!0)},P=async()=>{if(c){n(!0);try{await C(),await L(c.id),M("درخواست با موفقیت حذف شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]}),d(!1),o(null)}catch(x){const N=x?.response?.data?.message||"خطایی در حذف درخواست رخ داد";T(N)}finally{n(!1)}}},F=()=>{h||(d(!1),o(null))},V=async x=>{try{await C(),await O(x),M("درخواست به عنوان خوانده شده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]})}catch(N){const D=N?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت درخواست رخ داد";T(D)}},z=async x=>{try{await C(),await Q(x),M("درخواست به عنوان خوانده نشده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]})}catch(N){const D=N?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت درخواست رخ داد";T(D)}},B=x=>{k(x),r(!0)},G=()=>{r(!1),k(null)},H=R?.data?.applications||[],J=R?.meta;return e.jsxs("main",{children:[e.jsxs(ae,{children:[e.jsx(pe,{}),e.jsx("h5",{className:"main-header ",children:"لیست درخواست‌ها"}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row  justify-between gap-4",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(le,{labelText:"جستجو",placeholder:"جستجو بر اساس نام، ایمیل، شماره تماس یا اطلاعات...",className:"bg-white pr-12",value:a,onChange:x=>{l(x.target.value),i(1)}}),j&&a&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("label",{className:"text-sm font-estedad-semibold mb-2",children:"فیلتر وضعیت:"}),e.jsxs("select",{value:b===void 0?"all":b?"read":"unread",onChange:x=>{const N=x.target.value;p(N==="all"?void 0:N==="read"),i(1)},className:"px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"همه"}),e.jsx("option",{value:"read",children:"خوانده شده"}),e.jsx("option",{value:"unread",children:"خوانده نشده"})]})]})]}),e.jsx(me,{applications:H,isLoadingApplications:S||U,page:t,onDeleteClick:K,onMarkAsRead:V,onMarkAsUnread:z,onApplicationClick:B,onRefetch:_,isRefetching:q}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(re,{meta:J,onPageChange:x=>i(x)})})]}),e.jsx(ie,{isOpen:g,onClose:F,onConfirm:P,title:"حذف درخواست",message:`آیا از حذف درخواست ${c?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:h}),e.jsx(fe,{isOpen:y,onClose:G,application:w})]})}export{Ae as default};
