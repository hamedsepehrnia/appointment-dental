import{j as e,b as D}from"./query-vendor-KlcNboas.js";import{e as T,a as j}from"./react-vendor-vqeg7uDR.js";import{c as G,N as I,g as k,s as S,l as M,T as R,G as E,S as L,Q as P,R as A,h as F,i as H}from"./index-z67mRg2p.js";import{a as O,u as Q}from"./useGallery-DRVfrwX0.js";import{G as U}from"./GalleryManagementForm-D0T-wU_4.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function $(h){const t=G.c(15),{images:m,isLoadingImages:g,page:i,onDeleteClick:d,onRefetch:a,isRefetching:f}=h,o=f===void 0?!1:f,p=T();let l;t[0]!==o||t[1]!==a?(l=a&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:a,disabled:o,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[o?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=o,t[1]=a,t[2]=l):l=t[2];let c;t[3]===Symbol.for("react.memo_cache_sentinel")?(c=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"تصویر"}),e.jsx("th",{children:"عنوان"}),e.jsx("th",{children:"توضیحات"}),e.jsx("th",{children:"ترتیب"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=c):c=t[3];let r;t[4]!==m||t[5]!==g||t[6]!==p||t[7]!==d||t[8]!==i?(r=g?e.jsx(I,{rows:5,columns:8}):m.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"تصویری یافت نشد"})}):m.map((s,N)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(i-1)*5+N+1}),e.jsx("td",{className:"",children:e.jsx("div",{className:"flex items-center justify-center",children:s.image&&typeof s.image=="string"&&s.image.trim()!==""?e.jsx("img",{src:k(s.image),alt:s.title||"تصویر گالری",className:"w-16 h-16 rounded-lg object-cover shrink-0",onError:w=>{console.error("Image load error:",{imagePath:s.image,imageUrl:k(s.image),imageId:s.id});const y=w.target;y.style.display="none";const b=y.parentElement;b&&(b.innerHTML=`
                                <div class="w-16 h-16 rounded-lg bg-gray-200 flex items-center justify-center shrink-0">
                                  <i class="far fa-image text-gray-400 text-2xl"></i>
                                </div>
                              `)},onLoad:()=>{console.log("Image loaded successfully:",{imagePath:s.image,imageUrl:k(s.image),imageId:s.id})}}):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-200 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-image text-gray-400 text-2xl"})})})}),e.jsx("td",{className:"",children:e.jsx("p",{className:"font-estedad-light line-clamp-2 max-w-[300px] min-w-[220px]",children:s.title||"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.description?e.jsx("span",{className:"line-clamp-2 max-w-[300px] min-w-[220px]",children:S(s.description)}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:s.order}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 text-nowrap",children:"پیش‌نویس"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:M(new Date(s.createdAt||new Date))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{p(`/admin/gallery-management/edit/${s.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>d(s.id,s.title||"تصویر بدون عنوان"),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},s.id)),t[4]=m,t[5]=g,t[6]=p,t[7]=d,t[8]=i,t[9]=r):r=t[9];let n;t[10]!==r?(n=e.jsx(R,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[c,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:r})]})}),t[10]=r,t[11]=n):n=t[11];let x;return t[12]!==l||t[13]!==n?(x=e.jsxs(e.Fragment,{children:[l,n]}),t[12]=l,t[13]=n,t[14]=x):x=t[14],x}function Y(){const{setHeaderConfig:h}=E(),[t,m]=j.useState(1),[g,i]=j.useState(!1),[d,a]=j.useState(null),[f,o]=j.useState(!1),p=D(),{mutateAsync:l}=O(),{data:c,isLoading:r,isPending:n,refetch:x,isFetching:s}=Q(t,5);j.useEffect(()=>(h({title:"مدیریت گالری"}),()=>{h({title:void 0,backButton:!1})}),[h]);const N=(u,v)=>{a({id:u,title:v}),i(!0)},w=async()=>{if(d){o(!0);try{await l(d.id),F("تصویر با موفقیت حذف شد"),p.invalidateQueries({queryKey:["gallery"]}),i(!1),a(null)}catch(u){const v=u?.response?.data?.message||"خطایی در حذف تصویر رخ داد";H(v)}finally{o(!1)}}},y=()=>{f||(i(!1),a(null))},b=c?.data?.images||[],C=c?.meta;return e.jsxs("main",{children:[e.jsxs(L,{children:[e.jsx("h5",{className:"main-header ",children:"لیست تصاویر"}),e.jsx($,{images:b,isLoadingImages:r||n,page:t,onDeleteClick:N,onRefetch:x,isRefetching:s}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(P,{meta:C,onPageChange:u=>m(u)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(U,{})]}),e.jsx(A,{isOpen:g,onClose:y,onConfirm:w,title:"حذف تصویر",message:`آیا از حذف تصویر ${d?.title} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:f})]})}export{Y as default};
