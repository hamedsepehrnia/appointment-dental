import{b as w,j as e}from"./query-vendor-KlcNboas.js";import{a as t}from"./react-vendor-vqeg7uDR.js";import{G as I,a9 as C,aa as E,ab as M,i as r,S as u,h as b}from"./index-DIHBjxzH.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function q(){const{setHeaderConfig:o}=I(),g=w(),{data:j,isLoading:y,error:f}=C(),m=E(),x=M(),[s,i]=t.useState("SMS"),[l,h]=t.useState(""),[n,N]=t.useState(!1),[d,v]=t.useState(""),[p,k]=t.useState(""),c=j?.data?.notificationSettings;t.useEffect(()=>(o({title:"تنظیمات نوتیفیکیشن"}),()=>{o({title:void 0,backButton:!1})}),[o]),t.useEffect(()=>{c&&i(c.method)},[c]),t.useEffect(()=>{f&&r("خطا در دریافت تنظیمات")},[f]);const S=async()=>{if((s==="EITAA"||s==="BOTH")&&!l.trim()){r("برای استفاده از ایتا، توکن API الزامی است");return}try{await m.mutateAsync({method:s,eitaaApiToken:l.trim()||null}),g.invalidateQueries({queryKey:["notificationSettings"]}),h(""),b("تنظیمات با موفقیت ذخیره شد")}catch(a){r(a.response?.data?.message||"خطا در ذخیره تنظیمات")}},T=async()=>{if(!d.trim()||!p.trim()){r("توکن API و شناسه کانال/گروه الزامی است");return}try{await x.mutateAsync({token:d.trim(),chatId:p.trim()}),b("اتصال برقرار است! پیام تست ارسال شد."),h(d.trim())}catch(a){r(a.response?.data?.message||"خطا در تست اتصال")}};return y?e.jsx("main",{children:e.jsx(u,{children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"})})})}):e.jsx("main",{children:e.jsxs(u,{children:[e.jsx("h5",{className:"main-header mb-6",children:"تنظیمات نوتیفیکیشن منشی‌ها"}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:[e.jsx("h6",{className:"text-lg font-estedad-semibold text-dark mb-4",children:"روش ارسال نوتیفیکیشن به منشی‌ها"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("label",{className:`relative flex flex-col p-6 rounded-xl border-2 cursor-pointer transition-all ${s==="SMS"?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"method",value:"SMS",checked:s==="SMS",onChange:()=>i("SMS"),className:"sr-only"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${s==="SMS"?"border-primary bg-primary":"border-gray-300"}`,children:s==="SMS"&&e.jsx("i",{className:"fas fa-check text-white text-xs"})}),e.jsx("span",{className:"text-lg font-estedad-semibold text-dark",children:"فقط SMS"})]}),e.jsx("p",{className:"text-sm text-gray-600 font-estedad-light leading-relaxed",children:"نوتیفیکیشن‌ها فقط از طریق پیامک ارسال می‌شوند"})]}),e.jsxs("label",{className:`relative flex flex-col p-6 rounded-xl border-2 cursor-pointer transition-all ${s==="EITAA"?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"method",value:"EITAA",checked:s==="EITAA",onChange:()=>i("EITAA"),className:"sr-only"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${s==="EITAA"?"border-primary bg-primary":"border-gray-300"}`,children:s==="EITAA"&&e.jsx("i",{className:"fas fa-check text-white text-xs"})}),e.jsx("span",{className:"text-lg font-estedad-semibold text-dark",children:"فقط ایتا"})]}),e.jsx("p",{className:"text-sm text-gray-600 font-estedad-light leading-relaxed",children:"نوتیفیکیشن‌ها فقط از طریق ایتا ارسال می‌شوند. منشی‌ها می‌توانند از طریق ایتا نوبت را تایید/رد کنند"})]}),e.jsxs("label",{className:`relative flex flex-col p-6 rounded-xl border-2 cursor-pointer transition-all ${s==="BOTH"?"border-primary bg-primary/5":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"radio",name:"method",value:"BOTH",checked:s==="BOTH",onChange:()=>i("BOTH"),className:"sr-only"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center ${s==="BOTH"?"border-primary bg-primary":"border-gray-300"}`,children:s==="BOTH"&&e.jsx("i",{className:"fas fa-check text-white text-xs"})}),e.jsx("span",{className:"text-lg font-estedad-semibold text-dark",children:"هر دو"})]}),e.jsx("p",{className:"text-sm text-gray-600 font-estedad-light leading-relaxed",children:"نوتیفیکیشن‌ها هم از طریق SMS و هم از طریق ایتا ارسال می‌شوند"})]})]})]}),(s==="EITAA"||s==="BOTH")&&e.jsxs("div",{className:"bg-white rounded-xl border-2 border-gray-200 p-6",children:[e.jsx("h6",{className:"text-lg font-estedad-semibold text-dark mb-4",children:"تنظیمات ایتا"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-blue-50 rounded-lg border border-blue-200 p-4",children:[e.jsxs("h6",{className:"text-md font-estedad-medium text-blue-800 mb-3",children:[e.jsx("i",{className:"fas fa-flask ml-2"}),"تست اتصال"]}),e.jsx("p",{className:"text-sm text-blue-700 mb-4 font-estedad-light",children:"ابتدا اتصال را تست کنید تا مطمئن شوید تنظیمات درست است"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"توکن API ایتا (برای تست)"}),e.jsx("input",{type:"text",value:d,onChange:a=>v(a.target.value),placeholder:"توکن API از eitaayar.ir",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-700 mb-1",children:"شناسه کانال/گروه (برای تست)"}),e.jsx("input",{type:"text",value:p,onChange:a=>k(a.target.value),placeholder:"شناسه کانال یا username",className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:border-primary"})]})]}),e.jsx("button",{onClick:T,disabled:x.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50",children:x.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin ml-2"}),"در حال تست..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check ml-2"}),"تست اتصال"]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-estedad-medium text-dark mb-2",children:"توکن API ایتا"}),e.jsxs("p",{className:"text-xs text-gray-500 mb-2",children:["توکن API را از"," ",e.jsx("a",{href:"https://eitaayar.ir",target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:underline",children:"eitaayar.ir"})," ","دریافت کنید"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:n?"text":"password",value:l,onChange:a=>h(a.target.value),placeholder:"توکن API ایتا",className:"flex-1 px-4 py-2.5 bg-white border-2 border-gray-300 rounded-lg focus:outline-none focus:border-primary text-dark font-estedad-light"}),e.jsx("button",{onClick:()=>N(!n),className:"p-2 text-gray-600 hover:text-dark",title:n?"مخفی کردن":"نمایش",children:e.jsx("i",{className:`fas ${n?"fa-eye-slash":"fa-eye"}`})})]}),c?.hasEitaaToken&&!l&&e.jsxs("p",{className:"text-xs text-green-600 mt-1",children:[e.jsx("i",{className:"fas fa-check-circle ml-1"}),"توکن قبلاً تنظیم شده است"]})]}),e.jsxs("div",{className:"bg-sky-50 rounded-lg border border-sky-200 p-4",children:[e.jsxs("h6",{className:"text-sm font-estedad-semibold text-sky-800 mb-2",children:[e.jsx("i",{className:"fas fa-info-circle ml-2"}),"راهنمای استفاده"]}),e.jsxs("div",{className:"text-xs text-sky-700 space-y-1 font-estedad-light",children:[e.jsx("p",{children:"• شناسه کانال/گروه ایتا برای هر کلینیک در بخش مدیریت کلینیک‌ها تنظیم می‌شود"}),e.jsx("p",{children:"• منشی‌ها می‌توانند از طریق ایتا نوبت را تایید/رد کنند"}),e.jsx("p",{children:"• در پیام ایتا لینک‌های تایید، رد و تماس با مراجع ارسال می‌شود"}),e.jsx("p",{children:"• برای ویرایش نوبت باید به پنل ادمین مراجعه کنید"})]})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:S,disabled:m.isPending,className:"purple-btn",children:m.isPending?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-spinner fa-spin ml-2"}),"در حال ذخیره..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-save ml-2"}),"ذخیره تنظیمات"]})})})]})]})})}export{q as default};
