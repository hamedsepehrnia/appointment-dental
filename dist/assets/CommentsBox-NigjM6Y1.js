import{j as e,g as v}from"./react-core-DkX7OQ4Q.js";import{c as C,b as w,a as $,F}from"./forms-CxDKTD82.js";import{u as S,a as V}from"./useComments-C6jH40mx.js";import{b as I}from"./query-x6gLKhnn.js";import{s as q,i as A,e as P,m as N,L as E}from"./index-DUiqV2No.js";const _=C({content:$().required("متن نظر الزامی است").min(3,"نظر باید حداقل ۳ کاراکتر باشد").max(1e3,"نظر نباید بیشتر از ۱۰۰۰ کاراکتر باشد"),rating:w().integer("امتیاز باید عدد صحیح باشد").min(1,"امتیاز باید بین ۱ تا ۵ باشد").max(5,"امتیاز باید بین ۱ تا ۵ باشد").required("امتیاز الزامی است")});function U({doctorId:t,articleId:s,serviceId:f}){const u=I(),{mutateAsync:y,isPending:c}=S(),p=async(a,r)=>{try{const n=t||s||f||"",i=t?"doctor":s?"article":"service";await y({comment:{content:a.content,rating:a.rating},type:i,id:n}),q("نظر شما با موفقیت ثبت شد و در انتظار تایید مدیر است"),u.invalidateQueries({queryKey:["comments-infinite",n,i]}),u.invalidateQueries({queryKey:["comments",n,i]}),r()}catch(n){console.error("Error submitting comment:",n),A("خطایی در ثبت نظر رخ داد")}};return e.jsxs("div",{className:"p-4 md:p-7.5 section-border rounded-[10px]",children:[e.jsx("h2",{className:"text-2xl font-estedad-semibold text-dark mb-6",children:"ارسال دیدگاه"}),e.jsx(F,{initialValues:{content:"",rating:5},validationSchema:_,onSubmit:(a,{resetForm:r})=>p(a,r),children:a=>e.jsxs("form",{onSubmit:a.handleSubmit,className:"space-y-6",children:[e.jsxs("div",{className:"flex gap-1 mb-6",children:[e.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=1?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",1)}),e.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=2?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",2)}),e.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=3?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",3)}),e.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=4?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",4)}),e.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=5?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",5)})]}),a.touched.rating&&a.errors.rating&&e.jsx("div",{className:"text-red-500 text-sm",children:a.errors.rating}),e.jsxs("div",{children:[e.jsx("textarea",{rows:4,placeholder:"ارسال دیدگاه...",className:`w-full px-6 py-4 border rounded-2xl focus:outline-none ${a.touched.content&&a.errors.content?"border-red-500":"border-gray-200 focus:border-accent"}`,...a.getFieldProps("content")}),a.touched.content&&a.errors.content&&e.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.errors.content})]}),e.jsx("button",{type:"submit",className:"bg-accent text-white px-8 py-4 rounded-full hover:bg-secondary transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",disabled:c||!a.isValid,children:c?"در حال ارسال...":"ارسال سریع"})]})})]})}function H(t){const s=v.c(20),{doctorId:f,articleId:u,serviceId:y}=t,{data:c,isLoading:p,fetchNextPage:a,hasNextPage:r,isFetchingNextPage:n}=V(f||u||y||"",f?"doctor":u?"article":"service",5);let i,l,d,o,x;if(s[0]!==c?.pages||s[1]!==r||s[2]!==p){x=Symbol.for("react.early_return_sentinel");e:{const h=c?.pages.flatMap(K).filter(D)||[],b=r?c?.pages[0]?.meta?.total??h.length:h.length;if(p){let j;s[8]===Symbol.for("react.memo_cache_sentinel")?(j=e.jsx(E,{}),s[8]=j):j=s[8],x=j;break e}i="section-border p-4 md:p-7.5",s[9]===Symbol.for("react.memo_cache_sentinel")?(l=e.jsx("div",{}),s[9]=l):l=s[9],d=e.jsxs("h2",{className:"text-2xl font-estedad-semibold ",children:["دیدگاه‌ها (",b,")"]}),o=h.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-paragray font-estedad-light text-lg",children:"هنوز دیدگاهی ثبت نشده است."})}):e.jsx("div",{className:"space-y-6",children:h.map(L)})}s[0]=c?.pages,s[1]=r,s[2]=p,s[3]=i,s[4]=l,s[5]=d,s[6]=o,s[7]=x}else i=s[3],l=s[4],d=s[5],o=s[6],x=s[7];if(x!==Symbol.for("react.early_return_sentinel"))return x;let m;s[10]!==a||s[11]!==r||s[12]!==n?(m=r&&e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx("button",{onClick:()=>a(),disabled:n,className:"main-btn ",children:n?e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("i",{className:"fas fa-spinner fa-spin"}),e.jsx("span",{children:"در حال بارگذاری..."})]}):e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("span",{children:"مشاهده نظرات بیشتر"}),e.jsx("i",{className:"fas fa-chevron-down"})]})})}),s[10]=a,s[11]=r,s[12]=n,s[13]=m):m=s[13];let g;return s[14]!==i||s[15]!==l||s[16]!==d||s[17]!==o||s[18]!==m?(g=e.jsxs("div",{className:i,children:[l,d,o,m]}),s[14]=i,s[15]=l,s[16]=d,s[17]=o,s[18]=m,s[19]=g):g=s[19],g}function L(t){return e.jsx("div",{className:"border-t-[1.5px] border-[rgba(94,91,91,0.09)] pt-6 mt-6 ",children:e.jsxs("div",{className:"grid  sm:grid-cols-[auto_1fr]  gap-4 ",children:[t.user?.profileImage?e.jsx("img",{src:P(t.user.profileImage),alt:`${t.user.firstName} ${t.user.lastName}`,className:"size-20 rounded-full shrink-0 justify-self-center object-cover"}):e.jsx("div",{className:"size-20 rounded-full shrink-0 justify-self-center bg-gray-200 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-user text-gray-400 text-2xl"})}),e.jsxs("div",{className:"flex-1  space-y-2.5",children:[e.jsxs("div",{className:"flex items-start justify-between  flex-wrap  gap-4",children:[e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("h4",{className:"font-estedad-semibold text-xl",children:[t.user.firstName," ",t.user.lastName]}),e.jsxs("div",{className:"flex gap-1 text-secondary",children:[Array.from({length:t.rating||0}).map(B),Array.from({length:5-(t.rating||0)}).map(z)]})]}),e.jsxs("span",{className:"text-sm text-paragray flex items-center gap-x-1.5 font-estedad-light",children:[e.jsx("i",{className:"far fa-clock "}),N(new Date(t.createdAt))]})]}),e.jsx("p",{className:"text-paragray font-estedad-light",children:t.content}),t.replies&&t.replies.length>0&&t.published===!0&&e.jsx("div",{className:"mt-4 pr-4 space-y-4 border-r-2 border-primary/20",children:t.replies.map(Q)})]})]})},t.id)}function Q(t){return e.jsxs("div",{className:"bg-primary/10 rounded-lg p-4 border-r-4 border-primary/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx("i",{className:"far fa-user text-primary text-xs"})}),e.jsxs("span",{className:"text-sm font-estedad-medium text-dark",children:[t.user.firstName," ",t.user.lastName]})]}),e.jsx("span",{className:"text-xs text-paragray font-estedad-light",children:N(new Date(t.createdAt))})]}),e.jsx("p",{className:"text-paragray font-estedad-light text-sm leading-6 whitespace-pre-wrap",children:t.content})]},t.id)}function z(t,s){return e.jsx("i",{className:"fas fa-star text-gray-300"},s)}function B(t,s){return e.jsx("i",{className:"fas fa-star"},s)}function D(t){return t.published===!0}function K(t){return t?.data?.comments||[]}export{H as C,U as a};
