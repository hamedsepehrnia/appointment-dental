import{j as t}from"./query-DkYU0mMV.js";import{O as j,E as w,H as C,P as I,C as p,j as S,f as y,c as x,s as v,K as F,k as T,V as E,a0 as M}from"./index-CjdPVZci.js";import{r as m}from"./react-router-BDAfChV3.js";import{c as P,a as c,F as A}from"./forms-C2N9TMf6.js";import{S as L,c as R}from"./ui-base-vsthQ4vg.js";import"./react-core-DwtKV0qF.js";import"./redux-BgAWEerc.js";import"./motion-CQyDv_CV.js";import"./swiper-C43kgiy-.js";const D=a=>{const l=x.c(3);let s;l[0]===Symbol.for("react.memo_cache_sentinel")?(s=t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),l[0]=s):s=l[0];let n;return l[1]!==a?(n=t.jsx(R.DropdownIndicator,{...a,children:s}),l[1]=a,l[2]=n):n=l[2],n},h=[{value:"MALE",label:"مرد"},{value:"FEMALE",label:"زن"},{value:"OTHER",label:"سایر"}];function V(){const a=m.useRef(null),l=j(),s=w(e=>e.user.data),{mutateAsync:n}=C(),[i,u]=m.useState(!1),f=m.useMemo(()=>P({firstName:c().required("نام الزامی است").min(2,"نام باید حداقل ۲ کاراکتر باشد").max(50,"نام باید حداکثر ۵۰ کاراکتر باشد"),lastName:c().required("نام خانوادگی الزامی است").min(2,"نام خانوادگی باید حداقل ۲ کاراکتر باشد").max(50,"نام خانوادگی باید حداکثر ۵۰ کاراکتر باشد"),nationalCode:c().test("is-valid-national-code","کد ملی نامعتبر است",e=>!e||e.length===0?!0:e.length!==10?!1:I(e)).nullable(),address:c().max(500,"آدرس نباید بیشتر از ۵۰۰ کاراکتر باشد"),gender:c().oneOf(["MALE","FEMALE","OTHER"],"جنسیت نامعتبر است").nullable()}),[]),b=async(e,d)=>{try{const r=new FormData;r.append("firstName",e.firstName),r.append("lastName",e.lastName),e.nationalCode?r.append("nationalCode",e.nationalCode):r.append("nationalCode",""),e.address?r.append("address",e.address):r.append("address",""),e.gender&&r.append("gender",e.gender),e.profileImage&&r.append("profileImage",e.profileImage),i&&r.append("removeProfileImage","true");const o=await n(r);if(v("پروفایل با موفقیت به‌روزرسانی شد"),o?.data?.user){const N={...o.data.user,role:s?.role||o.data.user.role};l(F(N))}u(!1),d("profileImage",null),a.current&&(a.current.value="");const g=document.querySelector(".overflow-auto");g?g.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}catch(r){const o=r?.response?.data?.message||"خطایی در به‌روزرسانی پروفایل رخ داد";T(o)}};return t.jsx(A,{initialValues:{firstName:s?.firstName||"",lastName:s?.lastName||"",nationalCode:s?.nationalCode||"",address:s?.address||"",gender:s?.gender||null,profileImage:null},validationSchema:f,enableReinitialize:!0,onSubmit:async(e,d)=>{await b({firstName:e.firstName,lastName:e.lastName,nationalCode:e.nationalCode||null,address:e.address||null,gender:e.gender||null,profileImage:e.profileImage},d.setFieldValue)},children:e=>{const d=s?.profileImage&&!e.values.profileImage&&!i;return t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(p,{labelText:"نام",placeholder:"نام را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("firstName"),errorMessage:e.touched.firstName&&e.errors.firstName?String(e.errors.firstName):null}),t.jsx(p,{labelText:"نام خانوادگی",placeholder:"نام خانوادگی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("lastName"),errorMessage:e.touched.lastName&&e.errors.lastName?String(e.errors.lastName):null}),t.jsx(p,{labelText:"کد ملی",placeholder:"کد ملی را وارد کنید",optional:!0,className:"bg-white",...e.getFieldProps("nationalCode"),errorMessage:e.touched.nationalCode&&e.errors.nationalCode?String(e.errors.nationalCode):null}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"جنسیت"}),t.jsx(L,{options:h,value:h.find(r=>r.value===e.values.gender)||null,onChange:r=>{e.setFieldValue("gender",r?.value||null),e.setFieldTouched("gender",!0)},onBlur:()=>e.setFieldTouched("gender",!0),placeholder:"جنسیت را انتخاب کنید",isClearable:!0,components:{DropdownIndicator:D},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:r,isSelected:o})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${o?"!bg-primary text-white !cursor-pointer":r?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}})]})]}),t.jsx(S,{labelText:"آدرس",placeholder:"آدرس را وارد کنید",optional:!0,rows:3,className:"bg-white",...e.getFieldProps("address"),errorMessage:e.touched.address&&e.errors.address?String(e.errors.address):null}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر پروفایل"}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsx("input",{ref:a,type:"file",accept:"image/*",className:"hidden",onChange:r=>{const o=r.target.files?.[0]||null;e.setFieldValue("profileImage",o),u(!1)}}),t.jsx("button",{type:"button",onClick:()=>{a.current?.click(),u(!1)},className:"px-8 py-3 rounded-lg font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60 transition-colors",children:"انتخاب فایل"}),e.values.profileImage instanceof File&&t.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.profileImage.name}),d&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center",children:[t.jsx("img",{src:y(s.profileImage),alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}),t.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),t.jsx("button",{type:"button",onClick:()=>{u(!0),e.setFieldValue("profileImage",null),a.current&&(a.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),i&&t.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:["به‌روزرسانی پروفایل",e.isSubmitting&&t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}function G(){const a=x.c(4),{setHeaderConfig:l}=E();let s,n;a[0]!==l?(s=()=>(l({title:"مدیریت پروفایل"}),()=>{l({title:void 0,backButton:!1})}),n=[l],a[0]=l,a[1]=s,a[2]=n):(s=a[1],n=a[2]),m.useEffect(s,n);let i;return a[3]===Symbol.for("react.memo_cache_sentinel")?(i=t.jsx("main",{children:t.jsxs(M,{children:[t.jsx("h5",{className:"main-header",children:"ویرایش پروفایل"}),t.jsx(V,{})]})}),a[3]=i):i=a[3],i}export{G as default};
