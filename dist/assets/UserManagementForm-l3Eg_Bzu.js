import{b as v,j as r}from"./query-vendor-KlcNboas.js";import{j as F,B as E,k as S,C as u,f as M,g as A,c as R,h as w,i as q}from"./index-De3z1354.js";import{a as p,e as P}from"./react-vendor-vqeg7uDR.js";import{c as D,a as o,F as L}from"./form-vendor--t6BffNT.js";import{S as g,c as U}from"./ui-vendor-D4DdIvF_.js";import{c as O,d as V}from"./useUsers-CxkYLkyf.js";const x=a=>{const l=R.c(3);let i;l[0]===Symbol.for("react.memo_cache_sentinel")?(i=r.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),l[0]=i):i=l[0];let n;return l[1]!==a?(n=r.jsx(U.DropdownIndicator,{...a,children:i}),l[1]=a,l[2]=n):n=l[2],n},f=[{value:"ADMIN",label:"مدیر"},{value:"SECRETARY",label:"منشی"},{value:"PATIENT",label:"بیمار"}],j=[{value:"MALE",label:"مرد"},{value:"FEMALE",label:"زن"},{value:"OTHER",label:"سایر"}];function G({user:a}){const l=p.useRef(null),i=P(),n=v(),{mutateAsync:I}=O(),{mutateAsync:y}=V(),{data:b}=F(1,100),[m,h]=p.useState(!1),d=!!a?.id,N=p.useMemo(()=>b?.data?.clinics?.map(e=>({value:e.id,label:e.name}))||[],[b?.data?.clinics]),T=p.useMemo(()=>D({phoneNumber:o().required("شماره تلفن الزامی است").test("is-valid-phone","شماره تلفن معتبر نیست",e=>{try{return S(e||""),!0}catch{return!1}}),firstName:o().required("نام الزامی است").min(2,"نام باید حداقل ۲ کاراکتر باشد").max(50,"نام باید حداکثر ۵۰ کاراکتر باشد"),lastName:o().required("نام خانوادگی الزامی است").min(2,"نام خانوادگی باید حداقل ۲ کاراکتر باشد").max(50,"نام خانوادگی باید حداکثر ۵۰ کاراکتر باشد"),password:d?o().min(8,"رمز عبور باید حداقل ۸ کاراکتر باشد"):o().required("رمز عبور الزامی است").min(8,"رمز عبور باید حداقل ۸ کاراکتر باشد"),role:o().oneOf(["ADMIN","SECRETARY","PATIENT"],"نقش نامعتبر است").required("نقش الزامی است"),nationalCode:o().test("is-valid-national-code","کد ملی نامعتبر است",e=>!e||e.length===0?!0:e.length!==10?!1:E(e)).nullable(),address:o().max(500,"آدرس نباید بیشتر از ۵۰۰ کاراکتر باشد"),gender:o().oneOf(["MALE","FEMALE","OTHER"],"جنسیت نامعتبر است").nullable(),clinicId:o().uuid().nullable()}),[d]),C=async(e,c)=>{try{const t=new FormData;if(t.append("phoneNumber",e.phoneNumber),t.append("firstName",e.firstName),t.append("lastName",e.lastName),e.password&&t.append("password",e.password),t.append("role",e.role),e.nationalCode&&t.append("nationalCode",e.nationalCode),e.address&&t.append("address",e.address),e.gender&&t.append("gender",e.gender),e.clinicId&&t.append("clinicId",e.clinicId),e.profileImage&&t.append("profileImage",e.profileImage),m&&d&&t.append("removeProfileImage","true"),d&&a?.id){const s=await y({id:a.id,data:t});w("کاربر با موفقیت ویرایش شد"),h(!1),s?.data?.user&&n.setQueryData(["user",a.id],s),n.invalidateQueries({queryKey:["users"]}),n.invalidateQueries({queryKey:["user",a.id]}),i("/admin/users-management")}else{await I(t),w("کاربر با موفقیت ایجاد شد"),c(),n.invalidateQueries({queryKey:["users"]});const s=document.querySelector(".overflow-auto");s?s.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}}catch(t){const s=t?.response?.data?.message||(d?"خطایی در ویرایش کاربر رخ داد":"خطایی در ایجاد کاربر رخ داد");q(s)}};return r.jsx(L,{initialValues:{phoneNumber:a?.phoneNumber||"",firstName:a?.firstName||"",lastName:a?.lastName||"",password:"",role:a?.role||"PATIENT",nationalCode:a?.nationalCode||"",address:a?.address||"",gender:a?.gender||null,clinicId:a?.clinicId||null,profileImage:null},validationSchema:T,onSubmit:async(e,{resetForm:c})=>{await C({phoneNumber:e.phoneNumber,firstName:e.firstName,lastName:e.lastName,password:e.password,role:e.role,nationalCode:e.nationalCode||null,address:e.address||null,gender:e.gender||null,clinicId:e.clinicId||null,profileImage:e.profileImage},c)},children:e=>{const c=a?.profileImage&&!e.values.profileImage&&!m;return r.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(u,{labelText:"نام",placeholder:"نام را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("firstName"),errorMessage:e.touched.firstName&&e.errors.firstName?e.errors.firstName:null}),r.jsx(u,{labelText:"نام خانوادگی",placeholder:"نام خانوادگی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("lastName"),errorMessage:e.touched.lastName&&e.errors.lastName?e.errors.lastName:null}),r.jsx(u,{labelText:"شماره تماس",placeholder:"شماره تماس را وارد کنید",requiredText:!0,className:"bg-white",inputType:"phone",...e.getFieldProps("phoneNumber"),errorMessage:e.touched.phoneNumber&&e.errors.phoneNumber?e.errors.phoneNumber:null}),r.jsx(u,{labelText:"رمز عبور",placeholder:d?"در صورت تغییر وارد کنید":"رمز عبور را وارد کنید",requiredText:!d,className:"bg-white",type:"password",...e.getFieldProps("password"),errorMessage:e.touched.password&&e.errors.password?e.errors.password:null}),r.jsxs("div",{children:[r.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:["نقش",r.jsx("span",{className:"text-red-500 mr-1",children:"*"})]}),r.jsx(g,{options:f,value:f.find(t=>t.value===e.values.role),onChange:t=>{e.setFieldValue("role",t?.value||"PATIENT"),t?.value!=="SECRETARY"&&e.setFieldValue("clinicId",null),e.setFieldTouched("role",!0)},onBlur:()=>e.setFieldTouched("role",!0),placeholder:"نقش را انتخاب کنید",components:{DropdownIndicator:x},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:t,isSelected:s})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${s?"!bg-primary text-white !cursor-pointer":t?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}}),r.jsx("div",{className:"text-red-500 text-[10px] mr-4 mt-1 min-h-[20px]",children:e.touched.role&&e.errors.role?e.errors.role:null})]}),e.values.role==="SECRETARY"&&r.jsxs("div",{children:[r.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"کلینیک"}),r.jsx(g,{options:N,value:N.find(t=>t.value===e.values.clinicId)||null,onChange:t=>{e.setFieldValue("clinicId",t?.value||null),e.setFieldTouched("clinicId",!0)},onBlur:()=>e.setFieldTouched("clinicId",!0),placeholder:"کلینیک را انتخاب کنید",isClearable:!0,components:{DropdownIndicator:x},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:t,isSelected:s})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${s?"!bg-primary text-white !cursor-pointer":t?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}})]}),r.jsx(u,{labelText:"کد ملی",placeholder:"کد ملی را وارد کنید",optional:!0,className:"bg-white",...e.getFieldProps("nationalCode"),errorMessage:e.touched.nationalCode&&e.errors.nationalCode?e.errors.nationalCode:null}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"جنسیت"}),r.jsx(g,{options:j,value:j.find(t=>t.value===e.values.gender)||null,onChange:t=>{e.setFieldValue("gender",t?.value||null),e.setFieldTouched("gender",!0)},onBlur:()=>e.setFieldTouched("gender",!0),placeholder:"جنسیت را انتخاب کنید",isClearable:!0,components:{DropdownIndicator:x},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:t,isSelected:s})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${s?"!bg-primary text-white !cursor-pointer":t?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}})]})]}),r.jsx(M,{labelText:"آدرس",placeholder:"آدرس را وارد کنید",optional:!0,rows:3,className:"bg-white",...e.getFieldProps("address"),errorMessage:e.touched.address&&e.errors.address?e.errors.address:null}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر پروفایل"}),r.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[r.jsx("input",{ref:l,type:"file",accept:"image/*",className:"hidden ",onChange:t=>{const s=t.target.files?.[0]||null;e.setFieldValue("profileImage",s)}}),r.jsx("button",{type:"button",onClick:()=>{l.current?.click(),h(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.profileImage instanceof File&&r.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.profileImage.name}),c&&r.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[r.jsx("img",{src:A(a.profileImage),alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}),r.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),r.jsx("button",{type:"button",onClick:()=>{h(!0),e.setFieldValue("profileImage",null),l.current&&(l.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),m&&r.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),r.jsx("div",{className:"flex justify-end mt-6",children:r.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[d?"ویرایش کاربر":"ایجاد کاربر",e.isSubmitting&&r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{G as U};
