import{b as M,j as t}from"./query-DkYU0mMV.js";import{aj as N,ak as S,C as g,h as C,c as F,s as b,l as T}from"./index-Ch14QAhQ.js";import{r as u,c as q}from"./react-router-BDAfChV3.js";import{c as $,d as D,b as y,a as m,F as E}from"./forms-C2N9TMf6.js";import{S as Q,c as R}from"./ui-base-vsthQ4vg.js";import{T as V}from"./TextEditor-Cy8ok6xg.js";import{f as K}from"./useCategories-Ba9e_o7v.js";const L=s=>{const a=F.c(3);let n;a[0]===Symbol.for("react.memo_cache_sentinel")?(n=t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),a[0]=n):n=a[0];let o;return a[1]!==s?(o=t.jsx(R.DropdownIndicator,{...s,children:n}),a[1]=s,a[2]=o):o=a[2],o};function W({service:s}){const a=u.useRef(null),n=q(),o=M(),{mutateAsync:v}=N(),{mutateAsync:I}=S(),{data:h}=K(),[p,d]=u.useState(!1),l=!!s?.id,x=u.useMemo(()=>h?.data?.categories?.map(e=>({value:e.id,label:e.name}))||[],[h?.data?.categories]),j=u.useMemo(()=>$({title:m().required("عنوان الزامی است"),description:m().required("توضیحات الزامی است"),price:y().nullable().min(0,"قیمت باید مثبت باشد"),durationMinutes:y().nullable().min(1,"مدت زمان باید حداقل 1 دقیقه باشد"),categoryIds:D().of(m()).nullable()}),[]),w=async(e,c)=>{try{const r=new FormData;if(r.append("title",e.title),r.append("description",e.description),e.price!==null&&e.price!==void 0&&r.append("price",e.price.toString()),e.durationMinutes!==null&&e.durationMinutes!==void 0&&r.append("durationMinutes",e.durationMinutes.toString()),e.categoryIds&&e.categoryIds.length>0&&r.append("categoryIds",JSON.stringify(e.categoryIds)),e.coverImage&&r.append("coverImage",e.coverImage),p&&l&&r.append("removeCoverImage","true"),l&&s?.id){const i=await I({id:s.id,data:r});b("خدمت با موفقیت ویرایش شد"),d(!1),i?.data?.service&&o.setQueryData(["service",s.id],i),o.invalidateQueries({queryKey:["services"]}),o.invalidateQueries({queryKey:["service",s.id]}),n("/admin/services-management")}else{await v(r),b("خدمت با موفقیت ایجاد شد"),c(),o.invalidateQueries({queryKey:["services"]}),o.invalidateQueries({queryKey:["service"]});const i=document.querySelector(".overflow-auto");i?i.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{a.current&&(a.current.value="")},0)}catch(r){const i=r?.response?.data?.message||(l?"خطایی در ویرایش خدمت رخ داد":"خطایی در ایجاد خدمت رخ داد");T(i)}};return t.jsx(E,{initialValues:{title:s?.title||"",description:s?.description||"",price:s?.price||0,durationMinutes:s?.durationMinutes||1,categoryIds:s?.categories?.map(e=>e.id)||[],coverImage:null},validationSchema:j,onSubmit:async(e,{resetForm:c})=>{await w({title:e.title,description:e.description,price:e.price,durationMinutes:e.durationMinutes,categoryIds:e.categoryIds,coverImage:e.coverImage},c)},children:e=>{const c=s?.coverImage&&!e.values.coverImage&&!p;return t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:[t.jsx(g,{labelText:"عنوان",placeholder:"عنوان خدمت را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("title"),errorMessage:e.touched.title&&e.errors.title?e.errors.title:null}),t.jsx(g,{labelText:"قیمت (تومان)",placeholder:"قیمت را وارد کنید",type:"number",optional:!0,className:"bg-white",...e.getFieldProps("price"),errorMessage:e.touched.price&&e.errors.price?e.errors.price:null})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:t.jsx(g,{labelText:"مدت زمان (دقیقه)",placeholder:"مدت زمان را وارد کنید",type:"number",optional:!0,className:"bg-white",...e.getFieldProps("durationMinutes"),errorMessage:e.touched.durationMinutes&&e.errors.durationMinutes?e.errors.durationMinutes:null})}),t.jsx(V,{labelText:"توضیحات",placeholder:"توضیحات خدمت را وارد کنید",value:e.values.description,onChange:r=>{e.setFieldValue("description",r),e.setFieldTouched("description",!0)},errorMessage:e.touched.description&&e.errors.description?e.errors.description:null}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"دسته‌بندی‌ها"}),t.jsxs("div",{className:"",children:[t.jsx(Q,{isMulti:!0,options:x,value:x.filter(r=>e.values.categoryIds.includes(r.value)),onChange:r=>{const i=r?r.map(f=>f.value):[];e.setFieldValue("categoryIds",i)},onBlur:()=>e.setFieldTouched("categoryIds",!0),placeholder:"دسته‌بندی‌ها را انتخاب کنید",components:{DropdownIndicator:L},classNames:{control:()=>`!text-dark px-5 !min-h-[52px] !rounded-lg !border-2  ${e.touched.categoryIds&&e.errors.categoryIds?"!border-red-500":"!border-main-border-color"} !focus:outline-none h-full !cursor-pointer `,option:({isFocused:r,isSelected:i})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${i?"!bg-primary text-white !cursor-pointer":r?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}}),t.jsx("div",{className:`text-red-500 text-[10px] mt-1 mr-4 min-h-[20px] ${(e.touched.categoryIds||e.submitCount>0)&&e.errors.categoryIds?"visible":"invisible"}`,children:e.errors.categoryIds||" "})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر کاور"}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsx("input",{ref:a,type:"file",accept:"image/*",className:"hidden ",onChange:r=>{const i=r.target.files?.[0]||null;e.setFieldValue("coverImage",i),d(!1)}}),t.jsx("button",{type:"button",onClick:()=>{a.current?.click(),d(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.coverImage instanceof File&&t.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.coverImage.name}),c&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[t.jsx("img",{src:C(s.coverImage),alt:"Cover",className:"w-12 h-12 rounded-lg object-cover"}),t.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),t.jsx("button",{type:"button",onClick:()=>{d(!0),e.setFieldValue("coverImage",null),a.current&&(a.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),p&&t.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[l?"ویرایش خدمت":"ایجاد خدمت",e.isSubmitting&&t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{W as S};
