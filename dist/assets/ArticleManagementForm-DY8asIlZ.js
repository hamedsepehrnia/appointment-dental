import{r as p,j as t,g as N}from"./react-core-DkX7OQ4Q.js";import{c as f,d as C,e as S,a as i,F}from"./forms-CxDKTD82.js";import{a9 as T,aa as M,C as x,h as q,e as A,s as b,i as $}from"./index-DUiqV2No.js";import{S as D,c as E}from"./ui-CioiL3KZ.js";import{u as Q}from"./useCategories-BsxxAxr3.js";import{b as V}from"./query-x6gLKhnn.js";import{T as R}from"./TextEditor-CLQQFrLC.js";import{a as K}from"./react-router-CdfMEooj.js";const L=s=>{const a=N.c(3);let l;a[0]===Symbol.for("react.memo_cache_sentinel")?(l=t.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:t.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),a[0]=l):l=a[0];let n;return a[1]!==s?(n=t.jsx(E.DropdownIndicator,{...s,children:l}),a[1]=s,a[2]=n):n=a[2],n};function H({article:s}){const a=p.useRef(null),l=K(),n=V(),{mutateAsync:y}=T(),{mutateAsync:v}=M(),{data:m}=Q(),[h,d]=p.useState(!1),u=!!s?.id,g=p.useMemo(()=>m?.data?.categories?.map(e=>({value:e.id,label:e.name}))||[],[m?.data?.categories]),j=p.useMemo(()=>f({title:i().required("عنوان الزامی است"),content:i().required("محتوای مقاله الزامی است"),excerpt:i(),author:i(),published:S(),categoryIds:C().of(i()).min(1,"انتخاب حداقل یک دسته‌بندی الزامی است").required("انتخاب دسته‌بندی الزامی است")}),[]),I=async(e,c)=>{try{const r=new FormData;if(r.append("title",e.title),r.append("content",e.content),e.excerpt&&r.append("excerpt",e.excerpt),e.author&&r.append("author",e.author),r.append("published",e.published.toString()),e.categoryIds&&e.categoryIds.length>0&&r.append("categoryIds",JSON.stringify(e.categoryIds)),e.coverImage&&r.append("coverImage",e.coverImage),h&&u&&r.append("removeCoverImage","true"),u&&s?.id){const o=await v({id:s.id,data:r});b("مقاله با موفقیت ویرایش شد"),d(!1),o?.data?.article&&n.setQueryData(["article",s.id],o),n.invalidateQueries({queryKey:["articles"]}),n.invalidateQueries({queryKey:["article",s.id]}),l("/admin/articles-management")}else{await y(r),b("مقاله با موفقیت ایجاد شد"),c(),n.invalidateQueries({queryKey:["articles"]}),n.invalidateQueries({queryKey:["article"]});const o=document.querySelector(".overflow-auto");o?o.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{a.current&&(a.current.value="")},0)}catch(r){const o=r?.response?.data?.message||(u?"خطایی در ویرایش مقاله رخ داد":"خطایی در ایجاد مقاله رخ داد");$(o)}};return t.jsx(F,{initialValues:{title:s?.title||"",content:s?.content||"",excerpt:s?.excerpt||"",author:s?.author||"",published:s?.published??!1,categoryIds:s?.categories?.map(e=>e.id)||[],coverImage:null},validationSchema:j,onSubmit:async(e,{resetForm:c})=>{await I({title:e.title,content:e.content,excerpt:e.excerpt,author:e.author,published:e.published,categoryIds:e.categoryIds,coverImage:e.coverImage},c)},children:e=>{const c=s?.coverImage&&!e.values.coverImage&&!h;return t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:[t.jsx(x,{labelText:"عنوان",placeholder:"عنوان مقاله را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("title"),errorMessage:e.touched.title&&e.errors.title?e.errors.title:null}),t.jsx(x,{labelText:"نویسنده",placeholder:"نام نویسنده را وارد کنید",optional:!0,className:"bg-white",...e.getFieldProps("author"),errorMessage:e.touched.author&&e.errors.author?e.errors.author:null})]}),t.jsx(q,{labelText:"خلاصه",placeholder:"خلاصه مقاله را وارد کنید",optional:!0,rows:3,className:"bg-white",...e.getFieldProps("excerpt"),errorMessage:e.touched.excerpt&&e.errors.excerpt?e.errors.excerpt:null}),t.jsx(R,{labelText:"محتوا",placeholder:"محتوا مقاله را وارد کنید",value:e.values.content,onChange:r=>{e.setFieldValue("content",r),e.setFieldTouched("content",!0)},errorMessage:e.touched.content&&e.errors.content?e.errors.content:null}),t.jsxs("div",{children:[t.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:["دسته‌بندی‌ها",t.jsx("span",{className:"text-red-500 mr-1",children:"*"})]}),t.jsxs("div",{className:"",children:[t.jsx(D,{isMulti:!0,options:g,value:g.filter(r=>e.values.categoryIds.includes(r.value)),onChange:r=>{const o=r?r.map(w=>w.value):[];e.setFieldValue("categoryIds",o)},onBlur:()=>e.setFieldTouched("categoryIds",!0),placeholder:"دسته‌بندی‌ها را انتخاب کنید",components:{DropdownIndicator:L},classNames:{control:()=>`!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 ${e.touched.categoryIds&&e.errors.categoryIds?"!border-red-500":"!border-main-border-color"} !focus:outline-none h-full !cursor-pointer`,option:({isFocused:r,isSelected:o})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${o?"!bg-primary text-white !cursor-pointer":r?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}}),t.jsx("div",{className:`text-red-500 text-[10px] mt-1 mr-4 min-h-[20px] ${(e.touched.categoryIds||e.submitCount>0)&&e.errors.categoryIds?"visible":"invisible"}`,children:e.errors.categoryIds||" "})]})]}),t.jsx("div",{className:"flex items-center gap-4",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.values.published,onChange:r=>e.setFieldValue("published",r.target.checked),className:"w-5 h-5 rounded border-2 border-main-border-color text-primary focus:ring-primary"}),t.jsx("span",{className:"text-dark font-estedad-lightbold",children:"منتشر شده"})]})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر کاور"}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsx("input",{ref:a,type:"file",accept:"image/*",className:"hidden ",onChange:r=>{const o=r.target.files?.[0]||null;e.setFieldValue("coverImage",o),d(!1)}}),t.jsx("button",{type:"button",onClick:()=>{a.current?.click(),d(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.coverImage instanceof File&&t.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.coverImage.name}),c&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[t.jsx("img",{src:A(s.coverImage),alt:s.title||"تصویر کاور",className:"w-12 h-12 rounded-lg object-cover"}),t.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),t.jsx("button",{type:"button",onClick:()=>{d(!0),e.setFieldValue("coverImage",null),a.current&&(a.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),h&&t.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[u?"ویرایش مقاله":"ایجاد مقاله",e.isSubmitting&&t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{H as A};
