import{c as V,j as s}from"./query-vendor-DvaUDqTV.js";import{d as E,C as b,c as $,s as C,b as W}from"./index-D1LHzErR.js";import{a as N,u as P}from"./react-vendor-dTsWsAAn.js";import{c as F,d as S,a as h,F as Q}from"./form-vendor--jwUxY8R.js";import{h as A,i as K}from"./ui-vendor-B68-Q-v-.js";import{c as O,d as B}from"./useDoctors-BIEHv_gf.js";import{T as J}from"./TextEditor-Dxi1WhOA.js";const I=[{value:"saturday",label:"شنبه"},{value:"sunday",label:"یکشنبه"},{value:"monday",label:"دوشنبه"},{value:"tuesday",label:"سه‌شنبه"},{value:"wednesday",label:"چهارشنبه"},{value:"thursday",label:"پنج‌شنبه"},{value:"friday",label:"جمعه"}],G=i=>{const n=$.c(3);let x;n[0]===Symbol.for("react.memo_cache_sentinel")?(x=s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),n[0]=x):x=n[0];let u;return n[1]!==i?(u=s.jsx(K.DropdownIndicator,{...i,children:x}),n[1]=i,n[2]=u):u=n[2],u};function ee({doctor:i}){const n=N.useRef(null),x=P(),u=V(),{mutateAsync:T}=O(),{mutateAsync:L}=B(),{data:D}=E(1,100),[w,y]=N.useState(!1),v=!!i?.id,k=N.useMemo(()=>D?.data?.clinics?.map(e=>({value:e.id,label:e.name}))||[],[D?.data?.clinics]),M=N.useMemo(()=>F({firstName:h().required("نام الزامی است"),lastName:h().required("نام خانوادگی الزامی است"),university:h().required("دانشگاه الزامی است"),medicalLicenseNo:h().required("شماره نظام پزشکی الزامی است"),biography:h(),skills:S().of(h()),clinicIds:S().of(h()).min(1,"انتخاب حداقل یک کلینیک الزامی است").required("انتخاب کلینیک الزامی است"),workingDays:F()}),[]),q=async(e,o)=>{try{const l=new FormData;if(l.append("firstName",e.firstName),l.append("lastName",e.lastName),l.append("university",e.university),l.append("medicalLicenseNo",e.medicalLicenseNo),e.biography&&l.append("biography",e.biography),e.skills&&e.skills.length>0&&l.append("skills",JSON.stringify(e.skills)),e.clinicIds&&e.clinicIds.length>0&&l.append("clinicIds",JSON.stringify(e.clinicIds)),e.workingDays){const r={};I.forEach(t=>{const a=e.workingDays[t.value]||[];if(a.length>0){const d=a.filter(c=>c.start&&c.end).map(c=>`${c.start}-${c.end}`);r[t.value]=d.length>0?d.join(" & "):null}else r[t.value]=null}),l.append("workingDays",JSON.stringify(r))}if(e.profileImage&&l.append("profileImage",e.profileImage),w&&v&&l.append("removeProfileImage","true"),v&&i?.id){const r=await L({id:i.id,data:l});C("پزشک با موفقیت ویرایش شد"),y(!1),r?.data?.doctor&&u.setQueryData(["doctor",i.id],r),u.invalidateQueries({queryKey:["doctors"]}),u.invalidateQueries({queryKey:["doctor",i.id]}),x("/admin/doctors-management")}else{await T(l),C("پزشک با موفقیت ایجاد شد"),o(),u.invalidateQueries({queryKey:["doctors"]}),u.invalidateQueries({queryKey:["doctor"]});const r=document.querySelector(".overflow-auto");r?r.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{n.current&&(n.current.value="")},0)}catch(l){const r=l?.response?.data?.message||(v?"خطایی در ویرایش پزشک رخ داد":"خطایی در ایجاد پزشک رخ داد");W(r)}};return s.jsx(Q,{initialValues:{firstName:i?.firstName||"",lastName:i?.lastName||"",university:i?.university||"",biography:i?.biography||"",skills:i?.skills||[],medicalLicenseNo:i?.medicalLicenseNo||"",clinicIds:i?.clinics?.map(e=>e.clinic.id)||[],workingDays:(()=>{const e=i?.workingDays;if(e){const o={};return I.forEach(l=>{const r=e[l.value];if(r==null)o[l.value]=[];else if(typeof r=="string"&&r.trim())if(r.includes(" & ")){const t=r.split(" & ").map(a=>{const[d,c]=a.trim().split("-");return{start:d||"",end:c||""}});o[l.value]=t.filter(a=>a.start&&a.end)}else{const[t,a]=r.split("-");o[l.value]=t&&a?[{start:t.trim(),end:a.trim()}]:[]}else Array.isArray(r)?o[l.value]=r.map(t=>{if(typeof t=="string"){const[a,d]=t.split("-");return{start:a||"",end:d||""}}return t}):o[l.value]=[]}),o}return{}})(),profileImage:null,skillInput:""},validationSchema:M,onSubmit:async(e,{resetForm:o})=>{await q({firstName:e.firstName,lastName:e.lastName,university:e.university,biography:e.biography,skills:e.skills,medicalLicenseNo:e.medicalLicenseNo,clinicIds:e.clinicIds,workingDays:e.workingDays,profileImage:e.profileImage},o)},children:e=>{const o=i?.profileImage&&!e.values.profileImage&&!w,l=()=>{if(e.values.skillInput.trim()){const t=[...e.values.skills,e.values.skillInput.trim()];e.setFieldValue("skills",t),e.setFieldValue("skillInput","")}},r=t=>{const a=e.values.skills.filter((d,c)=>c!==t);e.setFieldValue("skills",a)};return s.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:[s.jsx(b,{labelText:"نام",placeholder:"نام را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("firstName"),errorMessage:e.touched.firstName&&e.errors.firstName?e.errors.firstName:null}),s.jsx(b,{labelText:"نام خانوادگی",placeholder:"نام خانوادگی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("lastName"),errorMessage:e.touched.lastName&&e.errors.lastName?e.errors.lastName:null}),s.jsx(b,{labelText:"دانشگاه تحصیلی",placeholder:"دانشگاه را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("university"),errorMessage:e.touched.university&&e.errors.university?e.errors.university:null}),s.jsx(b,{labelText:"شماره نظام پزشکی",placeholder:"شماره نظام پزشکی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("medicalLicenseNo"),errorMessage:e.touched.medicalLicenseNo&&e.errors.medicalLicenseNo?e.errors.medicalLicenseNo:null})]}),s.jsx(J,{labelText:"بیوگرافی",placeholder:"بیوگرافی پزشک را وارد کنید",optional:!0,value:e.values.biography,onChange:t=>{e.setFieldValue("biography",t),e.setFieldTouched("biography",!0)},errorMessage:e.touched.biography&&e.errors.biography?e.errors.biography:null}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تخصص‌ ها"}),s.jsxs("div",{className:"flex items-center gap-3 mb-2 flex-wrap",children:[s.jsx(b,{className:"flex-1 bg-white",labelText:"",placeholder:"تخصص را وارد کنید و Enter بزنید",...e.getFieldProps("skillInput"),onKeyDown:t=>{t.key==="Enter"&&(t.preventDefault(),l())}}),s.jsx("button",{type:"button",onClick:l,className:"purple-btn",children:"افزودن"})]}),e.values.skills.length>0&&s.jsx("div",{className:"flex flex-wrap gap-2 mr-4 mb-2",children:e.values.skills.map((t,a)=>s.jsxs("span",{className:"px-4 py-2 bg-primary/10 text-primary rounded-full flex items-center gap-2",children:[t,s.jsx("button",{type:"button",onClick:()=>r(a),className:"text-red-500 hover:text-red-700",children:"×"})]},a))})]}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:["کلینیک‌ ها",s.jsx("span",{className:"text-red-500 mr-1",children:"*"})]}),s.jsxs("div",{className:"",children:[s.jsx(A,{isMulti:!0,options:k,value:k.filter(t=>e.values.clinicIds.includes(t.value)),onChange:t=>{const a=t?t.map(d=>d.value):[];e.setFieldValue("clinicIds",a)},onBlur:()=>e.setFieldTouched("clinicIds",!0),placeholder:"کلینیک‌ها را انتخاب کنید",components:{DropdownIndicator:G},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:t,isSelected:a})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${a?"!bg-primary text-white !cursor-pointer":t?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}}),s.jsx("div",{className:"text-red-500 text-[10px] mr-4 mt-1 min-h-[20px]",children:(e.touched.clinicIds||e.submitCount>0)&&e.errors.clinicIds&&s.jsx("span",{children:e.errors.clinicIds})})]})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-4 mr-4",children:"روزهای کاری"}),s.jsx("div",{className:"grid grid-cols-1 xl:grid-cols-2  gap-4 ",children:I.map(t=>{const a=e.values.workingDays[t.value]||[],d=()=>{const p=[...a,{start:"08:00",end:"12:00"}],m={...e.values.workingDays,[t.value]:p};e.setFieldValue("workingDays",m)},c=(p,m,g)=>{const f=[...a];f[p]={...f[p],[m]:g};const j={...e.values.workingDays,[t.value]:f};e.setFieldValue("workingDays",j)},R=p=>{const m=a.filter((f,j)=>j!==p),g={...e.values.workingDays,[t.value]:m};e.setFieldValue("workingDays",g)};return s.jsxs("div",{className:"space-y-3 p-4 border-2 border-main-border-color rounded-lg bg-white",children:[s.jsxs("div",{className:"flex items-center justify-between mb-3",children:[s.jsx("label",{className:"block text-sm font-medium text-dark",children:t.label}),s.jsxs("button",{type:"button",onClick:d,className:"text-primary hover:text-primary/80 text-xs font-estedad-lightbold flex items-center gap-1",children:[s.jsx("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M8 3V13M3 8H13",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"افزودن بازه"]})]}),a.length===0?s.jsx("div",{className:"text-center py-4 text-paragray text-sm",children:"بازه زمانی انتخاب نشده است"}):s.jsx("div",{className:"space-y-3",children:a.map((p,m)=>s.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border border-main-border-color",children:[s.jsxs("div",{className:"flex-1 flex flex-wrap items-center gap-2",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-xs text-paragray mb-1",children:"از"}),s.jsx("input",{type:"time",value:p.start,onChange:g=>c(m,"start",g.target.value),className:"w-full px-3 py-2 border-2 border-main-border-color rounded-lg text-dark focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),s.jsxs("div",{className:"flex-1",children:[s.jsx("label",{className:"block text-xs text-paragray mb-1",children:"تا"}),s.jsx("input",{type:"time",value:p.end,onChange:g=>c(m,"end",g.target.value),min:p.start,className:"w-full px-3 py-2 border-2 border-main-border-color rounded-lg text-dark focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]})]}),s.jsx("button",{type:"button",onClick:()=>R(m),className:"text-red-500 hover:text-red-700 p-2 transition-colors",title:"حذف",children:s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M5 5L15 15M15 5L5 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]},m))})]},t.value)})})]}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر پروفایل"}),s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[s.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden ",onChange:t=>{const a=t.target.files?.[0]||null;e.setFieldValue("profileImage",a),y(!1)}}),s.jsx("button",{type:"button",onClick:()=>{n.current?.click(),y(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.profileImage instanceof File&&s.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.profileImage.name}),o&&s.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[s.jsx("img",{src:`http://localhost:4000${i.profileImage}`,alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}),s.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),s.jsx("button",{type:"button",onClick:()=>{y(!0),e.setFieldValue("profileImage",null),n.current&&(n.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),w&&s.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[v?"ویرایش پزشک":"ایجاد پزشک",e.isSubmitting&&s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{ee as D};
