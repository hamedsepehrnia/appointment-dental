import{j as e,b as J}from"./query-vendor-KlcNboas.js";import{a as x}from"./react-vendor-vqeg7uDR.js";import{c as R,N as W,l as L,T as X,m as w,A as Y,G as Z,O as ee,a1 as se,S as te,C as ae,Q as le,R as re,h as A,i as D}from"./index-DxH3n9CQ.js";import{a as ne,b as ie,c as de,d as ce,e as oe}from"./useContact-DssjIMRQ.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function xe(r){const s=R.c(17),{messages:l,isLoadingMessages:t,page:a,onDeleteClick:d,onMarkAsRead:b,onMarkAsUnread:m,onMessageClick:u,onRefetch:o,isRefetching:g}=r,c=g===void 0?!1:g;let h;s[0]!==c||s[1]!==o?(h=o&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:o,disabled:c,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),s[0]=c,s[1]=o,s[2]=h):h=s[2];let y;s[3]===Symbol.for("react.memo_cache_sentinel")?(y=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"نام"}),e.jsx("th",{children:"ایمیل"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"موضوع"}),e.jsx("th",{children:"پیام"}),e.jsx("th",{children:"کلینیک"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),s[3]=y):y=s[3];let f;s[4]!==t||s[5]!==l||s[6]!==d||s[7]!==b||s[8]!==m||s[9]!==u||s[10]!==a?(f=t?e.jsx(W,{rows:5,columns:10}):l.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center p-8 font-estedad-light",children:"پیامی یافت نشد"})}):l.map((n,k)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${n.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(a-1)*5+k+1}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-user text-primary"})}),e.jsx("div",{children:e.jsx("p",{className:"font-estedad-light line-clamp-2 max-w-[300px] min-w-[220px]",children:n.name})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:n.email||e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:n.phoneNumber||e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:n.subject?e.jsx("span",{className:"line-clamp-2 max-w-[200px] min-w-[200px]",children:n.subject}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("button",{onClick:()=>u(n),className:"line-clamp-2 max-w-[200px] text-right hover:text-primary transition-colors cursor-pointer",title:"کلیک برای مشاهده کامل پیام",children:n.message})}),e.jsx("td",{className:"text-dark font-estedad-light",children:n.clinic?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary text-nowrap",children:n.clinic.name}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:n.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap",children:"خوانده نشده"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:L(new Date(n.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center  gap-2",children:[n.read?e.jsx("button",{onClick:()=>m(n.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده نشده",children:e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>b(n.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده شده",children:e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>d(n.id,n.name),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},n.id)),s[4]=t,s[5]=l,s[6]=d,s[7]=b,s[8]=m,s[9]=u,s[10]=a,s[11]=f):f=s[11];let j;s[12]!==f?(j=e.jsx(X,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[y,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:f})]})}),s[12]=f,s[13]=j):j=s[13];let N;return s[14]!==h||s[15]!==j?(N=e.jsxs(e.Fragment,{children:[h,j]}),s[14]=h,s[15]=j,s[16]=N):N=s[16],N}function me(){const r=R.c(3),{data:s,isLoading:l}=ne();let t;if(r[0]!==l||r[1]!==s?.data){const a=s?.data||{total:0,read:0,unread:0},d=[{title:"کل پیام‌ها",value:a.total,icon:"far fa-envelope",bgColor:"bg-blue-100",iconColor:"text-primary",isLoading:l},{title:"خوانده شده",value:a.read,icon:"far fa-envelope-open",bgColor:"bg-green-100",iconColor:"text-green-500",isLoading:l},{title:"خوانده نشده",value:a.unread,icon:"far fa-envelope",bgColor:"bg-orange-100",iconColor:"text-orange-500",isLoading:l}];t=e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:d.map(he)}),r[0]=l,r[1]=s?.data,r[2]=t}else t=r[2];return t}function he(r,s){return e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:r.title}),r.isLoading?e.jsx("div",{className:"mt-2 h-8 w-20 bg-gray-200 rounded animate-pulse"}):e.jsx("h3",{className:"text-2xl font-estedad-semibold mt-2",children:r.value.toLocaleString("fa-IR")})]}),e.jsx("div",{className:`w-12 h-12 shrink-0 ${r.bgColor} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${r.icon} ${r.iconColor} text-xl`})})]})},s)}function ue(r){const s=R.c(13),{isOpen:l,onClose:t,message:a}=r;let d,b;s[0]!==l||s[1]!==t?(d=()=>{const c=h=>{h.key==="Escape"&&l&&t()};return l&&(document.addEventListener("keydown",c),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",c),document.body.style.overflow="unset"}},b=[l,t],s[0]=l,s[1]=t,s[2]=d,s[3]=b):(d=s[2],b=s[3]),x.useEffect(d,b);let m;s[4]!==t?(m=c=>{c.target===c.currentTarget&&t()},s[4]=t,s[5]=m):m=s[5];const u=m;let o;s[6]!==u||s[7]!==l||s[8]!==a||s[9]!==t?(o=l&&a&&e.jsxs(w.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:u,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(w.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(w.div,{className:"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30,duration:.3},children:[e.jsx("div",{className:"bg-linear-to-r from-purple-400 via-purple-500 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:"far fa-envelope text-white text-xl"})}),e.jsx("h3",{className:"text-xl font-estedad-semibold text-white",children:"مشاهده پیام"})]}),e.jsx(w.button,{onClick:t,className:"w-9 h-9 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 hover:bg-white/30 hover:border-white/40 flex items-center justify-center transition-all duration-200 group","aria-label":"بستن",children:e.jsx("i",{className:"fa fa-times text-sm text-white/90 group-hover:text-white transition-colors"})})]})}),e.jsx("div",{className:"px-6 py-6 overflow-y-auto flex-1 admin-modal-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"نام فرستنده"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.name})]}),a.email&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"ایمیل"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.email})]}),a.phoneNumber&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"شماره تماس"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.phoneNumber})]}),a.clinic&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"کلینیک"}),e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary inline-block",children:a.clinic.name})]}),a.subject&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"موضوع"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.subject})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"پیام"}),e.jsx("p",{className:"text-dark font-estedad-light text-base leading-7 whitespace-pre-wrap",children:a.message})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ ارسال"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:L(new Date(a.createdAt))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"وضعیت"}),a.read?e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-green-100 text-green-700 inline-block",children:"خوانده شده"}):e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-700 inline-block",children:"خوانده نشده"})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:t,className:"px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors",children:"بستن"})})})]})]}),s[6]=u,s[7]=l,s[8]=a,s[9]=t,s[10]=o):o=s[10];let g;return s[11]!==o?(g=e.jsx(Y,{mode:"wait",children:o}),s[11]=o,s[12]=g):g=s[12],g}function we(){const{setHeaderConfig:r}=Z(),[s,l]=x.useState(1),[t,a]=x.useState(""),[d]=ee(t,500),[b,m]=x.useState(!1),[u,o]=x.useState(void 0),[g,c]=x.useState(!1),[h,y]=x.useState(null),[f,j]=x.useState(!1),[N,n]=x.useState(!1),[k,T]=x.useState(null),v=J(),{mutateAsync:O}=ie(),{mutateAsync:Q}=de(),{mutateAsync:U}=ce(),{refetch:C}=se(),{data:E,isLoading:M,isPending:$,refetch:q,isFetching:I}=oe(s,5,d,u);x.useEffect(()=>(r({title:"مدیریت تماس با ما"}),()=>{r({title:void 0,backButton:!1})}),[r]),x.useEffect(()=>{t.trim()?m(!0):m(!1)},[t]),x.useEffect(()=>{M||d===t&&m(!1)},[M,d,t]);const K=(i,p)=>{y({id:i,name:p}),c(!0)},P=async()=>{if(h){j(!0);try{await C(),await O(h.id),A("پیام با موفقیت حذف شد"),v.invalidateQueries({queryKey:["contactMessages"]}),v.invalidateQueries({queryKey:["contactMessagesStats"]}),c(!1),y(null)}catch(i){const p=i?.response?.data?.message||"خطایی در حذف پیام رخ داد";D(p)}finally{j(!1)}}},_=()=>{f||(c(!1),y(null))},F=async i=>{try{await C(),await Q(i),A("پیام به عنوان خوانده شده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["contactMessages"]}),v.invalidateQueries({queryKey:["contactMessagesStats"]})}catch(p){const S=p?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت پیام رخ داد";D(S)}},V=async i=>{try{await C(),await U(i),A("پیام به عنوان خوانده نشده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["contactMessages"]}),v.invalidateQueries({queryKey:["contactMessagesStats"]})}catch(p){const S=p?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت پیام رخ داد";D(S)}},G=i=>{T(i),n(!0)},z=()=>{n(!1),T(null)},B=E?.data?.messages||[],H=E?.meta;return e.jsxs("main",{children:[e.jsxs(te,{children:[e.jsx(me,{}),e.jsx("h5",{className:"main-header ",children:"لیست پیام‌ها"}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row  justify-between gap-4",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(ae,{labelText:"جستجو",placeholder:"جستجو بر اساس نام، ایمیل، موضوع یا پیام...",className:"bg-white pr-12",value:t,onChange:i=>{a(i.target.value),l(1)}}),b&&t&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("label",{className:"text-sm font-estedad-semibold mb-2",children:"فیلتر وضعیت:"}),e.jsxs("select",{value:u===void 0?"all":u?"read":"unread",onChange:i=>{const p=i.target.value;o(p==="all"?void 0:p==="read"),l(1)},className:"px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"همه"}),e.jsx("option",{value:"read",children:"خوانده شده"}),e.jsx("option",{value:"unread",children:"خوانده نشده"})]})]})]}),e.jsx(xe,{messages:B,isLoadingMessages:M||$,page:s,onDeleteClick:K,onMarkAsRead:F,onMarkAsUnread:V,onMessageClick:G,onRefetch:q,isRefetching:I}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(le,{meta:H,onPageChange:i=>l(i)})})]}),e.jsx(re,{isOpen:g,onClose:_,onConfirm:P,title:"حذف پیام",message:`آیا از حذف پیام ${h?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:f}),e.jsx(ue,{isOpen:N,onClose:z,message:k})]})}export{we as default};
