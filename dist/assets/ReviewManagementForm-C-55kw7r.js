import{b as N,j as t}from"./query-vendor-KlcNboas.js";import{a as u,e as w,R as I}from"./react-vendor-vqeg7uDR.js";import{c as v,e as S,b as p,a as g,F}from"./form-vendor--t6BffNT.js";import{C as m,f as T,g as C,h,i as R}from"./index-De3z1354.js";import{a as q,d as M}from"./useReviews-B8AkRBFs.js";function A({review:r}){const n=u.useRef(null),x=w(),i=N(),{mutateAsync:b}=q(),{mutateAsync:f}=M(),[c,o]=u.useState(!1),d=!!r?.id,j=I.useMemo(()=>v({name:g().required("نام الزامی است"),content:g().required("متن نظر الزامی است"),rating:p().required("امتیاز الزامی است").min(1,"امتیاز باید حداقل 1 باشد").max(5,"امتیاز باید حداکثر 5 باشد"),order:p().nullable().min(0,"ترتیب باید مثبت باشد"),published:S()}),[]),y=async(e,l)=>{try{const a=new FormData;if(a.append("name",e.name),a.append("content",e.content),a.append("rating",e.rating.toString()),a.append("order",(e.order||0).toString()),a.append("published",e.published.toString()),e.profileImage&&a.append("profileImage",e.profileImage),c&&d&&a.append("removeProfileImage","true"),d&&r?.id){const s=await f({id:r.id,data:a});h("نظر با موفقیت ویرایش شد"),o(!1),s?.data?.review&&i.setQueryData(["review",r.id],s),i.invalidateQueries({queryKey:["reviews"]}),i.invalidateQueries({queryKey:["review",r.id]}),x("/admin/reviews-management")}else{await b(a),h("نظر با موفقیت ایجاد شد"),l(),i.invalidateQueries({queryKey:["reviews"]});const s=document.querySelector(".overflow-auto");s?s.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{n.current&&(n.current.value="")},0)}catch(a){const s=a?.response?.data?.message||(d?"خطایی در ویرایش نظر رخ داد":"خطایی در ایجاد نظر رخ داد");R(s)}};return t.jsx(F,{initialValues:{name:r?.name||"",content:r?.content||"",rating:r?.rating||5,order:r?.order||0,published:r?.published||!1,profileImage:null},validationSchema:j,onSubmit:async(e,{resetForm:l})=>{await y({name:e.name,content:e.content,rating:e.rating,order:e.order,published:e.published,profileImage:e.profileImage},l)},children:e=>{const l=r?.profileImage&&!e.values.profileImage&&!c;return t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:[t.jsx(m,{labelText:"نام",placeholder:"نام کاربر را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("name"),errorMessage:e.touched.name&&e.errors.name?e.errors.name:null}),t.jsx(m,{labelText:"امتیاز (1 تا 5)",placeholder:"امتیاز را وارد کنید",type:"number",min:1,max:5,className:"bg-white",requiredText:!0,...e.getFieldProps("rating"),errorMessage:e.touched.rating&&e.errors.rating?e.errors.rating:null})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ",children:[t.jsx(m,{labelText:"ترتیب نمایش",placeholder:"ترتیب نمایش را وارد کنید",type:"number",min:0,optional:!0,className:"bg-white",...e.getFieldProps("order"),errorMessage:e.touched.order&&e.errors.order?e.errors.order:null}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"وضعیت انتشار"}),t.jsx("div",{className:"flex items-center gap-4 mr-4",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.values.published,onChange:a=>e.setFieldValue("published",a.target.checked),className:"w-5 h-5 rounded border-2 border-main-border-color text-primary focus:ring-primary"}),t.jsx("span",{className:"text-dark font-estedad-light",children:"منتشر شده"})]})})]})]}),t.jsx("div",{children:t.jsx(T,{labelText:"متن نظر",placeholder:"متن نظر را وارد کنید",className:"bg-white",requiredText:!0,rows:5,...e.getFieldProps("content"),errorMessage:e.touched.content&&e.errors.content?e.errors.content:null})}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر پروفایل"}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden ",onChange:a=>{const s=a.target.files?.[0]||null;e.setFieldValue("profileImage",s),o(!1)}}),t.jsx("button",{type:"button",onClick:()=>{n.current?.click(),o(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.profileImage instanceof File&&t.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.profileImage.name}),l&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[t.jsx("img",{src:C(r.profileImage),alt:r.name||"تصویر پروفایل",className:"w-12 h-12 rounded-full object-cover"}),t.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),t.jsx("button",{type:"button",onClick:()=>{o(!0),e.setFieldValue("profileImage",null),n.current&&(n.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),c&&t.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[d?"ویرایش نظر":"ایجاد نظر",e.isSubmitting&&t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{A as R};
