import{a as I,u as S,c as M,j as s}from"./query-vendor-DvaUDqTV.js";import{c as g,r as f,d as A,f as q,C as N,s as C,b as $}from"./index-D1LHzErR.js";import{a as w,u as R}from"./react-vendor-dTsWsAAn.js";import{c as P,a as c,F as U}from"./form-vendor--jwUxY8R.js";import{C as D}from"./CustomTextArea-xgSORRfA.js";import{h as y,i as L}from"./ui-vendor-B68-Q-v-.js";const J=(r,t,l,n,u)=>{const o=g.c(6),m=r===void 0?1:r,h=t,p=l===void 0?"":l;let i;return o[0]!==u||o[1]!==h||o[2]!==m||o[3]!==n||o[4]!==p?(i={queryKey:["users",m,h,p,n,u],queryFn:async()=>{const x=new URLSearchParams({page:m.toString(),limit:h.toString()});return p&&x.append("search",p),(await f.get(`/users?${x.toString()}`)).data},staleTime:3e5},o[0]=u,o[1]=h,o[2]=m,o[3]=n,o[4]=p,o[5]=i):i=o[5],S(i)},X=r=>{const t=g.c(7);let l,n;t[0]!==r?(l=["user",r],n=async()=>(await f.get(`/users/${r}`)).data,t[0]=r,t[1]=l,t[2]=n):(l=t[1],n=t[2]);const u=!!r;let o;return t[3]!==l||t[4]!==n||t[5]!==u?(o={queryKey:l,queryFn:n,enabled:u,staleTime:3e5},t[3]=l,t[4]=n,t[5]=u,t[6]=o):o=t[6],S(o)},O=()=>{const r=g.c(1);let t;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={mutationFn:Q},r[0]=t):t=r[0],I(t)},V=()=>{const r=g.c(1);let t;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={mutationFn:B},r[0]=t):t=r[0],I(t)},Z=()=>{const r=g.c(1);let t;return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={mutationFn:K},r[0]=t):t=r[0],I(t)};async function Q(r){return(await f.post("/users",r,{headers:{"Content-Type":"multipart/form-data"}})).data}async function B(r){const{id:t,data:l}=r;return(await f.patch(`/users/${t}`,l,{headers:{"Content-Type":"multipart/form-data"}})).data}async function K(r){return(await f.delete(`/users/${r}`)).data}const j=r=>{const t=g.c(3);let l;t[0]===Symbol.for("react.memo_cache_sentinel")?(l=s.jsx("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:s.jsx("path",{d:"M5 7.5L10 12.5L15 7.5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),t[0]=l):l=t[0];let n;return t[1]!==r?(n=s.jsx(L.DropdownIndicator,{...r,children:l}),t[1]=r,t[2]=n):n=t[2],n},v=[{value:"ADMIN",label:"مدیر"},{value:"SECRETARY",label:"منشی"},{value:"PATIENT",label:"بیمار"}],F=[{value:"MALE",label:"مرد"},{value:"FEMALE",label:"زن"},{value:"OTHER",label:"سایر"}];function k({user:r}){const t=w.useRef(null),l=R(),n=M(),{mutateAsync:u}=O(),{mutateAsync:o}=V(),{data:m}=A(1,100),[h,p]=w.useState(!1),i=!!r?.id,x=w.useMemo(()=>m?.data?.clinics?.map(e=>({value:e.id,label:e.name}))||[],[m?.data?.clinics]),T=w.useMemo(()=>P({phoneNumber:c().required("شماره تلفن الزامی است").test("is-valid-phone","شماره تلفن معتبر نیست",e=>{try{return q(e||""),!0}catch{return!1}}),firstName:c().required("نام الزامی است").min(2,"نام باید حداقل ۲ کاراکتر باشد").max(50,"نام باید حداکثر ۵۰ کاراکتر باشد"),lastName:c().required("نام خانوادگی الزامی است").min(2,"نام خانوادگی باید حداقل ۲ کاراکتر باشد").max(50,"نام خانوادگی باید حداکثر ۵۰ کاراکتر باشد"),password:i?c().min(8,"رمز عبور باید حداقل ۸ کاراکتر باشد"):c().required("رمز عبور الزامی است").min(8,"رمز عبور باید حداقل ۸ کاراکتر باشد"),role:c().oneOf(["ADMIN","SECRETARY","PATIENT"],"نقش نامعتبر است").required("نقش الزامی است"),nationalCode:c().nullable(),address:c().max(500,"آدرس نباید بیشتر از ۵۰۰ کاراکتر باشد"),gender:c().oneOf(["MALE","FEMALE","OTHER"],"جنسیت نامعتبر است").nullable(),clinicId:c().uuid().nullable()}),[i]),E=async(e,b)=>{try{const a=new FormData;if(a.append("phoneNumber",e.phoneNumber),a.append("firstName",e.firstName),a.append("lastName",e.lastName),e.password&&a.append("password",e.password),a.append("role",e.role),e.nationalCode&&a.append("nationalCode",e.nationalCode),e.address&&a.append("address",e.address),e.gender&&a.append("gender",e.gender),e.clinicId&&a.append("clinicId",e.clinicId),e.profileImage&&a.append("profileImage",e.profileImage),h&&i&&a.append("removeProfileImage","true"),i&&r?.id){const d=await o({id:r.id,data:a});C("کاربر با موفقیت ویرایش شد"),p(!1),d?.data?.user&&n.setQueryData(["user",r.id],d),n.invalidateQueries({queryKey:["users"]}),n.invalidateQueries({queryKey:["user",r.id]}),l("/admin/users-management")}else{await u(a),C("کاربر با موفقیت ایجاد شد"),b(),n.invalidateQueries({queryKey:["users"]});const d=document.querySelector(".overflow-auto");d?d.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}}catch(a){const d=a?.response?.data?.message||(i?"خطایی در ویرایش کاربر رخ داد":"خطایی در ایجاد کاربر رخ داد");$(d)}};return s.jsx(U,{initialValues:{phoneNumber:r?.phoneNumber||"",firstName:r?.firstName||"",lastName:r?.lastName||"",password:"",role:r?.role||"PATIENT",nationalCode:r?.nationalCode||"",address:r?.address||"",gender:r?.gender||null,clinicId:r?.clinicId||null,profileImage:null},validationSchema:T,onSubmit:async(e,{resetForm:b})=>{await E({phoneNumber:e.phoneNumber,firstName:e.firstName,lastName:e.lastName,password:e.password,role:e.role,nationalCode:e.nationalCode||null,address:e.address||null,gender:e.gender||null,clinicId:e.clinicId||null,profileImage:e.profileImage},b)},children:e=>{const b=r?.profileImage&&!e.values.profileImage&&!h;return s.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsx(N,{labelText:"نام",placeholder:"نام را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("firstName"),errorMessage:e.touched.firstName&&e.errors.firstName?e.errors.firstName:null}),s.jsx(N,{labelText:"نام خانوادگی",placeholder:"نام خانوادگی را وارد کنید",requiredText:!0,className:"bg-white",...e.getFieldProps("lastName"),errorMessage:e.touched.lastName&&e.errors.lastName?e.errors.lastName:null}),s.jsx(N,{labelText:"شماره تماس",placeholder:"شماره تماس را وارد کنید",requiredText:!0,className:"bg-white",inputType:"phone",...e.getFieldProps("phoneNumber"),errorMessage:e.touched.phoneNumber&&e.errors.phoneNumber?e.errors.phoneNumber:null}),s.jsx(N,{labelText:"رمز عبور",placeholder:i?"در صورت تغییر وارد کنید":"رمز عبور را وارد کنید",requiredText:!i,className:"bg-white",type:"password",...e.getFieldProps("password"),errorMessage:e.touched.password&&e.errors.password?e.errors.password:null}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:["نقش",s.jsx("span",{className:"text-red-500 mr-1",children:"*"})]}),s.jsx(y,{options:v,value:v.find(a=>a.value===e.values.role),onChange:a=>{e.setFieldValue("role",a?.value||"PATIENT"),a?.value!=="SECRETARY"&&e.setFieldValue("clinicId",null),e.setFieldTouched("role",!0)},onBlur:()=>e.setFieldTouched("role",!0),placeholder:"نقش را انتخاب کنید",components:{DropdownIndicator:j},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:a,isSelected:d})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${d?"!bg-primary text-white !cursor-pointer":a?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}}),s.jsx("div",{className:"text-red-500 text-[10px] mr-4 mt-1 min-h-[20px]",children:e.touched.role&&e.errors.role?e.errors.role:null})]}),e.values.role==="SECRETARY"&&s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"کلینیک"}),s.jsx(y,{options:x,value:x.find(a=>a.value===e.values.clinicId)||null,onChange:a=>{e.setFieldValue("clinicId",a?.value||null),e.setFieldTouched("clinicId",!0)},onBlur:()=>e.setFieldTouched("clinicId",!0),placeholder:"کلینیک را انتخاب کنید",isClearable:!0,components:{DropdownIndicator:j},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:a,isSelected:d})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${d?"!bg-primary text-white !cursor-pointer":a?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}})]}),s.jsx(N,{labelText:"کد ملی",placeholder:"کد ملی را وارد کنید",optional:!0,className:"bg-white",...e.getFieldProps("nationalCode"),errorMessage:e.touched.nationalCode&&e.errors.nationalCode?e.errors.nationalCode:null}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"جنسیت"}),s.jsx(y,{options:F,value:F.find(a=>a.value===e.values.gender)||null,onChange:a=>{e.setFieldValue("gender",a?.value||null),e.setFieldTouched("gender",!0)},onBlur:()=>e.setFieldTouched("gender",!0),placeholder:"جنسیت را انتخاب کنید",isClearable:!0,components:{DropdownIndicator:j},classNames:{control:()=>"!text-dark px-5 !min-h-[52px] !rounded-lg !border-2 !border-main-border-color !focus:outline-none h-full !cursor-pointer",option:({isFocused:a,isSelected:d})=>`px-3 py-2 cursor-pointer !text-lg border-r-6 ${d?"!bg-primary text-white !cursor-pointer":a?"!text-secondary !cursor-pointer":"bg-white !cursor-pointer"}`,menu:()=>"!mt-0 !rounded-t-none shadow-lg bg-white overflow-hidden",placeholder:()=>"!text-dark"}})]})]}),s.jsx(D,{labelText:"آدرس",placeholder:"آدرس را وارد کنید",optional:!0,rows:3,className:"bg-white",...e.getFieldProps("address"),errorMessage:e.touched.address&&e.errors.address?e.errors.address:null}),s.jsxs("div",{children:[s.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"تصویر پروفایل"}),s.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[s.jsx("input",{ref:t,type:"file",accept:"image/*",className:"hidden ",onChange:a=>{const d=a.target.files?.[0]||null;e.setFieldValue("profileImage",d)}}),s.jsx("button",{type:"button",onClick:()=>{t.current?.click(),p(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.profileImage instanceof File&&s.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.profileImage.name}),b&&s.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[s.jsx("img",{src:`http://localhost:4000${r.profileImage}`,alt:"Profile",className:"w-12 h-12 rounded-full object-cover"}),s.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"}),s.jsx("button",{type:"button",onClick:()=>{p(!0),e.setFieldValue("profileImage",null),t.current&&(t.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),h&&s.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),s.jsx("div",{className:"flex justify-end mt-6",children:s.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[i?"ویرایش کاربر":"ایجاد کاربر",e.isSubmitting&&s.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{k as U,J as a,X as b,Z as u};
