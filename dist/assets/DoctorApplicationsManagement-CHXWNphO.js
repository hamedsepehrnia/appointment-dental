import{j as e,c as J}from"./query-vendor-DvaUDqTV.js";import{a as h}from"./react-vendor-dTsWsAAn.js";import{c as T,m as S,A as W,y as X,C as Y,s as D,b as M}from"./index-DQ7xL4Vx.js";import{u as Z}from"./useAdminDashboardHeader-CFWWO3br.js";import{a as ee,b as te,c as se,d as ae,e as le}from"./useDoctorApplications-7U_k85PX.js";import{A as re}from"./AdminPagination-CimytDQx.js";import{T as ie}from"./TableContainer-wezUMfoN.js";import{T as ne,D as oe}from"./DeleteModal-D56zs9AN.js";import{f as E}from"./helpers-DOyc9qlM.js";import{a as de}from"./index.module-BblzqiS0.js";import{S as ce}from"./SectionContainer-BxhawREw.js";import"./redux-vendor-5gwm_VuO.js";import"./ui-vendor-B68-Q-v-.js";import"./form-vendor--jwUxY8R.js";import"./motion-vendor-CQyDv_CV.js";function me(l){const t=T.c(17),{applications:r,isLoadingApplications:s,page:a,onDeleteClick:d,onMarkAsRead:g,onMarkAsUnread:f,onApplicationClick:u,onRefetch:p,isRefetching:b}=l,c=b===void 0?!1:b;let m;t[0]!==c||t[1]!==p?(m=p&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:p,disabled:c,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=c,t[1]=p,t[2]=m):m=t[2];let n;t[3]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"نام و نام خانوادگی"}),e.jsx("th",{children:"ایمیل"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"اطلاعات پزشک"}),e.jsx("th",{children:"کلینیک"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=n):n=t[3];let o;t[4]!==r||t[5]!==s||t[6]!==u||t[7]!==d||t[8]!==g||t[9]!==f||t[10]!==a?(o=s?e.jsx(ne,{rows:5,columns:9}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center p-8 font-estedad-light",children:"درخواستی یافت نشد"})}):r.map((i,w)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${i.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(a-1)*5+w+1}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-user text-primary"})}),e.jsx("div",{children:e.jsxs("p",{className:"font-estedad-light line-clamp-2 max-w-[300px] min-w-[220px]",children:[i.firstName," ",i.lastName]})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:i.email||e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:i.phoneNumber}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("button",{onClick:()=>u(i),className:"line-clamp-2 max-w-[260px] min-w-[200px] text-right hover:text-primary transition-colors cursor-pointer",title:"کلیک برای مشاهده کامل اطلاعات",children:i.doctorInfo})}),e.jsx("td",{className:"text-dark font-estedad-light",children:i.clinic?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary text-nowrap",children:i.clinic.name}):e.jsx("span",{className:"text-paragray ",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:i.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap",children:"خوانده نشده"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:E(new Date(i.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[i.read?e.jsx("button",{onClick:()=>f(i.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده نشده",children:e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>g(i.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده شده",children:e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>d(i.id,`${i.firstName} ${i.lastName}`),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},i.id)),t[4]=r,t[5]=s,t[6]=u,t[7]=d,t[8]=g,t[9]=f,t[10]=a,t[11]=o):o=t[11];let j;t[12]!==o?(j=e.jsx(ie,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[n,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:o})]})}),t[12]=o,t[13]=j):j=t[13];let N;return t[14]!==m||t[15]!==j?(N=e.jsxs(e.Fragment,{children:[m,j]}),t[14]=m,t[15]=j,t[16]=N):N=t[16],N}function xe(){const l=T.c(3),{data:t,isLoading:r}=ee();let s;if(l[0]!==r||l[1]!==t?.data){const a=t?.data||{total:0,read:0,unread:0},d=[{title:"کل درخواست‌ها",value:a.total,icon:"far fa-envelope",bgColor:"bg-blue-100",iconColor:"text-primary",isLoading:r},{title:"خوانده شده",value:a.read,icon:"far fa-envelope-open",bgColor:"bg-green-100",iconColor:"text-green-500",isLoading:r},{title:"خوانده نشده",value:a.unread,icon:"far fa-envelope",bgColor:"bg-orange-100",iconColor:"text-orange-500",isLoading:r}];s=e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:d.map(pe)}),l[0]=r,l[1]=t?.data,l[2]=s}else s=l[2];return s}function pe(l,t){return e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:l.title}),l.isLoading?e.jsx("div",{className:"mt-2 h-8 w-20 bg-gray-200 rounded animate-pulse"}):e.jsx("h3",{className:"text-2xl font-estedad-semibold mt-2",children:l.value.toLocaleString("fa-IR")})]}),e.jsx("div",{className:`w-12 h-12 shrink-0 ${l.bgColor} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${l.icon} ${l.iconColor} text-xl`})})]})},t)}function he(l){const t=T.c(19),{isOpen:r,onClose:s,application:a}=l;let d,g;t[0]!==r||t[1]!==s?(d=()=>{const n=o=>{o.key==="Escape"&&r&&s()};return r&&(document.addEventListener("keydown",n),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",n),document.body.style.overflow="unset"}},g=[r,s],t[0]=r,t[1]=s,t[2]=d,t[3]=g):(d=t[2],g=t[3]),h.useEffect(d,g);let f;t[4]!==s?(f=n=>{n.target===n.currentTarget&&s()},t[4]=s,t[5]=f):f=t[5];const u=f;let p,b,c;if(t[6]!==a||t[7]!==u||t[8]!==r||t[9]!==s){let n=[];if(a?.documents)try{let o;t[13]!==a?(o=JSON.parse(a.documents),t[13]=a,t[14]=o):o=t[14],n=o}catch(o){console.error("Error parsing documents:",o)}p=W,b="wait",c=r&&a&&e.jsxs(S.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:u,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(S.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(S.div,{className:"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30,duration:.3},children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:"far fa-user-md text-white text-xl"})}),e.jsx("h3",{className:"text-xl font-estedad-semibold text-white",children:"مشاهده درخواست همکاری"})]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors","aria-label":"بستن",children:e.jsx("i",{className:"fa fa-times text-white"})})]})}),e.jsx("div",{className:"px-6 py-6 overflow-y-auto flex-1 admin-modal-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"نام و نام خانوادگی"}),e.jsxs("p",{className:"text-dark font-estedad-light text-base",children:[a.firstName," ",a.lastName]})]}),a.email&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"ایمیل"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.email})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"شماره تماس"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.phoneNumber})]}),a.clinic&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"کلینیک"}),e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary inline-block",children:a.clinic.name})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"اطلاعات پزشک"}),e.jsx("p",{className:"text-dark font-estedad-light text-base leading-7 whitespace-pre-wrap",children:a.doctorInfo})]}),n.length>0&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-2",children:"مدارک ارسال شده"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:n.map(fe)})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ ارسال"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:E(new Date(a.createdAt))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"وضعیت"}),a.read?e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-green-100 text-green-700 inline-block",children:"خوانده شده"}):e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-700 inline-block",children:"خوانده نشده"})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:s,className:"px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors",children:"بستن"})})})]})]}),t[6]=a,t[7]=u,t[8]=r,t[9]=s,t[10]=p,t[11]=b,t[12]=c}else p=t[10],b=t[11],c=t[12];let m;return t[15]!==p||t[16]!==b||t[17]!==c?(m=e.jsx(p,{mode:b,children:c}),t[15]=p,t[16]=b,t[17]=c,t[18]=m):m=t[18],m}function fe(l,t){const r=`${l}`,s=l.split("/").pop()||`مدرک ${t+1}`,a=/\.(jpg|jpeg|png|gif)$/i.test(l),d=/\.pdf$/i.test(l);return e.jsxs("a",{href:r,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:[a?e.jsx("i",{className:"far fa-image"}):d?e.jsx("i",{className:"far fa-file-pdf"}):e.jsx("i",{className:"far fa-file"}),e.jsx("span",{className:"text-sm",children:s}),e.jsx("i",{className:"far fa-external-link-alt text-xs"})]},t)}function $e(){const{setHeaderConfig:l}=Z(),[t,r]=h.useState(1),[s,a]=h.useState(""),[d]=de(s,500),[g,f]=h.useState(!1),[u,p]=h.useState(void 0),[b,c]=h.useState(!1),[m,n]=h.useState(null),[o,j]=h.useState(!1),[N,i]=h.useState(!1),[w,$]=h.useState(null),v=J(),{mutateAsync:L}=te(),{mutateAsync:I}=se(),{mutateAsync:O}=ae(),{refetch:k}=X(),{data:R,isLoading:A,isPending:_,refetch:q,isFetching:Q}=le(t,5,d,u);h.useEffect(()=>(l({title:"مدیریت درخواست‌های همکاری پزشکان"}),()=>{l({title:void 0,backButton:!1})}),[l]),h.useEffect(()=>{s.trim()?f(!0):f(!1)},[s]),h.useEffect(()=>{A||d===s&&f(!1)},[A,d,s]);const K=(x,y)=>{n({id:x,name:y}),c(!0)},U=async()=>{if(m){j(!0);try{await k(),await L(m.id),D("درخواست با موفقیت حذف شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]}),c(!1),n(null)}catch(x){const y=x?.response?.data?.message||"خطایی در حذف درخواست رخ داد";M(y)}finally{j(!1)}}},F=()=>{o||(c(!1),n(null))},P=async x=>{try{await k(),await I(x),D("درخواست به عنوان خوانده شده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]})}catch(y){const C=y?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت درخواست رخ داد";M(C)}},V=async x=>{try{await k(),await O(x),D("درخواست به عنوان خوانده نشده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]})}catch(y){const C=y?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت درخواست رخ داد";M(C)}},z=x=>{$(x),i(!0)},B=()=>{i(!1),$(null)},G=R?.data?.applications||[],H=R?.meta;return e.jsxs("main",{children:[e.jsxs(ce,{children:[e.jsx(xe,{}),e.jsx("h5",{className:"main-header ",children:"لیست درخواست‌ها"}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row  justify-between gap-4",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(Y,{labelText:"جستجو",placeholder:"جستجو بر اساس نام، ایمیل، شماره تماس یا اطلاعات...",className:"bg-white pr-12",value:s,onChange:x=>{a(x.target.value),r(1)}}),g&&s&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("label",{className:"text-sm font-estedad-semibold mb-2",children:"فیلتر وضعیت:"}),e.jsxs("select",{value:u===void 0?"all":u?"read":"unread",onChange:x=>{const y=x.target.value;p(y==="all"?void 0:y==="read"),r(1)},className:"px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"همه"}),e.jsx("option",{value:"read",children:"خوانده شده"}),e.jsx("option",{value:"unread",children:"خوانده نشده"})]})]})]}),e.jsx(me,{applications:G,isLoadingApplications:A||_,page:t,onDeleteClick:K,onMarkAsRead:P,onMarkAsUnread:V,onApplicationClick:z,onRefetch:q,isRefetching:Q}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(re,{meta:H,onPageChange:x=>r(x)})})]}),e.jsx(oe,{isOpen:b,onClose:F,onConfirm:U,title:"حذف درخواست",message:`آیا از حذف درخواست ${m?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:o}),e.jsx(he,{isOpen:N,onClose:B,application:w})]})}export{$e as default};
