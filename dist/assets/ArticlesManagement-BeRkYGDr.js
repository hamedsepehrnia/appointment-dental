import{j as e,b as I}from"./query-vendor-KlcNboas.js";import{e as M,a as i}from"./react-vendor-vqeg7uDR.js";import{c as R,N as E,g as L,s as P,l as F,T as O,G as H,O as Q,S as _,C as $,Q as q,R as B,h as G,i as J}from"./index-NfFM6Un-.js";import{b as K,u as U}from"./useArticles-DimZK4_i.js";import{A as z}from"./ArticleManagementForm-DTMD59ig.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";import"./useCategories-i49FICbm.js";import"./TextEditor-oOZGSyVD.js";import"./editor-vendor-CyaMQeXG.js";function V(c){const s=R.c(15),{articles:o,isLoadingArticles:a,page:j,onDeleteClick:m,onRefetch:p,isRefetching:g}=c,f=g===void 0?!1:g,x=M();let r;s[0]!==f||s[1]!==p?(r=p&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:p,disabled:f,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[f?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),s[0]=f,s[1]=p,s[2]=r):r=s[2];let d;s[3]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"مقاله"}),e.jsx("th",{children:"خلاصه"}),e.jsx("th",{children:"دسته‌بندی‌ها"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),s[3]=d):d=s[3];let l;s[4]!==o||s[5]!==a||s[6]!==x||s[7]!==m||s[8]!==j?(l=a?e.jsx(E,{rows:5,columns:7}):o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center p-8 font-estedad-light",children:"مقاله‌ای یافت نشد"})}):o.map((t,b)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(j-1)*5+b+1}),e.jsx("td",{className:"  ",children:e.jsxs("div",{className:"flex items-center gap-3 min-w-[240px] ",children:[t.coverImage?e.jsx("img",{src:L(t.coverImage),alt:t.title,className:"w-12 h-12 rounded-lg object-cover shrink-0"}):e.jsx("div",{className:"w-12 h-12 rounded-lg bg-gray-200 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-file-alt text-gray-400"})}),e.jsx("div",{children:e.jsx("p",{className:"font-estedad-light",children:e.jsx("span",{className:"line-clamp-2",children:t.title})})})]})}),e.jsx("td",{className:"text-dark font-estedad-light min-w-[240px] max-w-[260px]",children:t.excerpt?e.jsx("span",{className:"line-clamp-2",children:P(t.excerpt)}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:t.categories&&t.categories.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[t.categories.slice(0,2).map(W),t.categories.length>2&&e.jsxs("span",{className:"px-2 py-1 text-xs rounded-full bg-gray-100 text-gray-600",children:["+",t.categories.length-2]})]}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:t.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700",children:"پیش‌نویس"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:F(new Date(t.createdAt||new Date))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{x(`/admin/articles-management/edit/${t.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>m(t.id,t.title),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},t.id)),s[4]=o,s[5]=a,s[6]=x,s[7]=m,s[8]=j,s[9]=l):l=s[9];let n;s[10]!==l?(n=e.jsx(O,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[d,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:l})]})}),s[10]=l,s[11]=n):n=s[11];let u;return s[12]!==r||s[13]!==n?(u=e.jsxs(e.Fragment,{children:[r,n]}),s[12]=r,s[13]=n,s[14]=u):u=s[14],u}function W(c){return e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary text-center line-clamp-2 text-nowrap",children:c.name},c.id)}function de(){const{setHeaderConfig:c}=H(),[s,o]=i.useState(1),[a,j]=i.useState(""),[m]=Q(a,500),[p,g]=i.useState(!1),[f,x]=i.useState(!1),[r,d]=i.useState(null),[l,n]=i.useState(!1),u=I(),{mutateAsync:t}=K(),{data:b,isLoading:N,isPending:v,refetch:w,isFetching:A}=U(s,5,m,"");i.useEffect(()=>(c({title:"مدیریت مقالات"}),()=>{c({title:void 0,backButton:!1})}),[c]),i.useEffect(()=>{a.trim()?g(!0):g(!1)},[a]),i.useEffect(()=>{N||m===a&&g(!1)},[N,m,a]);const C=(h,y)=>{d({id:h,title:y}),x(!0)},D=async()=>{if(r){n(!0);try{await t(r.id),G("مقاله با موفقیت حذف شد"),u.invalidateQueries({queryKey:["articles"]}),x(!1),d(null)}catch(h){const y=h?.response?.data?.message||"خطایی در حذف مقاله رخ داد";J(y)}finally{n(!1)}}},S=()=>{l||(x(!1),d(null))},k=b?.data?.articles||[],T=b?.meta;return e.jsxs("main",{children:[e.jsxs(_,{children:[e.jsx("h5",{className:"main-header ",children:"لیست مقالات"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx($,{labelText:"جستجو",placeholder:"جستجو بر اساس عنوان، خلاصه یا محتوا...",className:"bg-white pr-12",value:a,onChange:h=>{j(h.target.value),o(1)}}),p&&a&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]})}),e.jsx(V,{articles:k,isLoadingArticles:N||v,page:s,onDeleteClick:C,onRefetch:w,isRefetching:A}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(q,{meta:T,onPageChange:h=>o(h)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(z,{})]}),e.jsx(B,{isOpen:f,onClose:S,onConfirm:D,title:"حذف مقاله",message:`آیا از حذف مقاله "${r?.title}" اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:l})]})}export{de as default};
