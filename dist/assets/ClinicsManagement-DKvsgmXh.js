import{j as e,b as D}from"./query-vendor-KlcNboas.js";import{e as I,a as x}from"./react-vendor-vqeg7uDR.js";import{c as T,N as k,g as S,l as M,T as R,G as E,X as O,j as P,S as A,Q as L,R as $,h as F,i as _}from"./index-D-ec5iYs.js";import{C as J}from"./ClinicManagementForm-DRqK1WRn.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function Q(f){const t=T.c(15),{clinics:h,isLoadingClinics:u,page:d,onDeleteClick:o,onRefetch:n,isRefetching:p}=f,m=p===void 0?!1:p,j=I();let l;t[0]!==m||t[1]!==n?(l=n&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:n,disabled:m,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[m?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=m,t[1]=n,t[2]=l):l=t[2];let a;t[3]===Symbol.for("react.memo_cache_sentinel")?(a=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"تصویر"}),e.jsx("th",{children:"نام کلینیک"}),e.jsx("th",{children:"آدرس"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"تعداد پزشکان"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=a):a=t[3];let r;t[4]!==h||t[5]!==u||t[6]!==j||t[7]!==o||t[8]!==d?(r=u?e.jsx(k,{rows:5,columns:8}):h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"کلینیکی یافت نشد"})}):h.map((s,b)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(d-1)*5+b+1}),e.jsxs("td",{children:[(fetch("http://127.0.0.1:7242/ingest/c5282bb0-1a44-499c-bce8-9a51f667292e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"ClinicManagementTable.tsx:77",message:"Rendering clinic image",data:{clinicId:s.id,clinicName:s.name,clinicImage:s.image,clinicImageNull:s.image===null,clinicImageUndefined:s.image===void 0,clinicImageTruthy:!!s.image},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(q),null),s.image?e.jsx("img",{src:S(s.image),alt:s.name,className:"w-16 h-16 rounded-lg object-cover"},`${s.id}-${s.image||"no-image"}`):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-200 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-image text-gray-400"})})]}),e.jsx("td",{className:"min-w-[200px]",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-estedad-light line-clamp-2",children:s.name}),s.description&&e.jsxs("span",{className:"text-xs font-estedad-light text-paragray line-clamp-2",children:[s.description.substring(0,30),"..."]})]})}),e.jsx("td",{className:"text-dark font-estedad-light min-w-[260px] max-w-[260px]",children:e.jsx("span",{className:"line-clamp-2",children:s.address})}),e.jsx("td",{className:"text-dark text-nowrap font-estedad-light",children:s.phoneNumber||"-"}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:s._count?.doctors||0}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:s.createdAt?M(new Date(s.createdAt)):"-"}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{j(`/admin/clinics-management/edit/${s.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>o(s.id,s.name),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},s.id)),t[4]=h,t[5]=u,t[6]=j,t[7]=o,t[8]=d,t[9]=r):r=t[9];let c;t[10]!==r?(c=e.jsx(R,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[a,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:r})]})}),t[10]=r,t[11]=c):c=t[11];let g;return t[12]!==l||t[13]!==c?(g=e.jsxs(e.Fragment,{children:[l,c]}),t[12]=l,t[13]=c,t[14]=g):g=t[14],g}function q(){}function V(){const{setHeaderConfig:f}=E(),[t,h]=x.useState(1),[u,d]=x.useState(!1),[o,n]=x.useState(null),[p,m]=x.useState(!1),j=D(),{mutateAsync:l}=O(),{data:a,isLoading:r,isPending:c,refetch:g,isFetching:s}=P(t,5);x.useEffect(()=>{fetch("http://127.0.0.1:7242/ingest/c5282bb0-1a44-499c-bce8-9a51f667292e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"ClinicsManagement.tsx:33",message:"ClinicsManagement mounted, checking clinics data",data:{clinicsCount:a?.data?.clinics?.length||0,clinicsWithImages:a?.data?.clinics?.filter(i=>i.image).length||0,clinicsWithoutImages:a?.data?.clinics?.filter(i=>!i.image).length||0,firstClinicImage:a?.data?.clinics?.[0]?.image||null},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{})},[a]),x.useEffect(()=>(f({title:"مدیریت کلینیک‌ها"}),()=>{f({title:void 0,backButton:!1})}),[f]);const b=(i,N)=>{n({id:i,name:N}),d(!0)},y=async()=>{if(o){m(!0);try{await l(o.id),F("کلینیک با موفقیت حذف شد"),j.invalidateQueries({queryKey:["clinics"]}),d(!1),n(null)}catch(i){const N=i?.response?.data?.message||"خطایی در حذف کلینیک رخ داد";_(N)}finally{m(!1)}}},C=()=>{p||(d(!1),n(null))},w=a?.data?.clinics||[],v=a?.meta;return e.jsxs("main",{children:[e.jsxs(A,{children:[e.jsx("h5",{className:"main-header ",children:"لیست کلینیک‌ها"}),e.jsx(Q,{clinics:w,isLoadingClinics:r||c,page:t,onDeleteClick:b,onRefetch:g,isRefetching:s}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(L,{meta:v,onPageChange:i=>h(i)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(J,{})]}),e.jsx($,{isOpen:u,onClose:C,onConfirm:y,title:"حذف کلینیک",message:`آیا از حذف کلینیک ${o?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:p})]})}export{V as default};
