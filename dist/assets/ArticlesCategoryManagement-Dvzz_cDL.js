import{j as e,c as k}from"./query-vendor-DvaUDqTV.js";import{u as T,a as d}from"./react-vendor-dTsWsAAn.js";import{c as A,C as L,s as M,b as E}from"./index-aQCH0W4b.js";import{u as R}from"./useAdminDashboardHeader-CFWWO3br.js";import{a as I,u as F}from"./useCategories-Dpf4IxAQ.js";import{T as H}from"./TableContainer-CEnoSnre.js";import{T as O,D as _}from"./DeleteModal-6GmkfVBc.js";import{s as $,f as q}from"./helpers-DOyc9qlM.js";import{a as B}from"./index.module-BblzqiS0.js";import{A as P}from"./ArticlesCategoryManagementForm-CMm931-5.js";import{S as Q}from"./SectionContainer-Dtc5qGCy.js";import"./redux-vendor-5gwm_VuO.js";import"./ui-vendor-B68-Q-v-.js";import"./form-vendor--jwUxY8R.js";import"./motion-vendor-CQyDv_CV.js";import"./CustomTextArea--mx9jQzV.js";function G(p){const t=A.c(14),{categories:f,isLoadingCategories:n,onDeleteClick:g,onRefetch:l,isRefetching:b}=p,o=b===void 0?!1:b,m=T();let a;t[0]!==o||t[1]!==l?(a=l&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:l,disabled:o,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[o?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=o,t[1]=l,t[2]=a):a=t[2];let h;t[3]===Symbol.for("react.memo_cache_sentinel")?(h=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"نام دسته‌بندی"}),e.jsx("th",{children:"توضیحات"}),e.jsx("th",{children:"ترتیب نمایش"}),e.jsx("th",{children:"تعداد مقالات"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=h):h=t[3];let r;t[4]!==f||t[5]!==n||t[6]!==m||t[7]!==g?(r=n?e.jsx(O,{rows:5,columns:8}):f.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"دسته‌بندی‌ای یافت نشد"})}):f.map((s,j)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:j+1}),e.jsx("td",{className:"",children:e.jsx("div",{className:"min-w-[200px]",children:e.jsx("p",{className:"font-estedad-light line-clamp-2 ",children:s.name})})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.description?e.jsx("span",{className:"line-clamp-2 min-w-[200px]",children:$(s.description)}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:s.order??0}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:s._count?.articles??0}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 text-nowrap",children:"پیش‌نویس"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:s.createdAt?q(new Date(s.createdAt)):"-"}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{m(`/admin/articles-category-management/edit/${s.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>g(s.id,s.name),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},s.id)),t[4]=f,t[5]=n,t[6]=m,t[7]=g,t[8]=r):r=t[8];let c;t[9]!==r?(c=e.jsx(H,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[h,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:r})]})}),t[9]=r,t[10]=c):c=t[10];let u;return t[11]!==a||t[12]!==c?(u=e.jsxs(e.Fragment,{children:[a,c]}),t[11]=a,t[12]=c,t[13]=u):u=t[13],u}function oe(){const{setHeaderConfig:p}=R(),[t,f]=d.useState(""),[n]=B(t,500),[g,l]=d.useState(!1),[b,o]=d.useState(!1),[m,a]=d.useState(null),[h,r]=d.useState(!1),c=k(),{mutateAsync:u}=I(),{data:s,isLoading:j,isPending:C,refetch:N,isFetching:w}=F();d.useEffect(()=>(p({title:"مدیریت دسته‌بندی مقالات"}),()=>{p({title:void 0,backButton:!1})}),[p]),d.useEffect(()=>{t.trim()?l(!0):l(!1)},[t]),d.useEffect(()=>{j||n===t&&l(!1)},[j,n,t]);const v=(i,x)=>{a({id:i,name:x}),o(!0)},y=async()=>{if(m){r(!0);try{await u(m.id),M("دسته‌بندی با موفقیت حذف شد"),c.invalidateQueries({queryKey:["articleCategories"]}),o(!1),a(null)}catch(i){const x=i?.response?.data?.message||"خطایی در حذف دسته‌بندی رخ داد";E(x)}finally{r(!1)}}},D=()=>{h||(o(!1),a(null))},S=(s?.data?.categories||[]).filter(i=>{if(!n.trim())return!0;const x=n.toLowerCase();return i.name?.toLowerCase().includes(x)||i.description?.toLowerCase().includes(x)||i.slug?.toLowerCase().includes(x)});return e.jsxs("main",{children:[e.jsxs(Q,{children:[e.jsx("h5",{className:"main-header ",children:"لیست دسته‌بندی‌ها"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(L,{labelText:"جستجو",placeholder:"جستجو بر اساس نام، توضیحات یا slug...",className:"bg-white pr-12",value:t,onChange:i=>{f(i.target.value)}}),g&&t&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]})}),e.jsx(G,{categories:S,isLoadingCategories:j||C,onDeleteClick:v,onRefetch:N,isRefetching:w}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(P,{})]}),e.jsx(_,{isOpen:b,onClose:D,onConfirm:y,title:"حذف دسته‌بندی",message:`آیا از حذف دسته‌بندی ${m?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:h})]})}export{oe as default};
