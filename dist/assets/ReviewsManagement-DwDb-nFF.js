import{j as e,c as F}from"./query-vendor-DvaUDqTV.js";import{u as H,a as h}from"./react-vendor-dTsWsAAn.js";import{c as R,m as w,A as V,C as q,s as z,b as B}from"./index-Cr8hLwb7.js";import{u as Q}from"./useAdminDashboardHeader-CFWWO3br.js";import{b as G,c as J}from"./useReviews-CLmR9gdQ.js";import{A as K}from"./AdminPagination-Tws6WsYb.js";import{T as U}from"./TableContainer-BNW3tjli.js";import{T as W,D as X}from"./DeleteModal-ZkzQdZ_j.js";import{s as Y,f as k}from"./helpers-DOyc9qlM.js";import{a as Z}from"./index.module-BblzqiS0.js";import{R as ee}from"./ReviewManagementForm-DkxKHFSh.js";import{S as te}from"./SectionContainer-BAFuz5jC.js";import"./redux-vendor-5gwm_VuO.js";import"./ui-vendor-B68-Q-v-.js";import"./form-vendor--jwUxY8R.js";import"./motion-vendor-CQyDv_CV.js";import"./CustomTextArea-CtTY3zyz.js";function se(n){const t=R.c(16),{reviews:r,isLoadingReviews:s,page:a,onDeleteClick:m,onReviewClick:x,onRefetch:c,isRefetching:b}=n,p=b===void 0?!1:b,d=H();let i;t[0]!==p||t[1]!==c?(i=c&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:c,disabled:p,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[p?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=p,t[1]=c,t[2]=i):i=t[2];let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"نام"}),e.jsx("th",{children:"متن نظر"}),e.jsx("th",{children:"امتیاز"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"ترتیب"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=o):o=t[3];let f;t[4]!==s||t[5]!==d||t[6]!==m||t[7]!==x||t[8]!==a||t[9]!==r?(f=s?e.jsx(W,{rows:5,columns:8}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"نظری یافت نشد"})}):r.map((l,y)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(a-1)*5+y+1}),e.jsx("td",{className:"min-w-[150px] pr-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[l.profileImage?e.jsx("img",{src:`http://localhost:4000${l.profileImage}`,alt:l.name,className:"w-12 h-12 rounded-full object-cover shrink-0"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-user text-gray-400"})}),e.jsx("div",{children:e.jsx("p",{className:"font-estedad-light line-clamp-2 max-w-[300px] min-w-[220px]",children:l.name})})]})}),e.jsx("td",{className:"text-dark font-estedad-light  pr-6",children:e.jsx("span",{className:`line-clamp-2 max-w-[300px] min-w-[220px] ${x?"cursor-pointer hover:text-primary transition-colors":""}`,onClick:()=>x?.(l),title:x?"کلیک برای مشاهده جزئیات":"",children:Y(l.content||"")})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsxs("div",{className:"flex gap-1 text-yellow-500",children:[Array.from({length:l.rating}).map(le),Array.from({length:5-l.rating}).map(ae)]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:l.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 text-nowrap",children:"در انتظار تایید"})}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:l.order}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:k(new Date(l.createdAt||new Date))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center  gap-2",children:[e.jsx("button",{onClick:()=>{d(`/admin/reviews-management/edit/${l.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>m(l.id,l.name),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},l.id)),t[4]=s,t[5]=d,t[6]=m,t[7]=x,t[8]=a,t[9]=r,t[10]=f):f=t[10];let g;t[11]!==f?(g=e.jsx(U,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[o,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:f})]})}),t[11]=f,t[12]=g):g=t[12];let j;return t[13]!==i||t[14]!==g?(j=e.jsxs(e.Fragment,{children:[i,g]}),t[13]=i,t[14]=g,t[15]=j):j=t[15],j}function ae(n,t){return e.jsx("i",{className:"fas fa-star text-gray-300 "},t)}function le(n,t){return e.jsx("i",{className:"fas fa-star "},t)}function re(n){const t=R.c(13),{isOpen:r,onClose:s,review:a}=n;let m,x;t[0]!==r||t[1]!==s?(m=()=>{const o=f=>{f.key==="Escape"&&r&&s()};return r&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow="unset"}},x=[r,s],t[0]=r,t[1]=s,t[2]=m,t[3]=x):(m=t[2],x=t[3]),h.useEffect(m,x);let c;t[4]!==s?(c=o=>{o.target===o.currentTarget&&s()},t[4]=s,t[5]=c):c=t[5];const b=c,p=ie;let d;t[6]!==b||t[7]!==r||t[8]!==s||t[9]!==a?(d=r&&a&&e.jsxs(w.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:b,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(w.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(w.div,{className:"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30,duration:.3},children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-star text-white text-xl"})}),e.jsx("h3",{className:"text-xl font-estedad-semibold text-white",children:"مشاهده نظر"})]}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full bg-white/20 hover:bg-white/30 flex items-center justify-center transition-colors","aria-label":"بستن",children:e.jsx("i",{className:"fa fa-times text-white"})})]})}),e.jsx("div",{className:"px-6 py-6 overflow-y-auto flex-1 admin-modal-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-2",children:"نام"}),e.jsxs("div",{className:"flex items-center gap-3",children:[a.profileImage?e.jsx("img",{src:`http://localhost:4000${a.profileImage}`,alt:a.name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-gray-200 flex items-center justify-center",children:e.jsx("i",{className:"far fa-user text-gray-400 text-2xl"})}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.name})]})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"متن نظر"}),e.jsx("p",{className:"text-dark font-estedad-light text-base leading-7 whitespace-pre-wrap",children:a.content})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"امتیاز"}),e.jsx("div",{children:p(a.rating)})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"وضعیت"}),a.published?e.jsx("span",{className:"px-3 py-1.5 text-sm rounded-full bg-green-100 text-green-700 font-estedad-medium",children:"منتشر شده"}):e.jsx("span",{className:"px-3 py-1.5 text-sm rounded-full bg-yellow-100 text-yellow-700 font-estedad-medium",children:"در انتظار تایید"})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"ترتیب"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:a.order})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ ایجاد"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:k(new Date(a.createdAt))})]}),a.updatedAt&&a.updatedAt!==a.createdAt&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ به‌روزرسانی"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:k(new Date(a.updatedAt))})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:s,className:"px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors",children:"بستن"})})})]})]}),t[6]=b,t[7]=r,t[8]=s,t[9]=a,t[10]=d):d=t[10];let i;return t[11]!==d?(i=e.jsx(V,{mode:"wait",children:d}),t[11]=d,t[12]=i):i=t[12],i}function ie(n){return e.jsxs("div",{className:"flex items-center gap-1",children:[Array.from({length:n}).map(de),Array.from({length:5-n}).map(ne)]})}function ne(n,t){return e.jsx("i",{className:"fas fa-star text-gray-300"},t)}function de(n,t){return e.jsx("i",{className:"fas fa-star text-yellow-400"},t)}function Re(){const{setHeaderConfig:n}=Q(),[t,r]=h.useState(1),[s,a]=h.useState(""),[m]=Z(s,500),[x,c]=h.useState(!1),[b,p]=h.useState(!1),[d,i]=h.useState(null),[o,f]=h.useState(!1),[g,j]=h.useState(!1),[l,y]=h.useState(null),S=F(),{mutateAsync:D}=G(),{data:C,isLoading:N,isPending:A,refetch:T,isFetching:E}=J(t,5,m);h.useEffect(()=>(n({title:"مدیریت دیدگاه ها"}),()=>{n({title:void 0,backButton:!1})}),[n]),h.useEffect(()=>{s.trim()?c(!0):c(!1)},[s]),h.useEffect(()=>{N||m===s&&c(!1)},[N,m,s]);const M=(u,v)=>{i({id:u,name:v}),p(!0)},_=async()=>{if(d){f(!0);try{await D(d.id),z("نظر با موفقیت حذف شد"),S.invalidateQueries({queryKey:["reviews"]}),p(!1),i(null)}catch(u){const v=u?.response?.data?.message||"خطایی در حذف نظر رخ داد";B(v)}finally{f(!1)}}},I=()=>{o||(p(!1),i(null))},$=u=>{y(u),j(!0)},O=()=>{j(!1),y(null)},L=C?.data?.reviews||[],P=C?.meta;return e.jsxs("main",{children:[e.jsxs(te,{children:[e.jsx("h5",{className:"main-header ",children:"لیست نظرات"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(q,{labelText:"جستجو",placeholder:"جستجو بر اساس نام یا متن نظر...",className:"bg-white pr-12",value:s,onChange:u=>{a(u.target.value),r(1)}}),x&&s&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]})}),e.jsx(se,{reviews:L,isLoadingReviews:N||A,page:t,onDeleteClick:M,onReviewClick:$,onRefetch:T,isRefetching:E}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(K,{meta:P,onPageChange:u=>r(u)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(ee,{})]}),e.jsx(X,{isOpen:b,onClose:I,onConfirm:_,title:"حذف نظر",message:`آیا از حذف نظر ${d?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:o}),e.jsx(re,{isOpen:g,onClose:O,review:l})]})}export{Re as default};
