import{a as w,u as f,c as S,j as r}from"./query-vendor-DvaUDqTV.js";import{a as y,u as T}from"./react-vendor-dTsWsAAn.js";import{c as v,e as I,b as C,f as $,a as h,F as q}from"./form-vendor--jwUxY8R.js";import{c as g,r as x,C as b,s as N,b as M}from"./index-D1LHzErR.js";import{C as P}from"./CustomTextArea-xgSORRfA.js";const _=(t,s,o)=>{const a=g.c(4),i=t===void 0?1:t,l=s;let c;return a[0]!==l||a[1]!==i||a[2]!==o?(c={queryKey:["insurances",i,l,o],queryFn:async()=>{const u=new URLSearchParams({page:i.toString(),limit:l.toString()});return(await x.get(`/insurance?${u.toString()}`)).data},staleTime:3e5},a[0]=l,a[1]=i,a[2]=o,a[3]=c):c=a[3],f(c)},B=t=>{const s=g.c(7);let o,a;s[0]!==t?(o=["insurance",t],a=async()=>(await x.get(`/insurance/${t}`)).data,s[0]=t,s[1]=o,s[2]=a):(o=s[1],a=s[2]);const i=!!t;let l;return s[3]!==o||s[4]!==a||s[5]!==i?(l={queryKey:o,queryFn:a,staleTime:3e5,enabled:i},s[3]=o,s[4]=a,s[5]=i,s[6]=l):l=s[6],f(l)},Q=()=>{const t=g.c(1);let s;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s={mutationFn:K},t[0]=s):s=t[0],w(s)},D=()=>{const t=g.c(1);let s;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s={mutationFn:R},t[0]=s):s=t[0],w(s)},z=()=>{const t=g.c(1);let s;return t[0]===Symbol.for("react.memo_cache_sentinel")?(s={mutationFn:E},t[0]=s):s=t[0],w(s)};async function K(t){return(await x.post("/insurance",t,{headers:t instanceof FormData?{"Content-Type":"multipart/form-data"}:void 0})).data}async function R(t){const{id:s,data:o}=t;return(await x.patch(`/insurance/${s}`,o,{headers:o instanceof FormData?{"Content-Type":"multipart/form-data"}:void 0})).data}async function E(t){return(await x.delete(`/insurance/${t}`)).data}function H({insurance:t}){const s=y.useRef(null),o=T(),a=S(),{mutateAsync:i}=Q(),{mutateAsync:l}=D(),[c,u]=y.useState(!1),p=!!t?.id,j=y.useMemo(()=>v({name:h().required("نام سازمان بیمه الزامی است").min(2,"نام باید حداقل ۲ کاراکتر باشد").max(100,"نام نباید بیشتر از ۱۰۰ کاراکتر باشد"),description:h().max(1e3,"توضیحات نباید بیشتر از ۱۰۰۰ کاراکتر باشد"),website:h().url("آدرس وب‌سایت معتبر نیست").nullable(),phoneNumber:h().nullable(),email:h().email("ایمیل معتبر نیست").nullable(),logo:$().nullable(),order:C().integer("ترتیب باید عدد صحیح باشد").min(0,"ترتیب نمی‌تواند منفی باشد"),published:I()}),[]),F=async(e,m)=>{try{const n=new FormData;if(n.append("name",e.name),n.append("published",e.published.toString()),n.append("order",e.order.toString()),e.description&&n.append("description",e.description),e.website&&n.append("website",e.website),e.phoneNumber&&n.append("phoneNumber",e.phoneNumber),e.email&&n.append("email",e.email),e.logo&&n.append("logo",e.logo),c&&p&&n.append("removeLogo","true"),p&&t?.id){const d=await l({id:t.id,data:n});N("سازمان بیمه با موفقیت ویرایش شد"),u(!1),d?.data?.insurance&&a.setQueryData(["insurance",t.id],d),a.invalidateQueries({queryKey:["insurances"]}),a.invalidateQueries({queryKey:["insurance",t.id]}),o("/admin/insurance-management")}else{await i(n),N("سازمان بیمه با موفقیت ایجاد شد"),m(),a.invalidateQueries({queryKey:["insurances"]}),a.invalidateQueries({queryKey:["insurance"]});const d=document.querySelector(".overflow-auto");d?d.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{s.current&&(s.current.value="")},0)}catch(n){const d=n?.response?.data?.message||(p?"خطایی در ویرایش سازمان بیمه رخ داد":"خطایی در ایجاد سازمان بیمه رخ داد");M(d)}};return r.jsx(q,{initialValues:{name:t?.name||"",description:t?.description||"",website:t?.website||"",phoneNumber:t?.phoneNumber||"",email:t?.email||"",logo:null,order:t?.order??0,published:t?.published??!0},validationSchema:j,onSubmit:async(e,{resetForm:m})=>{await F({name:e.name,description:e.description||void 0,website:e.website||void 0,phoneNumber:e.phoneNumber||void 0,email:e.email||void 0,logo:e.logo,published:e.published,order:e.order},m)},children:e=>{const m=t?.logo&&!e.values.logo&&!c;return r.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[r.jsx(b,{labelText:"نام سازمان بیمه",placeholder:"نام سازمان بیمه را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("name"),errorMessage:e.touched.name&&e.errors.name?e.errors.name:null}),r.jsx(P,{labelText:"توضیحات",placeholder:"توضیحات سازمان بیمه را وارد کنید",optional:!0,rows:4,className:"bg-white",...e.getFieldProps("description"),errorMessage:e.touched.description&&e.errors.description?e.errors.description:null}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r.jsx(b,{labelText:"وب‌سایت",placeholder:"آدرس وب‌سایت را وارد کنید",className:"bg-white",optional:!0,...e.getFieldProps("website"),errorMessage:e.touched.website&&e.errors.website?e.errors.website:null}),r.jsx(b,{labelText:"شماره تماس",placeholder:"شماره تماس را وارد کنید",className:"bg-white",optional:!0,...e.getFieldProps("phoneNumber"),errorMessage:e.touched.phoneNumber&&e.errors.phoneNumber?e.errors.phoneNumber:null}),r.jsx(b,{labelText:"ایمیل",placeholder:"ایمیل را وارد کنید",className:"bg-white",optional:!0,inputType:"email",...e.getFieldProps("email"),errorMessage:e.touched.email&&e.errors.email?e.errors.email:null}),r.jsx(b,{labelText:"ترتیب",placeholder:"ترتیب نمایش را وارد کنید",className:"bg-white",inputType:"number",...e.getFieldProps("order"),errorMessage:e.touched.order&&e.errors.order?e.errors.order:null}),r.jsx("div",{className:"flex items-center gap-4 pt-8",children:r.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:e.values.published,onChange:n=>e.setFieldValue("published",n.target.checked),className:"w-5 h-5 rounded border-2 border-main-border-color text-primary focus:ring-primary"}),r.jsx("span",{className:"text-dark font-estedad-lightbold",children:"منتشر شده"})]})})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"لوگو"}),r.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[r.jsx("input",{ref:s,type:"file",accept:"image/*",className:"hidden ",onChange:n=>{const d=n.target.files?.[0]||null;e.setFieldValue("logo",d),u(!1)}}),r.jsx("button",{type:"button",onClick:()=>{s.current?.click(),u(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.logo instanceof File&&r.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.logo.name}),m&&r.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[r.jsx("img",{src:`http://localhost:4000${t.logo}`,alt:t.name||"لوگو سازمان بیمه",className:"w-12 h-12 rounded-lg object-cover"}),r.jsx("span",{className:"text-sm text-paragray",children:"لوگوی فعلی"}),r.jsx("button",{type:"button",onClick:()=>{u(!0),e.setFieldValue("logo",null),s.current&&(s.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),c&&r.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),r.jsx("div",{className:"flex justify-end mt-6",children:r.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[p?"ویرایش سازمان بیمه":"ایجاد سازمان بیمه",e.isSubmitting&&r.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{H as I,_ as a,B as b,z as u};
