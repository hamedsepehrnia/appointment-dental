import{a as h,u as I,c as N,j as a}from"./query-vendor-DvaUDqTV.js";import{a as b,u as S}from"./react-vendor-dTsWsAAn.js";import{c as F,f as $,e as C,b as T,a as f,F as q}from"./form-vendor--jwUxY8R.js";import{c as p,r as m,C as j,b as y,s as w}from"./index-J2TYnO22.js";import{C as G}from"./CustomTextArea-C__Mc83G.js";const V=(t,r,l)=>{const s=p.c(4),d=t===void 0?1:t,c=r;let n;return s[0]!==c||s[1]!==d||s[2]!==l?(n={queryKey:["gallery",d,c,l],queryFn:async()=>{const g=new URLSearchParams({page:d.toString(),limit:c.toString()});return(await m.get(`/gallery?${g.toString()}`)).data},staleTime:3e5},s[0]=c,s[1]=d,s[2]=l,s[3]=n):n=s[3],I(n)},U=t=>{const r=p.c(7);let l,s;r[0]!==t?(l=["gallery",t],s=async()=>(await m.get(`/gallery/${t}`)).data,r[0]=t,r[1]=l,r[2]=s):(l=r[1],s=r[2]);const d=!!t;let c;return r[3]!==l||r[4]!==s||r[5]!==d?(c={queryKey:l,queryFn:s,staleTime:3e5,enabled:d},r[3]=l,r[4]=s,r[5]=d,r[6]=c):c=r[6],I(c)},v=()=>{const t=p.c(1);let r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r={mutationFn:Q},t[0]=r):r=t[0],h(r)},M=()=>{const t=p.c(1);let r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r={mutationFn:E},t[0]=r):r=t[0],h(r)},B=()=>{const t=p.c(1);let r;return t[0]===Symbol.for("react.memo_cache_sentinel")?(r={mutationFn:K},t[0]=r):r=t[0],h(r)};async function Q(t){return(await m.post("/gallery",t,{headers:{"Content-Type":"multipart/form-data"}})).data}async function E(t){const{id:r,data:l}=t;return(await m.patch(`/gallery/${r}`,l,{headers:{"Content-Type":"multipart/form-data"}})).data}async function K(t){return(await m.delete(`/gallery/${t}`)).data}function L({image:t}){const r=b.useRef(null),l=S(),s=N(),{mutateAsync:d}=v(),{mutateAsync:c}=M(),n=!!t?.id,g=b.useMemo(()=>F({title:f().max(200,"عنوان نباید بیشتر از ۲۰۰ کاراکتر باشد"),description:f(),order:T().integer("ترتیب باید عدد صحیح باشد").min(0,"ترتیب نمی‌تواند منفی باشد"),published:C(),galleryImage:$().nullable().test("file-required","تصویر الزامی است",function(e){return n&&!e&&t?.image?!0:e!=null&&e!==""})}),[n]),x=async(e,u)=>{try{if(!n&&!e.galleryImage){y("لطفاً یک تصویر انتخاب کنید");return}if(n&&!e.galleryImage&&!t?.image){y("لطفاً یک تصویر انتخاب کنید");return}const i=new FormData;if(e.title&&i.append("title",e.title),e.description&&i.append("description",e.description),i.append("order",e.order.toString()),i.append("published",e.published.toString()),e.galleryImage&&i.append("galleryImage",e.galleryImage),n&&t?.id){const o=await c({id:t.id,data:i});w("تصویر با موفقیت ویرایش شد"),o?.data?.image&&s.setQueryData(["gallery",t.id],o),s.invalidateQueries({queryKey:["gallery"]}),s.invalidateQueries({queryKey:["gallery",t.id]}),l("/admin/gallery-management")}else{await d(i),w("تصویر با موفقیت آپلود شد"),u(),s.invalidateQueries({queryKey:["gallery"]});const o=document.querySelector(".overflow-auto");o?o.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{r.current&&(r.current.value="")},0)}catch(i){let o=i?.response?.data?.message||(n?"خطایی در ویرایش تصویر رخ داد":"خطایی در آپلود تصویر رخ داد");(o.includes("galleryImage cannot be null")||o.includes("galleryImage is required")||o.includes("cannot be null"))&&(o="تصویر الزامی است"),y(o)}};return a.jsx(q,{initialValues:{title:t?.title||"",description:t?.description||"",order:t?.order??0,published:t?.published??!0,galleryImage:null},validationSchema:g,onSubmit:async(e,{resetForm:u})=>{await x({title:e.title,description:e.description,order:e.order,published:e.published,galleryImage:e.galleryImage},u)},children:e=>{const u=t?.image&&!e.values.galleryImage;return a.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[a.jsx(j,{labelText:"عنوان",placeholder:"عنوان تصویر را وارد کنید",className:"bg-white",optional:!0,...e.getFieldProps("title"),errorMessage:e.touched.title&&e.errors.title?e.errors.title:null}),a.jsx(G,{labelText:"توضیحات",placeholder:"توضیحات تصویر را وارد کنید",optional:!0,rows:4,className:"bg-white",...e.getFieldProps("description"),errorMessage:e.touched.description&&e.errors.description?e.errors.description:null}),a.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[a.jsx(j,{labelText:"ترتیب",placeholder:"ترتیب نمایش را وارد کنید",className:"bg-white",inputType:"number",...e.getFieldProps("order"),errorMessage:e.touched.order&&e.errors.order?e.errors.order:null}),a.jsx("div",{className:"flex items-center gap-4 pt-8",children:a.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:e.values.published,onChange:i=>e.setFieldValue("published",i.target.checked),className:"w-5 h-5 rounded border-2 border-main-border-color text-primary focus:ring-primary"}),a.jsx("span",{className:"text-dark font-estedad-lightbold",children:"منتشر شده"})]})})]}),a.jsxs("div",{children:[a.jsxs("label",{className:"block text-dark font-estedad-lightbold mb-2 ",children:["تصویر ",!n&&a.jsx("span",{className:"text-red-500",children:"*"})]}),a.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[a.jsx("input",{ref:r,type:"file",accept:"image/*",className:"hidden ",onChange:i=>{const o=i.target.files?.[0]||null;e.setFieldValue("galleryImage",o)}}),a.jsx("button",{type:"button",onClick:()=>{r.current?.click()},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.galleryImage instanceof File&&a.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.galleryImage.name}),u&&a.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[a.jsx("img",{src:`${t.image}`,alt:t.title||"تصویر گالری",className:"w-12 h-12 rounded-lg object-cover"}),a.jsx("span",{className:"text-sm text-paragray",children:"تصویر فعلی"})]})]}),e.touched.galleryImage&&e.errors.galleryImage&&a.jsx("div",{className:"text-red-500 text-[10px] mr-4 mt-1 min-h-[20px]",children:e.errors.galleryImage})]}),a.jsx("div",{className:"flex justify-end mt-6",children:a.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[n?"ویرایش تصویر":"آپلود تصویر",e.isSubmitting&&a.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{L as G,V as a,U as b,B as u};
