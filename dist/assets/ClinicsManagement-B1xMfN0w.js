import{g as D,j as e,r as f}from"./react-core-DkX7OQ4Q.js";import{W as I,e as T,m as k,T as S,Q as M,a2 as _,j as A,Y as P,Z as E,_ as O,s as R,i as L}from"./index-DUiqV2No.js";import{b as W}from"./query-x6gLKhnn.js";import{a as $}from"./react-router-CdfMEooj.js";import{C as F}from"./ClinicManagementForm-DbnxmGxG.js";import"./vendor-BGjx4oOA.js";import"./map-dgLBSVMX.js";import"./motion-DV3VySaH.js";import"./editor-DLslrAMc.js";import"./redux-T8ZA8Ca5.js";import"./ui-CioiL3KZ.js";import"./forms-CxDKTD82.js";import"./swiper-CgWgy0A2.js";import"./seo-D35OfG1v.js";function J(s){const t=D.c(15),{clinics:n,isLoadingClinics:u,page:m,onDeleteClick:h,onRefetch:l,isRefetching:p}=s,g=p===void 0?!1:p,j=$();let c;t[0]!==g||t[1]!==l?(c=l&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:l,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=g,t[1]=l,t[2]=c):c=t[2];let i;t[3]===Symbol.for("react.memo_cache_sentinel")?(i=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"تصویر"}),e.jsx("th",{children:"نام کلینیک"}),e.jsx("th",{children:"آدرس"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"تعداد پزشکان"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=i):i=t[3];let d;t[4]!==n||t[5]!==u||t[6]!==j||t[7]!==h||t[8]!==m?(d=u?e.jsx(I,{rows:5,columns:8}):n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"کلینیکی یافت نشد"})}):n.map((a,y)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(m-1)*5+y+1}),e.jsxs("td",{children:[(fetch("http://127.0.0.1:7242/ingest/c5282bb0-1a44-499c-bce8-9a51f667292e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"ClinicManagementTable.tsx:77",message:"Rendering clinic image",data:{clinicId:a.id,clinicName:a.name,clinicImage:a.image,clinicImageNull:a.image===null,clinicImageUndefined:a.image===void 0,clinicImageTruthy:!!a.image},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(Y),null),a.image?e.jsx("img",{src:T(a.image),alt:a.name,className:"w-16 h-16 rounded-lg object-cover"},`${a.id}-${a.image||"no-image"}`):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-200 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-image text-gray-400"})})]}),e.jsx("td",{className:"min-w-[200px]",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-estedad-light line-clamp-2",children:a.name}),a.description&&e.jsxs("span",{className:"text-xs font-estedad-light text-paragray line-clamp-2",children:[a.description.substring(0,30),"..."]})]})}),e.jsx("td",{className:"text-dark font-estedad-light min-w-[260px] max-w-[260px]",children:e.jsx("span",{className:"line-clamp-2",children:a.address})}),e.jsx("td",{className:"text-dark font-estedad-light",children:(()=>{const b=q(a.phoneNumber);return b.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:b.map(Q)}):"-"})()}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:a._count?.doctors||0}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:a.createdAt?k(new Date(a.createdAt)):"-"}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{j(`/admin/clinics-management/edit/${a.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>h(a.id,a.name),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},a.id)),t[4]=n,t[5]=u,t[6]=j,t[7]=h,t[8]=m,t[9]=d):d=t[9];let o;t[10]!==d?(o=e.jsx(S,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[i,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:d})]})}),t[10]=d,t[11]=o):o=t[11];let x;return t[12]!==c||t[13]!==o?(x=e.jsxs(e.Fragment,{children:[c,o]}),t[12]=c,t[13]=o,t[14]=x):x=t[14],x}function Q(s,t){return e.jsx("span",{dir:"ltr",className:"text-nowrap",children:s},t)}function q(s){if(!s)return[];if(Array.isArray(s))return s.filter(K);if(typeof s=="string"){const t=s.trim();if(t.startsWith("[")&&t.endsWith("]"))try{const n=JSON.parse(t);if(Array.isArray(n))return n.filter(G).map(U)}catch{}return t.split(/[,|;|\n]/).map(H).filter(B)}return[]}function B(s){return s}function H(s){return s.trim()}function U(s){return String(s).trim()}function G(s){return s&&String(s).trim()}function K(s){return s&&s.trim()}function Y(){}function oe(){const{setHeaderConfig:s}=M(),[t,n]=f.useState(1),[u,m]=f.useState(!1),[h,l]=f.useState(null),[p,g]=f.useState(!1),j=W(),{mutateAsync:c}=_(),{data:i,isLoading:d,isPending:o,refetch:x,isFetching:a}=A(t,5);f.useEffect(()=>{fetch("http://127.0.0.1:7242/ingest/c5282bb0-1a44-499c-bce8-9a51f667292e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"ClinicsManagement.tsx:33",message:"ClinicsManagement mounted, checking clinics data",data:{clinicsCount:i?.data?.clinics?.length||0,clinicsWithImages:i?.data?.clinics?.filter(r=>r.image).length||0,clinicsWithoutImages:i?.data?.clinics?.filter(r=>!r.image).length||0,firstClinicImage:i?.data?.clinics?.[0]?.image||null},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{})},[i]),f.useEffect(()=>(s({title:"مدیریت کلینیک‌ها"}),()=>{s({title:void 0,backButton:!1})}),[s]);const y=(r,N)=>{l({id:r,name:N}),m(!0)},C=async()=>{if(h){g(!0);try{await c(h.id),R("کلینیک با موفقیت حذف شد"),j.invalidateQueries({queryKey:["clinics"]}),m(!1),l(null)}catch(r){const N=r?.response?.data?.message||"خطایی در حذف کلینیک رخ داد";L(N)}finally{g(!1)}}},b=()=>{p||(m(!1),l(null))},v=i?.data?.clinics||[],w=i?.meta;return e.jsxs("main",{children:[e.jsxs(P,{children:[e.jsx("h5",{className:"main-header ",children:"لیست کلینیک‌ها"}),e.jsx(J,{clinics:v,isLoadingClinics:d||o,page:t,onDeleteClick:y,onRefetch:x,isRefetching:a}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(E,{meta:w,onPageChange:r=>n(r)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(F,{})]}),e.jsx(O,{isOpen:u,onClose:b,onConfirm:C,title:"حذف کلینیک",message:`آیا از حذف کلینیک ${h?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:p})]})}export{oe as default};
