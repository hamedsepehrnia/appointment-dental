import{j as e,c as U}from"./query-vendor-DvaUDqTV.js";import{u as M,a as i}from"./react-vendor-dTsWsAAn.js";import{c as R,C as I,s as L,b as $}from"./index-DQ7xL4Vx.js";import{u as P}from"./useAdminDashboardHeader-CFWWO3br.js";import{u as F,a as O,U as H}from"./UserManagementForm-i4_EMOfO.js";import{A as q}from"./AdminPagination-CimytDQx.js";import{T as B}from"./TableContainer-wezUMfoN.js";import{T as Q,D as Y}from"./DeleteModal-D56zs9AN.js";import{f as _}from"./helpers-DOyc9qlM.js";import{a as G}from"./index.module-BblzqiS0.js";import{S as J}from"./SectionContainer-BxhawREw.js";import"./redux-vendor-5gwm_VuO.js";import"./ui-vendor-B68-Q-v-.js";import"./form-vendor--jwUxY8R.js";import"./motion-vendor-CQyDv_CV.js";import"./CustomTextArea-B6JEKYSx.js";const K={ADMIN:"مدیر",SECRETARY:"منشی",PATIENT:"بیمار"},z={MALE:"مرد",FEMALE:"زن",OTHER:"سایر"};function V(j){const t=R.c(15),{users:c,isLoadingUsers:a,page:u,onDeleteClick:o,onRefetch:x,isRefetching:f}=j,g=f===void 0?!1:f,m=M();let r;t[0]!==g||t[1]!==x?(r=x&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:x,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=g,t[1]=x,t[2]=r):r=t[2];let d;t[3]===Symbol.for("react.memo_cache_sentinel")?(d=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"کاربر"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"نقش"}),e.jsx("th",{children:"کد ملی"}),e.jsx("th",{children:"جنسیت"}),e.jsx("th",{children:"کلینیک"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=d):d=t[3];let n;t[4]!==a||t[5]!==m||t[6]!==o||t[7]!==u||t[8]!==c?(n=a?e.jsx(Q,{rows:5,columns:9}):c.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center p-8 font-estedad-light",children:"کاربری یافت نشد"})}):c.map((s,b)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(u-1)*5+b+1}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-3",children:[s.profileImage?e.jsx("img",{src:`${s.profileImage}`,alt:`${s.firstName} ${s.lastName}`,className:"w-12 h-12 rounded-full object-cover shrink-0"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-user text-gray-400"})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-estedad-light line-clamp-2",children:[s.firstName," ",s.lastName]}),s.address&&e.jsxs("span",{className:"text-xs font-estedad-light text-paragray line-clamp-1",children:[s.address.substring(0,30),"..."]})]})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.phoneNumber}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${s.role==="ADMIN"?"bg-red-100 text-red-600":s.role==="SECRETARY"?"bg-blue-100 text-blue-600":"bg-green-100 text-green-600"}`,children:K[s.role]||s.role})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.nationalCode||"-"}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.gender?z[s.gender]||s.gender:"-"}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.clinic?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary",children:s.clinic.name}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:s.createdAt?_(new Date(s.createdAt)):"-"}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{m(`/admin/users-management/edit/${s.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>o(s.id,s.firstName,s.lastName),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},s.id)),t[4]=a,t[5]=m,t[6]=o,t[7]=u,t[8]=c,t[9]=n):n=t[9];let l;t[10]!==n?(l=e.jsx(B,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[d,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:n})]})}),t[10]=n,t[11]=l):l=t[11];let p;return t[12]!==r||t[13]!==l?(p=e.jsxs(e.Fragment,{children:[r,l]}),t[12]=r,t[13]=l,t[14]=p):p=t[14],p}function xe(){const{setHeaderConfig:j}=P(),[t,c]=i.useState(1),[a,u]=i.useState(""),[o]=G(a,500),[x,f]=i.useState(!1),[g,m]=i.useState(!1),[r,d]=i.useState(null),[n,l]=i.useState(!1),p=U(),{mutateAsync:s}=F(),{data:b,isLoading:N,isPending:v,refetch:C,isFetching:w}=O(t,5,o);i.useEffect(()=>(j({title:"مدیریت کاربران"}),()=>{j({title:void 0,backButton:!1})}),[j]),i.useEffect(()=>{a.trim()?f(!0):f(!1)},[a]),i.useEffect(()=>{N||o===a&&f(!1)},[N,o,a]);const D=(h,y,A)=>{d({id:h,name:`${y} ${A}`}),m(!0)},S=async()=>{if(r){l(!0);try{await s(r.id),L("کاربر با موفقیت حذف شد"),p.invalidateQueries({queryKey:["users"]}),m(!1),d(null)}catch(h){const y=h?.response?.data?.message||"خطایی در حذف کاربر رخ داد";$(y)}finally{l(!1)}}},k=()=>{n||(m(!1),d(null))},T=b?.data?.users||[],E=b?.meta;return e.jsxs("main",{children:[e.jsxs(J,{children:[e.jsx("h5",{className:"main-header ",children:"لیست کاربران"}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(I,{labelText:"جستجو",placeholder:"جستجو بر اساس نام، نام خانوادگی، شماره تماس یا کد ملی...",className:"bg-white pr-12",value:a,onChange:h=>{u(h.target.value),c(1)}}),x&&a&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]})}),e.jsx(V,{users:T,isLoadingUsers:N||v,page:t,onDeleteClick:D,onRefetch:C,isRefetching:w}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(q,{meta:E,onPageChange:h=>c(h)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(H,{})]}),e.jsx(Y,{isOpen:g,onClose:k,onConfirm:S,title:"حذف کاربر",message:`آیا از حذف کاربر ${r?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:n})]})}export{xe as default};
