import{j as e,b as D}from"./query-vendor-KlcNboas.js";import{e as I,a as f}from"./react-vendor-vqeg7uDR.js";import{c as T,N as k,g as S,l as M,T as A,G as _,X as P,j as R,S as E,Q as O,R as L,h as $,i as F}from"./index-z67mRg2p.js";import{C as J}from"./ClinicManagementForm-DxJXlVQt.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function W(s){const t=T.c(15),{clinics:i,isLoadingClinics:u,page:m,onDeleteClick:h,onRefetch:l,isRefetching:p}=s,g=p===void 0?!1:p,j=I();let c;t[0]!==g||t[1]!==l?(c=l&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:l,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=g,t[1]=l,t[2]=c):c=t[2];let n;t[3]===Symbol.for("react.memo_cache_sentinel")?(n=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"تصویر"}),e.jsx("th",{children:"نام کلینیک"}),e.jsx("th",{children:"آدرس"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"تعداد پزشکان"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=n):n=t[3];let d;t[4]!==i||t[5]!==u||t[6]!==j||t[7]!==h||t[8]!==m?(d=u?e.jsx(k,{rows:5,columns:8}):i.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"text-center p-8 font-estedad-light",children:"کلینیکی یافت نشد"})}):i.map((a,y)=>e.jsxs("tr",{className:"hover:bg-purple-400/10 text-dark *:p-4.5",children:[e.jsx("td",{className:"font-estedad-light text-center",children:(m-1)*5+y+1}),e.jsxs("td",{children:[(fetch("http://127.0.0.1:7242/ingest/c5282bb0-1a44-499c-bce8-9a51f667292e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"ClinicManagementTable.tsx:77",message:"Rendering clinic image",data:{clinicId:a.id,clinicName:a.name,clinicImage:a.image,clinicImageNull:a.image===null,clinicImageUndefined:a.image===void 0,clinicImageTruthy:!!a.image},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(X),null),a.image?e.jsx("img",{src:S(a.image),alt:a.name,className:"w-16 h-16 rounded-lg object-cover"},`${a.id}-${a.image||"no-image"}`):e.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-200 flex items-center justify-center",children:e.jsx("i",{className:"fas fa-image text-gray-400"})})]}),e.jsx("td",{className:"min-w-[200px]",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-estedad-light line-clamp-2",children:a.name}),a.description&&e.jsxs("span",{className:"text-xs font-estedad-light text-paragray line-clamp-2",children:[a.description.substring(0,30),"..."]})]})}),e.jsx("td",{className:"text-dark font-estedad-light min-w-[260px] max-w-[260px]",children:e.jsx("span",{className:"line-clamp-2",children:a.address})}),e.jsx("td",{className:"text-dark font-estedad-light",children:(()=>{const b=q(a.phoneNumber);return b.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:b.map(Q)}):"-"})()}),e.jsx("td",{className:"text-dark font-estedad-light text-center",children:a._count?.doctors||0}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:a.createdAt?M(new Date(a.createdAt)):"-"}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{j(`/admin/clinics-management/edit/${a.id}`)},className:"p-1.5 rounded-full text-secondary bg-secondary/20 hover:bg-secondary hover:text-white transition",title:"ویرایش",children:e.jsx("i",{className:"far fa-edit"})}),e.jsx("button",{onClick:()=>h(a.id,a.name),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},a.id)),t[4]=i,t[5]=u,t[6]=j,t[7]=h,t[8]=m,t[9]=d):d=t[9];let o;t[10]!==d?(o=e.jsx(A,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[n,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:d})]})}),t[10]=d,t[11]=o):o=t[11];let x;return t[12]!==c||t[13]!==o?(x=e.jsxs(e.Fragment,{children:[c,o]}),t[12]=c,t[13]=o,t[14]=x):x=t[14],x}function Q(s,t){return e.jsx("span",{dir:"ltr",className:"text-nowrap",children:s},t)}function q(s){if(!s)return[];if(Array.isArray(s))return s.filter(K);if(typeof s=="string"){const t=s.trim();if(t.startsWith("[")&&t.endsWith("]"))try{const i=JSON.parse(t);if(Array.isArray(i))return i.filter(U).map(H)}catch{}return t.split(/[,|;|\n]/).map(G).filter(B)}return[]}function B(s){return s}function G(s){return s.trim()}function H(s){return String(s).trim()}function U(s){return s&&String(s).trim()}function K(s){return s&&s.trim()}function X(){}function ne(){const{setHeaderConfig:s}=_(),[t,i]=f.useState(1),[u,m]=f.useState(!1),[h,l]=f.useState(null),[p,g]=f.useState(!1),j=D(),{mutateAsync:c}=P(),{data:n,isLoading:d,isPending:o,refetch:x,isFetching:a}=R(t,5);f.useEffect(()=>{fetch("http://127.0.0.1:7242/ingest/c5282bb0-1a44-499c-bce8-9a51f667292e",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({location:"ClinicsManagement.tsx:33",message:"ClinicsManagement mounted, checking clinics data",data:{clinicsCount:n?.data?.clinics?.length||0,clinicsWithImages:n?.data?.clinics?.filter(r=>r.image).length||0,clinicsWithoutImages:n?.data?.clinics?.filter(r=>!r.image).length||0,firstClinicImage:n?.data?.clinics?.[0]?.image||null},timestamp:Date.now(),sessionId:"debug-session",runId:"run1",hypothesisId:"E"})}).catch(()=>{})},[n]),f.useEffect(()=>(s({title:"مدیریت کلینیک‌ها"}),()=>{s({title:void 0,backButton:!1})}),[s]);const y=(r,N)=>{l({id:r,name:N}),m(!0)},C=async()=>{if(h){g(!0);try{await c(h.id),$("کلینیک با موفقیت حذف شد"),j.invalidateQueries({queryKey:["clinics"]}),m(!1),l(null)}catch(r){const N=r?.response?.data?.message||"خطایی در حذف کلینیک رخ داد";F(N)}finally{g(!1)}}},b=()=>{p||(m(!1),l(null))},v=n?.data?.clinics||[],w=n?.meta;return e.jsxs("main",{children:[e.jsxs(E,{children:[e.jsx("h5",{className:"main-header ",children:"لیست کلینیک‌ها"}),e.jsx(W,{clinics:v,isLoadingClinics:d||o,page:t,onDeleteClick:y,onRefetch:x,isRefetching:a}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(O,{meta:w,onPageChange:r=>i(r)})}),e.jsx("hr",{className:"my-6 border-2 rounded-4xl border-gray-500"}),e.jsx(J,{})]}),e.jsx(L,{isOpen:u,onClose:b,onConfirm:C,title:"حذف کلینیک",message:`آیا از حذف کلینیک ${h?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:p})]})}export{ne as default};
