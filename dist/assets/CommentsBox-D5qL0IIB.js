import{a as B}from"./react-vendor-dTsWsAAn.js";import{j as s,c as R}from"./query-vendor-DvaUDqTV.js";import{c as A,b as D,a as q,F as I}from"./form-vendor--jwUxY8R.js";import{u as z,a as Q}from"./useComments-DtMhs3BZ.js";import{s as k,b as K,c as G}from"./index-D1LHzErR.js";import{L as J}from"./LoadingState-DDvPPyAO.js";import{f as _}from"./helpers-DOyc9qlM.js";var W=t=>{let e=t;for(;e=e.parentElement;){const i=getComputedStyle(e,null).getPropertyValue("overflow-y");if(e===document.body)return window;if(i==="auto"||i==="scroll"||i==="overlay")return e}return window},M=t=>t.firstChild?t.firstChild.offsetParent===t:!0,U=(t,e)=>{let i=t,n=0;M(e)||(n+=t.offsetTop-e.offsetTop,e=t.offsetParent,n+=-t.offsetTop);do n+=i.offsetTop,i=i.offsetParent;while(i&&i!==e);return n},X=t=>{let e=t.parentElement;for(;e&&getComputedStyle(e,null).getPropertyValue("display")==="contents";)e=e.parentElement;return e||window},H=null;typeof CSS<"u"&&CSS.supports&&(CSS.supports("position","sticky")?H="sticky":CSS.supports("position","-webkit-sticky")&&(H="-webkit-sticky"));var L=!1;try{const t=Object.defineProperty({},"passive",{get(){L={passive:!0}}}),e=()=>{};window.addEventListener("testPassive",e,t),window.removeEventListener("testPassive",e,t)}catch{}var V=t=>{const{el:e,onChange:i,unsubs:n,measure:c}=t;if(e===window){const o=()=>({top:0,left:0,height:window.innerHeight,width:window.innerWidth}),l=c(o()),a=()=>{Object.assign(l,c(o())),i()};return window.addEventListener("resize",a,L),n.push(()=>window.removeEventListener("resize",a)),l}else{const o=c(e.getBoundingClientRect()),l=()=>{Object.assign(o,c(e.getBoundingClientRect())),i()},a=new ResizeObserver(l);return a.observe(e),n.push(()=>a.disconnect()),o}},Z=t=>{const e=getComputedStyle(t,null),i=parseInt(e.getPropertyValue("padding-top"),10),n=parseInt(e.getPropertyValue("padding-bottom"),10);return{top:i,bottom:n}},Y=(t,e,i)=>{const{bottom:n,offsetBottom:c,offsetTop:o}=i,l=W(t);let a=!1;const p=()=>{a||requestAnimationFrame(()=>{const r=v();if(r!==u)T(r);else if(r===1&&!n){const{height:x}=m,{height:f}=b;t.style.top=`${x-f-c}px`}else if(r===2){const{height:x,offsetTop:f}=m,{height:j,naturalTop:g}=P,{height:$}=b,N=Math.max(0,f+d+x-(g+$+c));if(n){const E=Math.max(0,j-$-N);t.style.bottom=`${E}px`}else t.style.top=`${N}px`}a=!1}),a=!0};let d=l===window?window.scrollY:l.scrollTop;const h=r=>{const{offsetTop:x,height:f}=m,{naturalTop:j}=P,{height:g}=b;return r+x+f>=j+g+S+c},v=()=>{const{height:r}=m,{height:x}=b;return x+o+c<=r?3:h(d)?1:2},C=l!==window&&M(l),m=V({el:l,onChange:p,unsubs:e,measure:({height:r,top:x})=>({height:r,offsetTop:C?x:0})}),y=X(t),w=y===window?{top:0,bottom:0}:Z(y),P=V({el:y,onChange:p,unsubs:e,measure:({height:r})=>({height:r-w.top-w.bottom,naturalTop:y===window?0:U(y,l)+w.top+m.offsetTop})}),b=V({el:t,onChange:p,unsubs:e,measure:({height:r})=>({height:r})});let S=0,u=v();const T=r=>{const x=u;if(u=r,x===2&&(S=-1),r===3){t.style.position=H,n?t.style.bottom=`${c}px`:t.style.top=`${o}px`;return}const{height:f,offsetTop:j}=m,{height:g,naturalTop:$}=P,{height:N}=b;if(r===2)if(t.style.position="relative",S=x===0?Math.max(0,j+d-$+o):Math.max(0,j+d+f-($+N+c)),n){const E=Math.max(0,g-N-S);t.style.bottom=`${E}px`}else t.style.top=`${S}px`;else t.style.position=H,r===1?n?t.style.bottom=`${c}px`:t.style.top=`${f-N-c}px`:n?t.style.bottom=`${f-N-c}px`:t.style.top=`${o}px`};T(u);const F=r=>{if(r===d)return;const x=r-d;if(d=r,u===3)return;const{offsetTop:f,height:j}=m,{naturalTop:g,height:$}=P,{height:N}=b;if(x>0)if(u===0){if(r+f+o>g){const E=Math.max(0,f+d-g+o);r+f+j<=g+N+E+c?T(2):T(1)}}else u===2&&h(r)&&T(1);else if(u===1){if(f+r+j<g+$+c){const E=Math.max(0,f+d+j-(g+N+c));f+r+o>=g+E?T(2):T(0)}}else u===2&&f+r+o<g+S&&T(0)},O=l===window?()=>F(window.scrollY):()=>F(l.scrollTop);l.addEventListener("scroll",O,L),l.addEventListener("mousewheel",O,L),e.push(()=>l.removeEventListener("scroll",O),()=>l.removeEventListener("mousewheel",O))},ee=({offsetTop:t=0,offsetBottom:e=0,bottom:i=!1}={})=>{const[n,c]=B.useState(null);return B.useEffect(()=>{if(!n||!H)return;const o=[];return Y(n,o,{offsetBottom:e,offsetTop:t,bottom:i}),()=>{o.forEach(l=>l())}},[n,e,t,i]),c},te=t=>{const{offsetTop:e,offsetBottom:i,bottom:n,children:c,className:o,style:l}=t,a=ee({offsetTop:e,offsetBottom:i,bottom:n});return s.jsx("div",{className:o,style:l,ref:a,children:c})},he=te;const se=A({content:q().required("متن نظر الزامی است").min(10,"نظر باید حداقل ۱۰ کاراکتر باشد").max(1e3,"نظر نباید بیشتر از ۱۰۰۰ کاراکتر باشد"),rating:D().integer("امتیاز باید عدد صحیح باشد").min(1,"امتیاز باید بین ۱ تا ۵ باشد").max(5,"امتیاز باید بین ۱ تا ۵ باشد").required("امتیاز الزامی است")});function ge({doctorId:t,articleId:e,serviceId:i}){const n=R(),{mutateAsync:c,isPending:o}=z(),l=async(a,p)=>{try{const d=t||e||i||"",h=t?"doctor":e?"article":"service";await c({comment:{content:a.content,rating:a.rating},type:h,id:d}),k("نظر شما با موفقیت ثبت شد و در انتظار تایید مدیر است"),n.invalidateQueries({queryKey:["comments-infinite",d,h]}),n.invalidateQueries({queryKey:["comments",d,h]}),p()}catch(d){console.error("Error submitting comment:",d),K("خطایی در ثبت نظر رخ داد")}};return s.jsxs("div",{className:"p-4 md:p-7.5 section-border rounded-[10px]",children:[s.jsx("h2",{className:"text-2xl font-estedad-semibold text-dark mb-6",children:"ارسال دیدگاه"}),s.jsx(I,{initialValues:{content:"",rating:5},validationSchema:se,onSubmit:(a,{resetForm:p})=>l(a,p),children:a=>s.jsxs("form",{onSubmit:a.handleSubmit,className:"space-y-6",children:[s.jsxs("div",{className:"flex gap-1 mb-6",children:[s.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=1?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",1)}),s.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=2?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",2)}),s.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=3?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",3)}),s.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=4?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",4)}),s.jsx("i",{className:`fas fa-star text-xl cursor-pointer ${a.values.rating>=5?"text-secondary":"text-gray-300"}`,onClick:()=>a.setFieldValue("rating",5)})]}),a.touched.rating&&a.errors.rating&&s.jsx("div",{className:"text-red-500 text-sm",children:a.errors.rating}),s.jsxs("div",{children:[s.jsx("textarea",{rows:4,placeholder:"ارسال دیدگاه...",className:`w-full px-6 py-4 border rounded-2xl focus:outline-none ${a.touched.content&&a.errors.content?"border-red-500":"border-gray-200 focus:border-accent"}`,...a.getFieldProps("content")}),a.touched.content&&a.errors.content&&s.jsx("div",{className:"text-red-500 text-sm mt-1",children:a.errors.content})]}),s.jsx("button",{type:"submit",className:"bg-accent text-white px-8 py-4 rounded-full hover:bg-secondary transition font-semibold disabled:opacity-50 disabled:cursor-not-allowed",disabled:o||!a.isValid,children:o?"در حال ارسال...":"ارسال سریع"})]})})]})}function ye(t){const e=G.c(20),{doctorId:i,articleId:n,serviceId:c}=t,{data:o,isLoading:l,fetchNextPage:a,hasNextPage:p,isFetchingNextPage:d}=Q(i||n||c||"",i?"doctor":n?"article":"service",5);let h,v,C,m,y;if(e[0]!==o?.pages||e[1]!==p||e[2]!==l){y=Symbol.for("react.early_return_sentinel");e:{const b=o?.pages.flatMap(le).filter(oe)||[],S=p?o?.pages[0]?.meta?.total??b.length:b.length;if(l){let u;e[8]===Symbol.for("react.memo_cache_sentinel")?(u=s.jsx(J,{}),e[8]=u):u=e[8],y=u;break e}h="section-border p-4 md:p-7.5",e[9]===Symbol.for("react.memo_cache_sentinel")?(v=s.jsx("div",{}),e[9]=v):v=e[9],C=s.jsxs("h2",{className:"text-2xl font-estedad-semibold ",children:["مجموع دیدگاه (",S,")"]}),m=b.length===0?s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-paragray font-estedad-light text-lg",children:"هنوز دیدگاهی ثبت نشده است."})}):s.jsx("div",{className:"space-y-6",children:b.map(ae)})}e[0]=o?.pages,e[1]=p,e[2]=l,e[3]=h,e[4]=v,e[5]=C,e[6]=m,e[7]=y}else h=e[3],v=e[4],C=e[5],m=e[6],y=e[7];if(y!==Symbol.for("react.early_return_sentinel"))return y;let w;e[10]!==a||e[11]!==p||e[12]!==d?(w=p&&s.jsx("div",{className:"mt-8 flex justify-center",children:s.jsx("button",{onClick:()=>a(),disabled:d,className:"main-btn ",children:d?s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("i",{className:"fas fa-spinner fa-spin"}),s.jsx("span",{children:"در حال بارگذاری..."})]}):s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsx("span",{children:"مشاهده نظرات بیشتر"}),s.jsx("i",{className:"fas fa-chevron-down"})]})})}),e[10]=a,e[11]=p,e[12]=d,e[13]=w):w=e[13];let P;return e[14]!==h||e[15]!==v||e[16]!==C||e[17]!==m||e[18]!==w?(P=s.jsxs("div",{className:h,children:[v,C,m,w]}),e[14]=h,e[15]=v,e[16]=C,e[17]=m,e[18]=w,e[19]=P):P=e[19],P}function ae(t){return s.jsx("div",{className:"border-t-[1.5px] border-[rgba(94,91,91,0.09)] pt-6 mt-6 ",children:s.jsxs("div",{className:"grid  sm:grid-cols-[auto_1fr]  gap-4 ",children:[s.jsx("img",{src:"../../../../public/images/comment-1.png",alt:"reviewer",className:"size-20 rounded-full shrink-0 justify-self-center"}),s.jsxs("div",{className:"flex-1  space-y-2.5",children:[s.jsxs("div",{className:"flex items-start justify-between  flex-wrap  gap-4",children:[s.jsxs("div",{className:"space-y-2.5",children:[s.jsxs("h4",{className:"font-estedad-semibold text-xl",children:[t.user.firstName," ",t.user.lastName]}),s.jsxs("div",{className:"flex gap-1 text-secondary",children:[Array.from({length:t.rating||0}).map(ie),Array.from({length:5-(t.rating||0)}).map(ne)]})]}),s.jsxs("span",{className:"text-sm text-paragray flex items-center gap-x-1.5 font-estedad-light",children:[s.jsx("i",{className:"far fa-clock "}),_(new Date(t.createdAt))]})]}),s.jsx("p",{className:"text-paragray font-estedad-light",children:t.content}),t.replies&&t.replies.length>0&&t.published===!0&&s.jsx("div",{className:"mt-4 pr-4 space-y-4 border-r-2 border-primary/20",children:t.replies.map(re)})]})]})},t.id)}function re(t){return s.jsxs("div",{className:"bg-primary/10 rounded-lg p-4 border-r-4 border-primary/30",children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-primary/10 flex items-center justify-center",children:s.jsx("i",{className:"far fa-user text-primary text-xs"})}),s.jsxs("span",{className:"text-sm font-estedad-medium text-dark",children:[t.user.firstName," ",t.user.lastName]})]}),s.jsx("span",{className:"text-xs text-paragray font-estedad-light",children:_(new Date(t.createdAt))})]}),s.jsx("p",{className:"text-paragray font-estedad-light text-sm leading-6 whitespace-pre-wrap",children:t.content})]},t.id)}function ne(t,e){return s.jsx("i",{className:"fas fa-star text-gray-300"},e)}function ie(t,e){return s.jsx("i",{className:"fas fa-star"},e)}function oe(t){return t.published===!0}function le(t){return t?.data?.comments||[]}export{ye as C,ge as a,he as s};
