import{j as e,b as te}from"./query-vendor-KlcNboas.js";import{a as c}from"./react-vendor-vqeg7uDR.js";import{T as X,N as Z,l as E,h as D,i as A,c as re,o as le,A as ie,m as U,G as de,O as ne,S as oe,C as ce,Q as xe,R as me}from"./index-DIHBjxzH.js";import{b as _,c as ee,d as he,e as ue,f as se,g as pe,h as W}from"./useComments-FCOeGbef.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function ge({comments:a,isLoadingComments:d,page:h,onDeleteClick:x,onCommentClick:m,onRefetch:o,isRefetching:g=!1}){const{mutateAsync:j}=_(),{mutateAsync:I}=ee(),[b,C]=c.useState(new Set),[u,y]=c.useState(new Set),N=async t=>{C(s=>new Set(s).add(t));try{await j(t),D("وضعیت انتشار با موفقیت تغییر کرد"),o?.()}catch(s){const i=s?.response?.data?.message||"خطایی در تغییر وضعیت انتشار رخ داد";A(i)}finally{C(s=>{const i=new Set(s);return i.delete(t),i})}},f=async t=>{y(s=>new Set(s).add(t));try{await I(t),D("وضعیت خوانده شده با موفقیت تغییر کرد"),o?.()}catch(s){const i=s?.response?.data?.message||"خطایی در تغییر وضعیت خوانده شده رخ داد";A(i)}finally{y(s=>{const i=new Set(s);return i.delete(t),i})}},S=t=>t?e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((s,i)=>e.jsx("i",{className:`fas ${i<t?"fa-star text-yellow-400":"fa-star text-gray-300"}`},i))}):e.jsx("span",{className:"text-paragray",children:"-"});return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:o,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),e.jsx(X,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap ",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"کاربر"}),e.jsx("th",{children:"پزشک"}),e.jsx("th",{children:"متن نظر"}),e.jsx("th",{children:"امتیاز"}),e.jsx("th",{children:"وضعیت انتشار"}),e.jsx("th",{children:"وضعیت خوانده شده"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),e.jsx("tbody",{className:"divide-y divide-main-border-color",children:d?e.jsx(Z,{rows:5,columns:9}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center p-8 font-estedad-light",children:"نظری یافت نشد"})}):a.map((t,s)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${t.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(h-1)*5+s+1}),e.jsx("td",{className:"",children:e.jsx("div",{className:"flex items-center gap-3 min-w-[200px]",children:e.jsx("div",{className:"  ",children:e.jsxs("p",{className:"font-estedad-light   line-clamp-2",children:[t.user.firstName," ",t.user.lastName]})})})}),e.jsx("td",{className:"text-dark font-estedad-light",children:t.doctor?e.jsxs("span",{className:"line-clamp-2 min-w-[200px] ",children:["دکتر ",t.doctor.firstName," ",t.doctor.lastName]}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("span",{className:`line-clamp-2 max-w-[300px] min-w-[220px] ${m?"cursor-pointer hover:text-primary transition-colors":""}`,onClick:()=>m?.(t),title:m?"کلیک برای مشاهده جزئیات":"",children:t.content})}),e.jsx("td",{className:"text-dark font-estedad-light",children:S(t.rating)}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 text-nowrap",children:"پنهان"}),e.jsx("button",{onClick:()=>N(t.id),disabled:b.has(t.id),className:"p-1.5 rounded-full text-primary bg-primary/20 hover:bg-primary hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:t.published?"پنهان کردن":"انتشار",children:b.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:`fas ${t.published?"fa-eye":"fa-eye-slash"}`})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("div",{className:"flex items-center gap-2 justify-center",children:t.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap ",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap ",children:"خوانده نشده"})})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:E(new Date(t.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.read?e.jsx("button",{onClick:()=>f(t.id),disabled:u.has(t.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:"علامت‌گذاری به عنوان خوانده نشده",children:u.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}):e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>f(t.id),disabled:u.has(t.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:"علامت‌گذاری به عنوان خوانده شده",children:u.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-green-500 border-t-transparent"}):e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>x(t.id,t.content.substring(0,30)+"..."),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},t.id))})]})})]})}function be({comments:a,isLoadingComments:d,page:h,onDeleteClick:x,onCommentClick:m,onRefetch:o,isRefetching:g=!1}){const{mutateAsync:j}=_(),{mutateAsync:I}=ee(),[b,C]=c.useState(new Set),[u,y]=c.useState(new Set),N=async t=>{C(s=>new Set(s).add(t));try{await j(t),D("وضعیت انتشار با موفقیت تغییر کرد"),o?.()}catch(s){const i=s?.response?.data?.message||"خطایی در تغییر وضعیت انتشار رخ داد";A(i)}finally{C(s=>{const i=new Set(s);return i.delete(t),i})}},f=async t=>{y(s=>new Set(s).add(t));try{await I(t),D("وضعیت خوانده شده با موفقیت تغییر کرد"),o?.()}catch(s){const i=s?.response?.data?.message||"خطایی در تغییر وضعیت خوانده شده رخ داد";A(i)}finally{y(s=>{const i=new Set(s);return i.delete(t),i})}},S=t=>t?e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((s,i)=>e.jsx("i",{className:`fas ${i<t?"fa-star text-yellow-400":"fa-star text-gray-300"}`},i))}):e.jsx("span",{className:"text-paragray",children:"-"});return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:o,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),e.jsx(X,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"کاربر"}),e.jsx("th",{children:"مقاله"}),e.jsx("th",{children:"متن نظر"}),e.jsx("th",{children:"امتیاز"}),e.jsx("th",{children:"وضعیت انتشار"}),e.jsx("th",{children:"وضعیت خوانده شده"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),e.jsx("tbody",{className:"divide-y divide-main-border-color",children:d?e.jsx(Z,{rows:5,columns:11}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:11,className:"text-center p-8 font-estedad-light",children:"نظری یافت نشد"})}):a.map((t,s)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${t.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(h-1)*5+s+1}),e.jsx("td",{className:"",children:e.jsx("div",{className:"flex items-center gap-3 min-w-[200px]",children:e.jsx("div",{children:e.jsxs("p",{className:"font-estedad-light line-clamp-2 ",children:[t.user.firstName," ",t.user.lastName]})})})}),e.jsx("td",{className:"text-dark font-estedad-light ",children:t.article?e.jsx("span",{className:"line-clamp-2 min-w-[200px]",children:t.article.title}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("span",{className:`line-clamp-2 max-w-[300px] min-w-[220px] ${m?"cursor-pointer hover:text-primary transition-colors":""}`,onClick:()=>m?.(t),title:m?"کلیک برای مشاهده جزئیات":"",children:t.content})}),e.jsx("td",{className:"text-dark font-estedad-light",children:S(t.rating)}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 text-nowrap",children:"پنهان"}),e.jsx("button",{onClick:()=>N(t.id),disabled:b.has(t.id),className:"p-1.5 rounded-full text-primary bg-primary/20 hover:bg-primary hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed ",title:t.published?"پنهان کردن":"انتشار",children:b.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:`fas ${t.published?"fa-eye":"fa-eye-slash"}`})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:t.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap",children:"خوانده نشده"})})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:E(new Date(t.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.read?e.jsx("button",{onClick:()=>f(t.id),disabled:u.has(t.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:"علامت‌گذاری به عنوان خوانده نشده",children:u.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}):e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>f(t.id),disabled:u.has(t.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:"علامت‌گذاری به عنوان خوانده شده",children:u.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-green-500 border-t-transparent"}):e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>x(t.id,t.content.substring(0,30)+"..."),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},t.id))})]})})]})}function fe({comments:a,isLoadingComments:d,page:h,onDeleteClick:x,onCommentClick:m,onRefetch:o,isRefetching:g=!1}){const{mutateAsync:j}=_(),{mutateAsync:I}=ee(),[b,C]=c.useState(new Set),[u,y]=c.useState(new Set),N=async t=>{C(s=>new Set(s).add(t));try{await j(t),D("وضعیت انتشار با موفقیت تغییر کرد"),o?.()}catch(s){const i=s?.response?.data?.message||"خطایی در تغییر وضعیت انتشار رخ داد";A(i)}finally{C(s=>{const i=new Set(s);return i.delete(t),i})}},f=async t=>{y(s=>new Set(s).add(t));try{await I(t),D("وضعیت خوانده شده با موفقیت تغییر کرد"),o?.()}catch(s){const i=s?.response?.data?.message||"خطایی در تغییر وضعیت خوانده شده رخ داد";A(i)}finally{y(s=>{const i=new Set(s);return i.delete(t),i})}},S=t=>t?e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((s,i)=>e.jsx("i",{className:`fas ${i<t?"fa-star text-yellow-400":"fa-star text-gray-300"}`},i))}):e.jsx("span",{className:"text-paragray",children:"-"});return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:o,disabled:g,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[g?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),e.jsx(X,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"کاربر"}),e.jsx("th",{children:"خدمت"}),e.jsx("th",{children:"متن نظر"}),e.jsx("th",{children:"امتیاز"}),e.jsx("th",{children:"وضعیت انتشار"}),e.jsx("th",{children:"وضعیت خوانده شده"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),e.jsx("tbody",{className:"divide-y divide-main-border-color",children:d?e.jsx(Z,{rows:5,columns:9}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:9,className:"text-center p-8 font-estedad-light",children:"نظری یافت نشد"})}):a.map((t,s)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${t.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(h-1)*5+s+1}),e.jsx("td",{className:"",children:e.jsx("div",{className:"flex items-center gap-3 min-w-[200px]",children:e.jsx("div",{children:e.jsxs("p",{className:"font-estedad-light line-clamp-2",children:[t.user.firstName," ",t.user.lastName]})})})}),e.jsx("td",{className:"text-dark font-estedad-light",children:t.service?e.jsx("span",{className:"line-clamp-2 min-w-[200px]",children:t.service.title}):e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("span",{className:`line-clamp-2 max-w-[300px] min-w-[220px] ${m?"cursor-pointer hover:text-primary transition-colors":""}`,onClick:()=>m?.(t),title:m?"کلیک برای مشاهده جزئیات":"",children:t.content})}),e.jsx("td",{className:"text-dark font-estedad-light",children:S(t.rating)}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.published?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"منتشر شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700 text-nowrap",children:"پنهان"}),e.jsx("button",{onClick:()=>N(t.id),disabled:b.has(t.id),className:"p-1.5 rounded-full text-primary bg-primary/20 hover:bg-primary hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:t.published?"پنهان کردن":"انتشار",children:b.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:`fas ${t.published?"fa-eye":"fa-eye-slash"}`})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("div",{className:"flex items-center justify-center gap-2",children:t.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap",children:"خوانده نشده"})})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:E(new Date(t.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.read?e.jsx("button",{onClick:()=>f(t.id),disabled:u.has(t.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:"علامت‌گذاری به عنوان خوانده نشده",children:u.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-500 border-t-transparent"}):e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>f(t.id),disabled:u.has(t.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition disabled:opacity-50 disabled:cursor-not-allowed",title:"علامت‌گذاری به عنوان خوانده شده",children:u.has(t.id)?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-green-500 border-t-transparent"}):e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>x(t.id,t.content.substring(0,30)+"..."),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},t.id))})]})})]})}function je(){const a=re.c(5),{data:d,isLoading:h}=he();let x;if(a[0]!==h||a[1]!==d?.data?.article||a[2]!==d?.data?.doctor||a[3]!==d?.data?.service){const m=d?.data?.doctor||{total:0,published:0,unpublished:0,read:0,unread:0},o=d?.data?.article||{total:0,published:0,unpublished:0,read:0,unread:0},g=d?.data?.service||{total:0,published:0,unpublished:0,read:0,unread:0},j=[{title:"نظرات پزشکان",stats:m,icon:"fas fa-user-md",bgColor:"bg-blue-100",iconColor:"text-primary",isLoading:h},{title:"نظرات مقالات",stats:o,icon:"fas fa-newspaper",bgColor:"bg-green-100",iconColor:"text-green-500",isLoading:h},{title:"نظرات خدمات",stats:g,icon:"fas fa-handshake",bgColor:"bg-orange-100",iconColor:"text-orange-500",isLoading:h}];x=e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mb-8",children:j.map(ye)}),a[0]=h,a[1]=d?.data?.article,a[2]=d?.data?.doctor,a[3]=d?.data?.service,a[4]=x}else x=a[4];return x}function ye(a,d){return e.jsxs("div",{className:`bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition ${d===2?"md:col-span-2 lg:col-span-1":""}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h4",{className:"text-lg font-estedad-semibold text-dark md:text-sm lg:text-lg",children:a.title}),e.jsx("div",{className:`w-12 h-12 shrink-0 ${a.bgColor} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${a.icon} ${a.iconColor} text-xl`})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:"کل نظرات:"}),a.isLoading?e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded animate-pulse"}):e.jsx("span",{className:"text-lg font-estedad-semibold text-dark",children:a.stats.total.toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:"منتشر شده:"}),a.isLoading?e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded animate-pulse"}):e.jsx("span",{className:"text-lg font-estedad-semibold text-green-500",children:a.stats.published.toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:"منتشر نشده:"}),a.isLoading?e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded animate-pulse"}):e.jsx("span",{className:"text-lg font-estedad-semibold text-orange-500",children:a.stats.unpublished.toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:"خوانده شده:"}),a.isLoading?e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded animate-pulse"}):e.jsx("span",{className:"text-lg font-estedad-semibold text-green-600",children:a.stats.read.toLocaleString("fa-IR")})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:"خوانده نشده:"}),a.isLoading?e.jsx("div",{className:"h-6 w-16 bg-gray-200 rounded animate-pulse"}):e.jsx("span",{className:"text-lg font-estedad-semibold text-blue-600",children:a.stats.unread.toLocaleString("fa-IR")})]})]})]},d)}function Ne({isOpen:a,onClose:d,comment:h,commentType:x,onRefetch:m}){const[o,g]=c.useState(""),[j,I]=c.useState(!1),[b,C]=c.useState(!1),[u,y]=c.useState(null),[N,f]=c.useState(""),[S,t]=c.useState(!1),[s,i]=c.useState(null),[l,T]=c.useState(h),{mutateAsync:z}=ue(),{mutateAsync:Q}=se(),{mutateAsync:$}=pe(),v=te(),M=le(r=>r.user.data),B=r=>M?M.role==="ADMIN"||M.role==="SECRETARY"?!0:r.userId===M.id:!1;if(c.useEffect(()=>{T(h)},[h]),c.useEffect(()=>{const r=n=>{n.key==="Escape"&&a&&d()};return a&&(document.addEventListener("keydown",r),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",r),document.body.style.overflow="unset"}},[a,d]),c.useEffect(()=>{a||(g(""),I(!1),y(null),f(""))},[a]),!a||!l)return null;const K=async r=>{if(r.preventDefault(),!o.trim()||o.length<10){A("پاسخ باید حداقل ۱۰ کاراکتر باشد");return}C(!0);try{const n=await z({commentId:l.id,content:o});if(n?.data?.reply){const p={id:n.data.reply.id,content:n.data.reply.content,userId:n.data.reply.userId,parentId:n.data.reply.parentId,doctorId:n.data.reply.doctorId,articleId:n.data.reply.articleId,serviceId:n.data.reply.serviceId,user:n.data.reply.user,createdAt:n.data.reply.createdAt,updatedAt:n.data.reply.updatedAt,published:n.data.reply.published??!0,read:n.data.reply.read??!1,rating:n.data.reply.rating};T(k=>k&&{...k,replies:[...k.replies||[],p]})}D("پاسخ با موفقیت ثبت شد"),g(""),I(!1),v.invalidateQueries({queryKey:["comments"]}),l.doctorId&&v.invalidateQueries({queryKey:["comments",l.doctorId,"doctor"]}),l.articleId&&v.invalidateQueries({queryKey:["comments",l.articleId,"article"]}),l.serviceId&&v.invalidateQueries({queryKey:["comments",l.serviceId,"service"]}),m?.()}catch(n){const p=n?.response?.data?.message||"خطایی در ثبت پاسخ رخ داد";A(p)}finally{C(!1)}},q=r=>{y(r),f(r.content)},G=()=>{y(null),f("")},V=async(r,n)=>{if(r.preventDefault(),!N.trim()||N.length<10){A("پاسخ باید حداقل ۱۰ کاراکتر باشد");return}t(!0);try{const p=await $({id:n,content:N});p?.data?.comment&&T(k=>k&&{...k,replies:(k.replies||[]).map(L=>L.id===n?{...L,content:p.data.comment.content,updatedAt:p.data.comment.updatedAt}:L)}),D("پاسخ با موفقیت ویرایش شد"),y(null),f(""),v.invalidateQueries({queryKey:["comments"]}),l?.doctorId&&v.invalidateQueries({queryKey:["comments",l.doctorId,"doctor"]}),l?.articleId&&v.invalidateQueries({queryKey:["comments",l.articleId,"article"]}),l?.serviceId&&v.invalidateQueries({queryKey:["comments",l.serviceId,"service"]}),m?.()}catch(p){const k=p?.response?.data?.message||"خطایی در ویرایش پاسخ رخ داد";A(k)}finally{t(!1)}},H=async r=>{if(window.confirm("آیا از حذف این پاسخ اطمینان دارید؟")){i(r);try{await Q(r),T(n=>n&&{...n,replies:(n.replies||[]).filter(p=>p.id!==r)}),D("پاسخ با موفقیت حذف شد"),v.invalidateQueries({queryKey:["comments"]}),l?.doctorId&&v.invalidateQueries({queryKey:["comments",l.doctorId,"doctor"]}),l?.articleId&&v.invalidateQueries({queryKey:["comments",l.articleId,"article"]}),l?.serviceId&&v.invalidateQueries({queryKey:["comments",l.serviceId,"service"]}),m?.()}catch(n){const p=n?.response?.data?.message||"خطایی در حذف پاسخ رخ داد";A(p)}finally{i(null)}}},P=r=>{r.target===r.currentTarget&&d()},F=r=>r?e.jsx("div",{className:"flex items-center gap-1",children:[...Array(5)].map((n,p)=>e.jsx("i",{className:`fas ${p<r?"fa-star text-yellow-400":"fa-star text-gray-300"}`},p))}):e.jsx("span",{className:"text-paragray",children:"-"}),O=()=>{switch(x){case"doctor":return"نظر پزشک";case"article":return"نظر مقاله";case"service":return"نظر خدمت";default:return"نظر"}},J=()=>{switch(x){case"doctor":return"fa-user-md";case"article":return"fa-newspaper";case"service":return"fa-handshake";default:return"fa-comment"}};return e.jsx(ie,{mode:"wait",children:a&&h&&e.jsxs(U.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:P,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(U.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(U.div,{className:"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30,duration:.3},children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:`fas ${J()} text-white text-xl`})}),e.jsxs("h3",{className:"text-xl font-estedad-semibold text-white",children:["مشاهده ",O()]})]}),e.jsx(U.button,{onClick:d,className:"w-9 h-9 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 hover:bg-white/30 hover:border-white/40 flex items-center justify-center transition-all duration-200 group","aria-label":"بستن",children:e.jsx("i",{className:"fa fa-times text-sm text-white/90 group-hover:text-white transition-colors"})})]})}),e.jsx("div",{className:"px-6 py-6 overflow-y-auto flex-1 admin-modal-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"کاربر"}),e.jsxs("p",{className:"text-dark font-estedad-light text-base",children:[l.user.firstName," ",l.user.lastName]})]}),x==="doctor"&&l.doctor&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"پزشک"}),e.jsxs("p",{className:"text-dark font-estedad-light text-base",children:["دکتر ",l.doctor.firstName," ",l.doctor.lastName]})]}),x==="article"&&l.article&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"مقاله"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:l.article.title})]}),x==="service"&&l.service&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"خدمت"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:l.service.title})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"متن نظر"}),e.jsx("p",{className:"text-dark font-estedad-light text-base leading-7 whitespace-pre-wrap",children:l.content})]}),l.rating&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"امتیاز"}),e.jsx("div",{children:F(l.rating)})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ ایجاد"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:E(new Date(l.createdAt))})]}),l.updatedAt&&l.updatedAt!==l.createdAt&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ به‌روزرسانی"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:E(new Date(l.updatedAt))})]}),l.replies&&l.replies.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-3",children:["پاسخ‌ها (",l.replies.length,")"]}),e.jsx("div",{className:"space-y-4",children:l.replies.map(r=>e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 border-r-4 border-purple-400",children:u?.id===r.id?e.jsxs("form",{onSubmit:n=>V(n,r.id),className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-700 block mb-2",children:"ویرایش پاسخ"}),e.jsx("textarea",{value:N,onChange:n=>f(n.target.value),placeholder:"پاسخ خود را بنویسید (حداقل ۱۰ کاراکتر)",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none font-estedad-light",rows:4,disabled:S}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-estedad-light",children:[N.length,"/1000 کاراکتر"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"submit",disabled:S||N.trim().length<10,className:"flex-1 px-4 py-2 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"در حال ذخیره..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"far fa-save"}),"ذخیره"]})}),e.jsx("button",{type:"button",onClick:G,disabled:S,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-estedad-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"انصراف"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx("i",{className:"far fa-user text-purple-600 text-xs"})}),e.jsxs("span",{className:"text-sm font-estedad-medium text-dark",children:[r.user.firstName," ",r.user.lastName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-500 font-estedad-light",children:E(new Date(r.createdAt))}),B(r)&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>q(r),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition",title:"ویرایش",disabled:s===r.id,children:e.jsx("i",{className:"far fa-edit text-xs"})}),e.jsx("button",{onClick:()=>H(r.id),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",disabled:s===r.id,children:s===r.id?e.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-2 border-red-500 border-t-transparent"}):e.jsx("i",{className:"far fa-trash-alt text-xs"})})]})]})]}),e.jsx("p",{className:"text-dark font-estedad-light text-sm leading-6 whitespace-pre-wrap",children:r.content}),r.updatedAt&&r.updatedAt!==r.createdAt&&e.jsxs("p",{className:"text-xs text-gray-400 mt-2 font-estedad-light",children:["ویرایش شده در"," ",E(new Date(r.updatedAt))]})]})},r.id))})]}),e.jsx("div",{className:"mt-6",children:j?e.jsxs("form",{onSubmit:K,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-700 block mb-2",children:"متن پاسخ"}),e.jsx("textarea",{value:o,onChange:r=>g(r.target.value),placeholder:"پاسخ خود را بنویسید (حداقل ۱۰ کاراکتر)",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none font-estedad-light",rows:4,disabled:b}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1 font-estedad-light",children:[o.length,"/1000 کاراکتر"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"submit",disabled:b||o.trim().length<10,className:"flex-1 px-4 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"در حال ارسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"far fa-paper-plane"}),"ارسال پاسخ"]})}),e.jsx("button",{type:"button",onClick:()=>{I(!1),g("")},disabled:b,className:"px-4 py-2.5 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-estedad-semibold transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"انصراف"})]})]}):e.jsxs("button",{onClick:()=>I(!0),className:"w-full px-4 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors flex items-center justify-center gap-2",children:[e.jsx("i",{className:"far fa-reply"}),"پاسخ به این نظر"]})})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:d,className:"px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors",children:"بستن"})})})]})]})})}function Te(){const{setHeaderConfig:a}=de(),[d,h]=c.useState("doctor"),[x,m]=c.useState(1),[o,g]=c.useState(""),[j]=ne(o,500),[I,b]=c.useState(!1),[C,u]=c.useState(!1),[y,N]=c.useState(null),[f,S]=c.useState(!1),[t,s]=c.useState(!1),[i,l]=c.useState(null),T=te(),{mutateAsync:z}=se();c.useEffect(()=>(a({title:"مدیریت نظرات"}),()=>{a({title:void 0,backButton:!1})}),[a]);const{data:Q,isLoading:$,isPending:v,refetch:M,isFetching:B}=W(x,5,j,"doctor"),{data:K,isLoading:q,isPending:G,refetch:V,isFetching:H}=W(x,5,j,"article"),{data:P,isLoading:F,isPending:O,refetch:J,isFetching:r}=W(x,5,j,"service");c.useEffect(()=>{o.trim()?b(!0):b(!1)},[o]),c.useEffect(()=>{(d==="doctor"?$:d==="article"?q:F)||j===o&&b(!1)},[$,q,F,j,o,d]);const n=(R,Y)=>{N({id:R,content:Y}),u(!0)},p=async()=>{if(y){S(!0);try{await z(y.id),D("نظر با موفقیت حذف شد"),T.invalidateQueries({queryKey:["comments"]}),T.invalidateQueries({queryKey:["commentsStats"]}),u(!1),N(null)}catch(R){const Y=R?.response?.data?.message||"خطایی در حذف نظر رخ داد";A(Y)}finally{S(!1)}}},k=()=>{f||(u(!1),N(null))},L=R=>{l(R),s(!0)},ae=()=>{s(!1),l(null)},w=d==="doctor"?{comments:Q?.data?.comments||[],meta:Q?.meta,isLoading:$||v,refetch:M,isRefetching:B}:d==="article"?{comments:K?.data?.comments||[],meta:K?.meta,isLoading:q||G,refetch:V,isRefetching:H}:{comments:P?.data?.comments||[],meta:P?.meta,isLoading:F||O,refetch:J,isRefetching:r};return c.useEffect(()=>{m(1)},[d]),c.useEffect(()=>{m(1)},[j]),e.jsxs("main",{children:[e.jsxs(oe,{children:[e.jsx(je,{}),e.jsx("h5",{className:"main-header ",children:"لیست نظرات"}),e.jsx("div",{className:"mb-6 border-b border-main-border-color",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{onClick:()=>h("doctor"),className:`px-6 py-3 font-estedad-medium text-sm transition-colors ${d==="doctor"?"border-b-2 border-primary text-primary":"text-paragray hover:text-dark"}`,children:[e.jsx("i",{className:"fas fa-user-md ml-2"}),"نظرات پزشکان"]}),e.jsxs("button",{onClick:()=>h("article"),className:`px-6 py-3 font-estedad-medium text-sm transition-colors ${d==="article"?"border-b-2 border-primary text-primary":"text-paragray hover:text-dark"}`,children:[e.jsx("i",{className:"fas fa-newspaper ml-2"}),"نظرات مقالات"]}),e.jsxs("button",{onClick:()=>h("service"),className:`px-6 py-3 font-estedad-medium text-sm transition-colors ${d==="service"?"border-b-2 border-primary text-primary":"text-paragray hover:text-dark"}`,children:[e.jsx("i",{className:"fas fa-handshake ml-2"}),"نظرات خدمات"]})]})}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative max-w-md",children:[e.jsx(ce,{labelText:"جستجو",placeholder:"جستجو بر اساس متن نظر، نام کاربر، نام پزشک/مقاله/خدمت...",className:"bg-white pr-12",value:o,onChange:R=>{g(R.target.value),m(1)}}),I&&o&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]})}),d==="doctor"&&e.jsx(ge,{comments:w.comments,isLoadingComments:w.isLoading,page:x,onDeleteClick:n,onCommentClick:L,onRefetch:w.refetch,isRefetching:w.isRefetching}),d==="article"&&e.jsx(be,{comments:w.comments,isLoadingComments:w.isLoading,page:x,onDeleteClick:n,onCommentClick:L,onRefetch:w.refetch,isRefetching:w.isRefetching}),d==="service"&&e.jsx(fe,{comments:w.comments,isLoadingComments:w.isLoading,page:x,onDeleteClick:n,onCommentClick:L,onRefetch:w.refetch,isRefetching:w.isRefetching}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(xe,{meta:w.meta,onPageChange:R=>m(R)})})]}),e.jsx(me,{isOpen:C,onClose:k,onConfirm:p,title:"حذف نظر",message:"آیا از حذف این نظر اطمینان دارید؟ این عمل غیرقابل بازگشت است.",confirmText:"حذف",cancelText:"انصراف",isLoading:f}),e.jsx(Ne,{isOpen:t,onClose:ae,comment:i,commentType:d,onRefetch:w.refetch})]})}export{Te as default};
