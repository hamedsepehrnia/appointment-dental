import{r as m,j as t}from"./react-core-DkX7OQ4Q.js";import{c as j,e as y,b as f,f as F,a as i,F as T}from"./forms-CxDKTD82.js";import{am as v,an as S,C as d,h as C,e as I,s as h,i as M}from"./index-DUiqV2No.js";import{b as q}from"./query-x6gLKhnn.js";import{a as P}from"./react-router-CdfMEooj.js";function V({insurance:r}){const l=m.useRef(null),b=P(),o=q(),{mutateAsync:g}=v(),{mutateAsync:x}=S(),[u,c]=m.useState(!1),p=!!r?.id,N=m.useMemo(()=>j({name:i().required("نام سازمان بیمه الزامی است").min(2,"نام باید حداقل ۲ کاراکتر باشد").max(100,"نام نباید بیشتر از ۱۰۰ کاراکتر باشد"),description:i().max(1e3,"توضیحات نباید بیشتر از ۱۰۰۰ کاراکتر باشد"),website:i().url("آدرس وب‌سایت معتبر نیست").nullable(),phoneNumber:i().nullable(),email:i().email("ایمیل معتبر نیست").nullable(),logo:F().nullable(),order:f().integer("ترتیب باید عدد صحیح باشد").min(0,"ترتیب نمی‌تواند منفی باشد"),published:y()}),[]),w=async(e,n)=>{try{const s=new FormData;if(s.append("name",e.name),s.append("published",e.published.toString()),s.append("order",e.order.toString()),e.description&&s.append("description",e.description),e.website&&s.append("website",e.website),e.phoneNumber&&s.append("phoneNumber",e.phoneNumber),e.email&&s.append("email",e.email),e.logo&&s.append("logo",e.logo),u&&p&&s.append("removeLogo","true"),p&&r?.id){const a=await x({id:r.id,data:s});h("سازمان بیمه با موفقیت ویرایش شد"),c(!1),a?.data?.insurance&&o.setQueryData(["insurance",r.id],a),o.invalidateQueries({queryKey:["insurances"]}),o.invalidateQueries({queryKey:["insurance",r.id]}),b("/admin/insurance-management")}else{await g(s),h("سازمان بیمه با موفقیت ایجاد شد"),n(),o.invalidateQueries({queryKey:["insurances"]}),o.invalidateQueries({queryKey:["insurance"]});const a=document.querySelector(".overflow-auto");a?a.scrollTo({top:0,behavior:"smooth"}):window.scrollTo({top:0,behavior:"smooth"})}setTimeout(()=>{l.current&&(l.current.value="")},0)}catch(s){const a=s?.response?.data?.message||(p?"خطایی در ویرایش سازمان بیمه رخ داد":"خطایی در ایجاد سازمان بیمه رخ داد");M(a)}};return t.jsx(T,{initialValues:{name:r?.name||"",description:r?.description||"",website:r?.website||"",phoneNumber:r?.phoneNumber||"",email:r?.email||"",logo:null,order:r?.order??0,published:r?.published??!0},validationSchema:N,onSubmit:async(e,{resetForm:n})=>{await w({name:e.name,description:e.description||void 0,website:e.website||void 0,phoneNumber:e.phoneNumber||void 0,email:e.email||void 0,logo:e.logo,published:e.published,order:e.order},n)},children:e=>{const n=r?.logo&&!e.values.logo&&!u;return t.jsxs("form",{onSubmit:e.handleSubmit,className:"space-y-4",children:[t.jsx(d,{labelText:"نام سازمان بیمه",placeholder:"نام سازمان بیمه را وارد کنید",className:"bg-white",requiredText:!0,...e.getFieldProps("name"),errorMessage:e.touched.name&&e.errors.name?e.errors.name:null}),t.jsx(C,{labelText:"توضیحات",placeholder:"توضیحات سازمان بیمه را وارد کنید",optional:!0,rows:4,className:"bg-white",...e.getFieldProps("description"),errorMessage:e.touched.description&&e.errors.description?e.errors.description:null}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsx(d,{labelText:"وب‌سایت",placeholder:"آدرس وب‌سایت را وارد کنید",className:"bg-white",optional:!0,...e.getFieldProps("website"),errorMessage:e.touched.website&&e.errors.website?e.errors.website:null}),t.jsx(d,{labelText:"شماره تماس",placeholder:"شماره تماس را وارد کنید",className:"bg-white",optional:!0,...e.getFieldProps("phoneNumber"),errorMessage:e.touched.phoneNumber&&e.errors.phoneNumber?e.errors.phoneNumber:null}),t.jsx(d,{labelText:"ایمیل",placeholder:"ایمیل را وارد کنید",className:"bg-white",optional:!0,inputType:"email",...e.getFieldProps("email"),errorMessage:e.touched.email&&e.errors.email?e.errors.email:null}),t.jsx(d,{labelText:"ترتیب",placeholder:"ترتیب نمایش را وارد کنید",className:"bg-white",inputType:"number",...e.getFieldProps("order"),errorMessage:e.touched.order&&e.errors.order?e.errors.order:null}),t.jsx("div",{className:"flex items-center gap-4 pt-8",children:t.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[t.jsx("input",{type:"checkbox",checked:e.values.published,onChange:s=>e.setFieldValue("published",s.target.checked),className:"w-5 h-5 rounded border-2 border-main-border-color text-primary focus:ring-primary"}),t.jsx("span",{className:"text-dark font-estedad-lightbold",children:"منتشر شده"})]})})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-dark font-estedad-lightbold mb-2 mr-4",children:"لوگو"}),t.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[t.jsx("input",{ref:l,type:"file",accept:"image/*",className:"hidden ",onChange:s=>{const a=s.target.files?.[0]||null;e.setFieldValue("logo",a),c(!1)}}),t.jsx("button",{type:"button",onClick:()=>{l.current?.click(),c(!1)},className:"px-8 py-3  rounded-lg  font-estedad-medium bg-purple-500/60 text-white hover:bg-purple-600/60  transition-colors",children:"انتخاب فایل"}),e.values.logo instanceof File&&t.jsx("span",{className:"text-sm text-dark font-estedad-light",children:e.values.logo.name}),n&&t.jsxs("div",{className:"flex items-center gap-2 flex-wrap justify-center ",children:[t.jsx("img",{src:I(r.logo),alt:r.name||"لوگو سازمان بیمه",className:"w-12 h-12 rounded-lg object-cover"}),t.jsx("span",{className:"text-sm text-paragray",children:"لوگوی فعلی"}),t.jsx("button",{type:"button",onClick:()=>{c(!0),e.setFieldValue("logo",null),l.current&&(l.current.value="")},className:"px-4 py-1.5 text-sm rounded-lg font-estedad-medium bg-red-500/60 text-white hover:bg-red-600/60 transition-colors",children:"حذف عکس"})]}),u&&t.jsx("span",{className:"text-sm text-red-500 font-estedad-light",children:"عکس در حال حذف است"})]})]}),t.jsx("div",{className:"flex justify-end mt-6",children:t.jsxs("button",{type:"submit",className:"purple-btn flex items-center gap-2",disabled:e.isSubmitting,children:[p?"ویرایش سازمان بیمه":"ایجاد سازمان بیمه",e.isSubmitting&&t.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent"})]})})]})}})}export{V as I};
