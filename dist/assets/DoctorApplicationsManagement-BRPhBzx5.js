import{j as e,b as J}from"./query-vendor-KlcNboas.js";import{a as f}from"./react-vendor-vqeg7uDR.js";import{c as $,N as W,l as L,T as X,a2 as Y,m as A,A as Z,G as ee,O as te,a1 as se,S as ae,C as le,Q as re,R as ie,h as T,i as R}from"./index-NfFM6Un-.js";import{a as ne,b as oe,c as de,d as ce,e as xe}from"./useDoctorApplications-wLYmJB5l.js";import"./redux-vendor-CGnCw5VP.js";import"./ui-vendor-D4DdIvF_.js";import"./form-vendor--t6BffNT.js";import"./motion-vendor-CQyDv_CV.js";function me(i){const t=$.c(17),{applications:r,isLoadingApplications:a,page:l,onDeleteClick:p,onMarkAsRead:y,onMarkAsUnread:u,onApplicationClick:b,onRefetch:h,isRefetching:g}=i,c=g===void 0?!1:g;let x;t[0]!==c||t[1]!==h?(x=h&&e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:h,disabled:c,className:"px-4 py-2 rounded-lg text-sm font-estedad-medium bg-primary/10 text-primary hover:bg-primary hover:text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",title:"بروزرسانی لیست",children:[c?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-primary border-t-transparent"}):e.jsx("i",{className:"fas fa-sync-alt"}),"بروزرسانی"]})}),t[0]=c,t[1]=h,t[2]=x):x=t[2];let o;t[3]===Symbol.for("react.memo_cache_sentinel")?(o=e.jsx("thead",{className:"border-b border-main-border-color ",children:e.jsxs("tr",{className:"*:text-right *:p-4.5 *:text-nowrap",children:[e.jsx("th",{children:"ردیف"}),e.jsx("th",{children:"نام و نام خانوادگی"}),e.jsx("th",{children:"نوع درخواست"}),e.jsx("th",{children:"ایمیل"}),e.jsx("th",{children:"شماره تماس"}),e.jsx("th",{children:"اطلاعات متقاضی"}),e.jsx("th",{children:"کلینیک"}),e.jsx("th",{children:"وضعیت"}),e.jsx("th",{children:"تاریخ ایجاد"}),e.jsx("th",{children:"عملیات"})]})}),t[3]=o):o=t[3];let d;t[4]!==r||t[5]!==a||t[6]!==b||t[7]!==p||t[8]!==y||t[9]!==u||t[10]!==l?(d=a?e.jsx(W,{rows:5,columns:10}):r.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:10,className:"text-center p-8 font-estedad-light",children:"درخواستی یافت نشد"})}):r.map((s,w)=>e.jsxs("tr",{className:`text-dark *:p-4.5 ${s.read?"bg-gray-50 hover:bg-gray-100":"bg-blue-100 hover:bg-blue-200"}`,children:[e.jsx("td",{className:"font-estedad-light text-center",children:(l-1)*5+w+1}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx("i",{className:"far fa-user text-primary"})}),e.jsx("div",{children:e.jsxs("p",{className:"font-estedad-light line-clamp-2 max-w-[300px] min-w-[220px]",children:[s.firstName," ",s.lastName]})})]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.applicationType==="DENTIST"?e.jsxs("span",{className:"px-3 py-1.5 text-xs rounded-lg bg-blue-100 text-blue-700 font-estedad-semibold flex items-center gap-1.5 w-fit",children:[e.jsx("i",{className:"fas fa-user-md"}),"دندانپزشک"]}):e.jsxs("span",{className:"px-3 py-1.5 text-xs rounded-lg bg-purple-100 text-purple-700 font-estedad-semibold flex items-center gap-1.5 w-fit",children:[e.jsx("i",{className:"fas fa-user-nurse"}),"نرس"]})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.email||e.jsx("span",{className:"text-paragray",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.phoneNumber}),e.jsx("td",{className:"text-dark font-estedad-light",children:e.jsx("button",{onClick:()=>b(s),className:"line-clamp-2 max-w-[260px] min-w-[200px] text-right hover:text-primary transition-colors cursor-pointer",title:"کلیک برای مشاهده کامل اطلاعات",children:s.doctorInfo})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.clinic?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-primary/10 text-primary text-nowrap",children:s.clinic.name}):e.jsx("span",{className:"text-paragray ",children:"-"})}),e.jsx("td",{className:"text-dark font-estedad-light",children:s.read?e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-green-100 text-green-700 text-nowrap",children:"خوانده شده"}):e.jsx("span",{className:"px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700 text-nowrap",children:"خوانده نشده"})}),e.jsx("td",{className:"text-dark font-estedad-light text-nowrap",children:L(new Date(s.createdAt))}),e.jsx("td",{className:"",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[s.read?e.jsx("button",{onClick:()=>u(s.id),className:"p-1.5 rounded-full text-blue-500 bg-blue-500/20 hover:bg-blue-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده نشده",children:e.jsx("i",{className:"far fa-envelope"})}):e.jsx("button",{onClick:()=>y(s.id),className:"p-1.5 rounded-full text-green-500 bg-green-500/20 hover:bg-green-500 hover:text-white transition",title:"علامت‌گذاری به عنوان خوانده شده",children:e.jsx("i",{className:"far fa-envelope-open"})}),e.jsx("button",{onClick:()=>p(s.id,`${s.firstName} ${s.lastName}`),className:"p-1.5 rounded-full text-red-500 bg-red-500/20 hover:bg-red-500 hover:text-white transition",title:"حذف",children:e.jsx("i",{className:"far fa-trash-alt"})})]})})]},s.id)),t[4]=r,t[5]=a,t[6]=b,t[7]=p,t[8]=y,t[9]=u,t[10]=l,t[11]=d):d=t[11];let j;t[12]!==d?(j=e.jsx(X,{withBg:!0,withMargin:!0,children:e.jsxs("table",{className:"w-full ",children:[o,e.jsx("tbody",{className:"divide-y divide-main-border-color",children:d})]})}),t[12]=d,t[13]=j):j=t[13];let n;return t[14]!==x||t[15]!==j?(n=e.jsxs(e.Fragment,{children:[x,j]}),t[14]=x,t[15]=j,t[16]=n):n=t[16],n}function pe(){const i=$.c(3),{data:t,isLoading:r}=ne();let a;if(i[0]!==r||i[1]!==t?.data){const l=t?.data||{total:0,read:0,unread:0},p=[{title:"کل درخواست‌ها",value:l.total,icon:"far fa-envelope",bgColor:"bg-blue-100",iconColor:"text-primary",isLoading:r},{title:"خوانده شده",value:l.read,icon:"far fa-envelope-open",bgColor:"bg-green-100",iconColor:"text-green-500",isLoading:r},{title:"خوانده نشده",value:l.unread,icon:"far fa-envelope",bgColor:"bg-orange-100",iconColor:"text-orange-500",isLoading:r}];a=e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 mb-8",children:p.map(he)}),i[0]=r,i[1]=t?.data,i[2]=a}else a=i[2];return a}function he(i,t){return e.jsx("div",{className:"bg-white p-6 rounded-xl shadow-sm hover:shadow-md transition",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-500 font-estedad-light text-sm",children:i.title}),i.isLoading?e.jsx("div",{className:"mt-2 h-8 w-20 bg-gray-200 rounded animate-pulse"}):e.jsx("h3",{className:"text-2xl font-estedad-semibold mt-2",children:i.value.toLocaleString("fa-IR")})]}),e.jsx("div",{className:`w-12 h-12 shrink-0 ${i.bgColor} rounded-lg flex items-center justify-center`,children:e.jsx("i",{className:`${i.icon} ${i.iconColor} text-xl`})})]})},t)}function fe(i){const t=$.c(20),{isOpen:r,onClose:a,application:l}=i;let p,y;t[0]!==r||t[1]!==a?(p=()=>{const o=d=>{d.key==="Escape"&&r&&a()};return r&&(document.addEventListener("keydown",o),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",o),document.body.style.overflow="unset"}},y=[r,a],t[0]=r,t[1]=a,t[2]=p,t[3]=y):(p=t[2],y=t[3]),f.useEffect(p,y);let u;t[4]!==a?(u=o=>{o.target===o.currentTarget&&a()},t[4]=a,t[5]=u):u=t[5];const b=u;let h,g,c;if(t[6]!==l||t[7]!==b||t[8]!==r||t[9]!==a){let o=[];if(l?.documents)try{let n;t[13]!==l?(n=JSON.parse(l.documents),t[13]=l,t[14]=n):n=t[14],o=n}catch(n){console.error("Error parsing documents:",n)}let d;if(t[15]===Symbol.for("react.memo_cache_sentinel")){const n=Y();d=s=>{if(!s)return"";if(/^https?:\/\//i.test(s))return s;if(n){const w=s.startsWith("/")?s:`/${s}`;return`${n}${w}`}return s},t[15]=d}else d=t[15];const j=d;h=Z,g="wait",c=r&&l&&e.jsxs(A.div,{className:"fixed inset-0 z-50 flex items-center justify-center p-4",onClick:b,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},children:[e.jsx(A.div,{className:"absolute inset-0 bg-black/50 backdrop-blur-sm",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2}}),e.jsxs(A.div,{className:"relative z-10 w-full max-w-2xl bg-white rounded-xl shadow-2xl max-h-[90vh] overflow-hidden flex flex-col",initial:{opacity:0,scale:.9,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.9,y:20},transition:{type:"spring",stiffness:300,damping:30,duration:.3},children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-400 via-purple-500 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx("i",{className:"far fa-user-md text-white text-xl"})}),e.jsx("h3",{className:"text-xl font-estedad-semibold text-white",children:"مشاهده درخواست همکاری"})]}),e.jsx(A.button,{onClick:a,className:"w-9 h-9 rounded-lg bg-white/20 backdrop-blur-sm border border-white/30 hover:bg-white/30 hover:border-white/40 flex items-center justify-center transition-all duration-200 group","aria-label":"بستن",children:e.jsx("i",{className:"fa fa-times text-sm text-white/90 group-hover:text-white transition-colors"})})]})}),e.jsx("div",{className:"px-6 py-6 overflow-y-auto flex-1 admin-modal-scrollbar",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"نام و نام خانوادگی"}),e.jsxs("p",{className:"text-dark font-estedad-light text-base",children:[l.firstName," ",l.lastName]})]}),l.email&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"ایمیل"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:l.email})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"شماره تماس"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:l.phoneNumber})]}),l.clinic&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"کلینیک"}),e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-primary/10 text-primary inline-block",children:l.clinic.name})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"اطلاعات متقاضی"}),e.jsx("p",{className:"text-dark font-estedad-light text-base leading-7 whitespace-pre-wrap",children:l.doctorInfo})]}),o.length>0&&e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-2",children:"مدارک ارسال شده"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:o.map((n,s)=>{const w=j(n),k=n.split("/").pop()||`مدرک ${s+1}`,v=/\.(jpg|jpeg|png|gif)$/i.test(n),C=/\.pdf$/i.test(n);return e.jsxs("a",{href:w,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 px-3 py-2 bg-primary/10 hover:bg-primary/20 text-primary rounded-lg transition-colors",children:[v?e.jsx("i",{className:"far fa-image"}):C?e.jsx("i",{className:"far fa-file-pdf"}):e.jsx("i",{className:"far fa-file"}),e.jsx("span",{className:"text-sm",children:k}),e.jsx("i",{className:"far fa-external-link-alt text-xs"})]},s)})})]}),e.jsxs("div",{className:"border-b border-gray-200 pb-3",children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"تاریخ ارسال"}),e.jsx("p",{className:"text-dark font-estedad-light text-base",children:L(new Date(l.createdAt))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-estedad-semibold text-gray-500 block mb-1",children:"وضعیت"}),l.read?e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-green-100 text-green-700 inline-block",children:"خوانده شده"}):e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-blue-100 text-blue-700 inline-block",children:"خوانده نشده"})]})]})}),e.jsx("div",{className:"px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:e.jsx("div",{className:"flex items-center justify-end",children:e.jsx("button",{onClick:a,className:"px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-estedad-semibold transition-colors",children:"بستن"})})})]})]}),t[6]=l,t[7]=b,t[8]=r,t[9]=a,t[10]=h,t[11]=g,t[12]=c}else h=t[10],g=t[11],c=t[12];let x;return t[16]!==h||t[17]!==g||t[18]!==c?(x=e.jsx(h,{mode:g,children:c}),t[16]=h,t[17]=g,t[18]=c,t[19]=x):x=t[19],x}function ke(){const{setHeaderConfig:i}=ee(),[t,r]=f.useState(1),[a,l]=f.useState(""),[p]=te(a,500),[y,u]=f.useState(!1),[b,h]=f.useState(void 0),[g,c]=f.useState(!1),[x,o]=f.useState(null),[d,j]=f.useState(!1),[n,s]=f.useState(!1),[w,k]=f.useState(null),v=J(),{mutateAsync:C}=oe(),{mutateAsync:I}=de(),{mutateAsync:O}=ce(),{refetch:S}=se(),{data:E,isLoading:D,isPending:U,refetch:_,isFetching:Q}=xe(t,5,p,b);f.useEffect(()=>(i({title:"مدیریت درخواست‌های همکاری پزشکان"}),()=>{i({title:void 0,backButton:!1})}),[i]),f.useEffect(()=>{a.trim()?u(!0):u(!1)},[a]),f.useEffect(()=>{D||p===a&&u(!1)},[D,p,a]);const q=(m,N)=>{o({id:m,name:N}),c(!0)},K=async()=>{if(x){j(!0);try{await S(),await C(x.id),T("درخواست با موفقیت حذف شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]}),c(!1),o(null)}catch(m){const N=m?.response?.data?.message||"خطایی در حذف درخواست رخ داد";R(N)}finally{j(!1)}}},P=()=>{d||(c(!1),o(null))},F=async m=>{try{await S(),await I(m),T("درخواست به عنوان خوانده شده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]})}catch(N){const M=N?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت درخواست رخ داد";R(M)}},B=async m=>{try{await S(),await O(m),T("درخواست به عنوان خوانده نشده علامت‌گذاری شد"),v.invalidateQueries({queryKey:["doctorApplications"]}),v.invalidateQueries({queryKey:["doctorApplicationsStats"]})}catch(N){const M=N?.response?.data?.message||"خطایی در به‌روزرسانی وضعیت درخواست رخ داد";R(M)}},V=m=>{k(m),s(!0)},z=()=>{s(!1),k(null)},G=E?.data?.applications||[],H=E?.meta;return e.jsxs("main",{children:[e.jsxs(ae,{children:[e.jsx(pe,{}),e.jsx("h5",{className:"main-header ",children:"لیست درخواست‌ها"}),e.jsxs("div",{className:"mb-4 flex flex-col md:flex-row  justify-between gap-4",children:[e.jsxs("div",{className:"relative max-w-md flex-1",children:[e.jsx(le,{labelText:"جستجو",placeholder:"جستجو بر اساس نام، ایمیل، شماره تماس یا اطلاعات...",className:"bg-white pr-12",value:a,onChange:m=>{l(m.target.value),r(1)}}),y&&a&&e.jsx("div",{className:"absolute left-6 top-[calc(100%-38px)] flex items-center pointer-events-none",children:e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-2 border-primary border-t-transparent"})})]}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("label",{className:"text-sm font-estedad-semibold mb-2",children:"فیلتر وضعیت:"}),e.jsxs("select",{value:b===void 0?"all":b?"read":"unread",onChange:m=>{const N=m.target.value;h(N==="all"?void 0:N==="read"),r(1)},className:"px-4 py-2 border border-gray-300 rounded-lg bg-white focus:outline-none focus:ring-2 focus:ring-primary",children:[e.jsx("option",{value:"all",children:"همه"}),e.jsx("option",{value:"read",children:"خوانده شده"}),e.jsx("option",{value:"unread",children:"خوانده نشده"})]})]})]}),e.jsx(me,{applications:G,isLoadingApplications:D||U,page:t,onDeleteClick:q,onMarkAsRead:F,onMarkAsUnread:B,onApplicationClick:V,onRefetch:_,isRefetching:Q}),e.jsx("div",{className:"mb-12 mt-6",children:e.jsx(re,{meta:H,onPageChange:m=>r(m)})})]}),e.jsx(ie,{isOpen:g,onClose:P,onConfirm:K,title:"حذف درخواست",message:`آیا از حذف درخواست ${x?.name} اطمینان دارید؟ این عمل غیرقابل بازگشت است.`,confirmText:"حذف",cancelText:"انصراف",isLoading:d}),e.jsx(fe,{isOpen:n,onClose:z,application:w})]})}export{ke as default};
